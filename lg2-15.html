<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Company List</title>
  <style>
    html, body {
      font-family: Arial, sans-serif;
      background-color: #282828;
      color: white;
      margin: 0;
      padding: 1.14vw;
      padding-bottom: 7.5vh;
      width: 100%;
      max-width: 880px;
      min-height: 100vh;
      box-sizing: border-box;
      display: flex;
      flex-direction: column;
      overflow: hidden;
    }

    .row {
      display: block;
      padding: 0.45vw;
      border-bottom: 1px solid #444;
      font-size: 3.64vw;
      line-height: 4.09vw;
      word-wrap: break-word;
      overflow-wrap: break-word;
      max-width: calc(100% - 2.28vw);
    }

    .footer {
      background-color: #ff6600;
      color: white;
      text-align: center;
      padding: 1.14vw;
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      width: 100%;
      font-size: 1.7vw;
      font-weight: bold;
      box-sizing: border-box;
    }

    #companyList {
      flex: 1;
      transition: opacity 0.5s ease-in-out;
    }

    .fade-out {
      opacity: 0;
    }

    .fade-in {
      opacity: 1;
    }

    @media screen and (max-width: 600px) {
      .row {
        font-size: 5vw;
        line-height: 6vw;
        padding: 0.8vw;
      }
      .footer {
        font-size: 2.5vw;
        padding: 1.5vw;
      }
    }

    @media screen and (min-width: 1200px) {
      .row {
        font-size: 2.67vw;
        line-height: 3vw;
        padding: 0.33vw;
      }
      .footer {
        font-size: 1.25vw;
        padding: 0.83vw;
      }
    }
  </style>
</head>
<body>
  <div id="companyList">Loading...</div>
  <div class="footer" id="footer">Loading... | Page 1 of 1</div>

  <script>
    const dataUrl = "https://docs.google.com/spreadsheets/d/e/2PACX-1vSHIT3SeyUDvm1vUXuo5xdZJwrFlYkBPR-P4ebecZ1KgJy0LGhHU2QRoHz0pSN2L238rd2IH2_zA0PD/pubhtml?gid=0&single=true";

    let companies = [];
    let currentPage = 0;
    const targetCompaniesPerPage = 10;
    let totalPages = 1;
    let sheetTitle = "Company List";
    let pageBreaks = [0];

    const xhr = new XMLHttpRequest();
    xhr.onreadystatechange = function() {
      if (xhr.readyState === 4) {
        if (xhr.status === 200) {
          const temp = document.createElement("div");
          temp.innerHTML = xhr.responseText;

          const titleElement = temp.getElementsByTagName("title")[0];
          if (titleElement && titleElement.innerText) {
            sheetTitle = titleElement.innerText.replace(/ - Google .*$/, "").trim();
            document.title = sheetTitle;
          }

          const table = temp.getElementsByTagName("table")[0];
          if (!table) {
            document.getElementById("companyList").innerText = "Error: No table found.";
            document.getElementById("footer").innerText = sheetTitle + " | Page 1 of 1";
            return;
          }

          const rows = table.rows;
          companies = [];
          for (let i = 1; i < rows.length; i++) {
            const cells = rows[i].cells;
            if (cells.length < 2) {
              console.warn(`Warning: Row ${i} has fewer than 2 cells, skipping`);
              continue;
            }
            const listNumber = cells[0]?.innerText.trim() || i.toString();
            const companyName = cells[1]?.innerText.trim() || "Unnamed";
            companies.push({ listNumber, companyName });
          }

          pageBreaks = [0];
          for (let i = 0; i < companies.length; i += targetCompaniesPerPage) {
            pageBreaks.push(Math.min(i + targetCompaniesPerPage, companies.length));
          }
          totalPages = pageBreaks.length - 1;

          displayPage(currentPage);
          updateFooter();
          startAutoTransition();
        } else {
          document.getElementById("companyList").innerText = `Error: Failed to load data (Status: ${xhr.status})`;
          document.getElementById("footer").innerText = `${sheetTitle} | Page 1 of 1`;
        }
      }
    };

    xhr.open("GET", dataUrl, true);
    try {
      xhr.send();
    } catch (e) {
      document.getElementById("companyList").innerText = "Error: Failed to send request.";
      document.getElementById("footer").innerText = sheetTitle + " | Page 1 of 1";
    }

    function displayPage(page) {
      const companyList = document.getElementById("companyList");
      companyList.className = "fade-out";

      setTimeout(() => {
        const start = pageBreaks[page];
        const end = pageBreaks[page + 1] || companies.length;
        let output = "";

        for (let i = start; i < end && i < start + targetCompaniesPerPage; i++) {
          output += `<div class="row">${companies[i].listNumber}. ${companies[i].companyName}</div>`;
        }

        for (let i = end - start; i < targetCompaniesPerPage; i++) {
          output += '<div class="row"> </div>';
        }

        companyList.innerHTML = output;
        companyList.className = "fade-in";
        updateFooter();
      }, 500);
    }

    function updateFooter() {
      document.getElementById("footer").innerText = `${sheetTitle} | Page ${currentPage + 1} of ${totalPages}`;
    }

    function startAutoTransition() {
      setInterval(() => {
        currentPage = (currentPage + 1) % totalPages;
        displayPage(currentPage);
      }, 15000);
    }
  </script>
</body>
</html>
