<!doctype html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Event Poster Generator</title>
<link rel="icon" type="image/png" href="https://www.compassoffices.com/wp-content/uploads/2025/09/compassoffices-logo-web-2025_icon-o-scaled.png">
<script src="https://cdn.tailwindcss.com"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
<style>
    body {box-sizing:border-box;margin:0;padding:0;}
    .poster-template{
        width:595px;height:842px;position:relative;overflow:hidden;
        box-shadow:0 8px 32px rgba(0,0,0,0.1);background:white;
        transform:scale(0.85);transform-origin:top center;margin-bottom:-126px;
    }
    .loading-spinner{
        border:3px solid #f3f4f6;border-top:3px solid #3b82f6;
        border-radius:50%;width:20px;height:20px;animation:spin 1s linear infinite;
    }
    @keyframes spin{0%{transform:rotate(0deg)}100%{transform:rotate(360deg)}}
    .form-section{background:linear-gradient(135deg,#2d3748 0%,#1a202c 100%);}
    .preview-section{background:linear-gradient(135deg,#4a5568 0%,#2d3748 100%);}
    .download-btn{background:linear-gradient(45deg,#ff6600,#e55a00);}
    .download-btn:hover{background:linear-gradient(45deg,#e55a00,#cc4f00);}
    .grid-overlay{
        position:absolute;top:0;left:0;width:100%;height:100%;
        background:repeating-linear-gradient(0deg,transparent,transparent 9px,#f0f0f0 10px),
                    repeating-linear-gradient(90deg,transparent,transparent 9px,#f0f0f0 10px);
        opacity:0.08;pointer-events:none;z-index:1;display:none;
    }
    .grid-enabled .grid-overlay{display:block;}
    @font-face{font-family:'Helvetica Neue';font-weight:600;src:local('Helvetica Neue Bold'),local('HelveticaNeue-Bold');}
    @font-face{font-family:'Helvetica Neue';font-weight:400;src:local('Helvetica Neue'),local('HelveticaNeue');}
</style>
</head>
<body class="min-h-full bg-gray-100">
<div class="min-h-full">
<header class="bg-white shadow-sm border-b border-gray-200">
    <div class="max-w-7xl mx-auto px-6 py-4">
     <h1 class="text-3xl font-bold text-gray-900">Event Poster Generator</h1>
     <p class="text-gray-600 mt-2">JPG download = 100% identical to preview (CORS fixed!)</p>
    </div>
</header>

<div class="max-w-7xl mx-auto px-6 py-8">
<div class="grid grid-cols-1 lg:grid-cols-5 gap-8">

<!-- ==== FORM ==== -->
<div class="form-section rounded-2xl p-8 text-white lg:col-span-2">
<h2 class="text-2xl font-bold mb-6">Event Details</h2>
<form id="eventForm" class="space-y-6">
 <div><label for="event_title" class="block text-sm font-medium mb-2">Event Title (max 40 words)</label>
  <textarea id="event_title" required class="w-full px-4 py-3 rounded-lg bg-white/20 backdrop-blur-sm border border-white/30 text-white focus:outline-none focus:ring-2 focus:ring-white/50 resize-none min-h-[60px]" placeholder="Summer Music Festival" maxlength="400"></textarea>
  <div class="text-xs text-white/70 mt-1 text-right" id="titleWordCount">0 / 40 words</div>
 </div>
 <div><label for="event_subtitle" class="block text-sm font-medium mb-2">Event Subtitle (max 40 words)</label>
  <textarea id="event_subtitle" class="w-full px-4 py-3 rounded-lg bg-white/20 backdrop-blur-sm border border-white/30 text-white focus:outline-none focus:ring-2 focus:ring-white/50 resize-none min-h-[60px]" placeholder="A Night of Music and Fun" maxlength="400"></textarea>
  <div class="text-xs text-white/70 mt-1 text-right" id="subtitleWordCount">0 / 40 words</div>
 </div>
 <div><label for="event_date" class="block text-sm font-medium mb-2">Date</label>
  <input type="date" id="event_date" required class="w-full px-4 py-3 rounded-lg bg-white/20 backdrop-blur-sm border border-white/30 text-white focus:outline-none focus:ring-2 focus:ring-white/50"></div>
 <div class="grid grid-cols-2 gap-4">
  <div><label for="event_time" class="block text-sm font-medium mb-2">Start Time</label>
   <input type="time" id="event_time" required class="w-full px-4 py-3 rounded-lg bg-white/20 backdrop-blur-sm border border-white/30 text-white focus:outline-none focus:ring-2 focus:ring-white/50"></div>
  <div><label for="end_time" class="block text-sm font-medium mb-2">End Time</label>
   <input type="time" id="end_time" class="w-full px-4 py-3 rounded-lg bg-white/20 backdrop-blur-sm border border-white/30 text-white focus:outline-none focus:ring-2 focus:ring-white/50"></div>
 </div>
 <div><label for="location" class="block text-sm font-medium mb-2">Location</label>
  <input type="text" id="location" required class="w-full px-4 py-3 rounded-lg bg-white/20 backdrop-blur-sm border border-white/30 text-white placeholder-white/70 focus:outline-none focus:ring-2 focus:ring-white/50" placeholder="Central Park, New York"></div>
 <div><label for="description" class="block text-sm font-medium mb-2">Description (max 3 bullets, 70 words each)</label>
  <textarea id="description" class="w-full px-4 py-3 rounded-lg bg-white/20 backdrop-blur-sm border border-white/30 text-white focus:outline-none focus:ring-2 focus:ring-white/50 resize-none min-h-[100px]" placeholder="Line 1 will become bullet 1&#10;Line 2 will become bullet 2&#10;Line 3 will become bullet 3"></textarea>
  <div class="text-xs text-white/70 mt-1 text-right" id="descBulletCount">0 / 3 bullets</div>
 </div>
 <div><label for="image_url" class="block text-sm font-medium mb-2">Key Image URL (any public image)</label>
  <input type="url" id="image_url" class="w-full px-4 py-3 rounded-lg bg-white/20 backdrop-blur-sm border border-white/30 text-white placeholder-white/70 focus:outline-none focus:ring-2 focus:ring-white/50" placeholder="https://example.com/image.jpg"></div>
 <div><label for="qr_code_url" class="block text-sm font-medium mb-2">QR Code URL (Optional)</label>
  <input type="url" id="qr_code_url" class="w-full px-4 py-3 rounded-lg bg-white/20 backdrop-blur-sm border border-white/30 text-white placeholder-white/70 focus:outline-none focus:ring-2 focus:ring-white/50" placeholder="https://example.com/event"></div>
</form>
</div>

<!-- ==== PREVIEW ==== -->
<div class="preview-section rounded-2xl p-8 text-white lg:col-span-3">
<h2 class="text-2xl font-bold mb-6">Final Poster Layout</h2>
<div class="space-y-8">
 <div>
  <div class="flex justify-between items-center mb-4">
    <h3 class="text-lg font-semibold">Event Poster (A4)</h3>
    <button id="downloadPoster" class="download-btn text-white px-4 py-2 rounded-lg text-sm font-semibold hover:shadow-lg transition-all duration-200">JPG (300 DPI)</button>
  </div>
  <div class="flex justify-center relative">
    <div id="posterPreview" class="poster-template bg-blue-500 overflow-hidden grid-enabled"></div>
  </div>
 </div>
</div>
</div>

</div>
</div>

<script>
// ==================== SVG ICONS ====================
const svgIcons = {
    calendar:`data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIGZpbGU9Im5vbmUiIHZpZXdCb3g9IjAgMCAyNCAyNCIgc3Ryb2tlPSIjZmY2NjAwIiBzdHJva2Utd2lkdGg9IjIuNSIgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIiBzdHJva2UtbGluZWpvaW49InJvdW5kIj48cGF0aCBkPSJNOCA3VjNtOCA0VjNtLTkgOGgxME01IDIxaDE0YTIgMiAwIDAwMi0yVjdhMiAyIDAgMDAtMi0ySDVhMiAyIDAgMDAtMiAydjEyYTIgMiAwIDAwMiAyeiIvPjwvc3ZnPg==`,
    clock:`data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIGZpbGU9Im5vbmUiIHZpZXdCb3g9IjAgMCAyNCAyNCIgc3Ryb2tlPSIjZmY2NjAwIiBzdHJva2Utd2lkdGg9IjIuNSIgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIiBzdHJva2UtbGluZWpvaW49InJvdW5kIj48cGF0aCBkPSJNMTIgOHY0bDMgM202LTNhOSA5IDAgMTEtMTggMCA5IDkgMCAwMTggMHoiLz48L3N2Zz4=`,
    location:`data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIGZpbGU9Im5vbmUiIHZpZXdCb3g9IjAgMCAyNCAyNCIgc3Ryb2tlPSIjZmY2NjAwIiBzdHJva2Utd2lkdGg9IjIuNSIgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIiBzdHJva2UtbGluZWpvaW49InJvdW5kIj48cGF0aCBkPSJNMTcuNjU3IDE2LjY1N0wxMy40MTQgMjAuOWExLjk5OCAxLjk5OCAwIDAxLTIuODI3IDBsLTQuMjQ0LTQuMjQzYTggOCAwIDExMTEuMzE0IDB6Ii8+PHBhdGggZD0iTTE1IDExYTMgMyAwIDExLTYgMCAzIDMgMCAwMTYgMHoiLz48L3N2Zz4=`
};

// ==================== WORD LIMITS ====================
const MAX_TITLE_WORDS = 40, MAX_SUBTITLE_WORDS = 40, MAX_BULLETS = 3, MAX_BULLET_WORDS = 70;
function countWords(t){return t.trim().split(/\s+/).filter(w=>w).length;}
function enforceWordLimit(ta,max,el){
    const upd=()=>{const w=countWords(ta.value);el.textContent=`${w}/${max} words`;el.style.color=w>max?'#f87171':'#e5e7eb';};
    ta.addEventListener('input',()=>{if(countWords(ta.value)>max)ta.value=ta.value.trim().split(/\s+/).slice(0,max).join(' ');upd();updateLivePreview();});
    upd();
}
function enforceBulletLimit(ta,el){
    const norm=()=>{
        const lines=ta.value.split('\n').map(l=>l.trim()).filter(l=>l);
        const valid=[];
        for(let l of lines){
            if(valid.length>=MAX_BULLETS)break;
            const w=countWords(l);
            valid.push(w>MAX_BULLET_WORDS?l.split(/\s+/).slice(0,MAX_BULLET_WORDS).join(' '):l);
        }
        while(valid.length<MAX_BULLETS)valid.push('');
        ta.value=valid.join('\n');
        el.textContent=`${lines.slice(0,MAX_BULLETS).length}/${MAX_BULLETS} bullets`;
        el.style.color=lines.length>MAX_BULLETS?'#f87171':'#e5e7eb';
        updateLivePreview();
    };
    ta.addEventListener('input',norm);
    ta.addEventListener('keydown',e=>{if(e.key==='Enter'){e.preventDefault();const s=ta.selectionStart;ta.value=ta.value.substring(0,s)+'\n'+ta.value.substring(s);ta.selectionStart=ta.selectionEnd=s+1;norm();}});
    norm();
}

// ==================== CORS-FREE IMAGE LOADER ====================
async function loadImageAsBase64(url) {
    if (!url) return null;
    try {
        const proxy = `https://api.allorigins.win/get?url=${encodeURIComponent(url)}`;
        const res = await fetch(proxy);
        const data = await res.json();
        return data.contents; // base64 string
    } catch (e) {
        console.warn("Image load failed:", url);
        return null;
    }
}

// ==================== CANVAS POSTER (300 DPI) ====================
async function drawPosterOnCanvas(event) {
    const DPI = 300;
    const SCALE = DPI / 72;
    const WIDTH = 595 * SCALE;   // 2480
    const HEIGHT = 843 * SCALE;  // 3508

    const canvas = document.createElement('canvas');
    canvas.width = WIDTH;
    canvas.height = HEIGHT;
    const ctx = canvas.getContext('2d');

    // White background
    ctx.fillStyle = '#ffffff';
    ctx.fillRect(0, 0, WIDTH, HEIGHT);

    // Header gradient
    const headerH = 300 * SCALE;
    const grd = ctx.createLinearGradient(0, headerH, WIDTH, 0);
    grd.addColorStop(0, '#ff6600');
    grd.addColorStop(1, '#e55a00');
    ctx.fillStyle = grd;
    ctx.fillRect(0, 0, WIDTH, headerH);

    // Left panel
    const leftW = 297.5 * SCALE;
    ctx.fillStyle = 'rgba(255,255,255,0.95)';
    ctx.fillRect(0, 0, leftW, headerH);

    // Title
    ctx.fillStyle = '#2d3748';
    ctx.font = `600 ${32 * SCALE}px 'Helvetica Neue'`;
    const titleWrap = wrapText(ctx, event.event_title, 30*SCALE, 70*SCALE, leftW-60*SCALE, 38*SCALE);
    titleWrap.lines.forEach(l => ctx.fillText(l[0], l[1], l[2]));

    // Subtitle
    ctx.fillStyle = '#4a5568';
    ctx.font = `400 ${24 * SCALE}px 'Helvetica Neue'`;
    const subY = titleWrap.height + 82*SCALE;
    const subWrap = wrapText(ctx, event.event_subtitle, 30*SCALE, subY, leftW-60*SCALE, 30*SCALE);
    subWrap.lines.forEach(l => ctx.fillText(l[0], l[1], l[2]));

    // Key Image
    if (event.image_url) {
        const b64 = await loadImageAsBase64(event.image_url);
        if (b64) {
            const img = new Image();
            img.src = b64;
            await new Promise(r => img.onload = r);
            ctx.drawImage(img, leftW, 0, leftW, headerH);
        }
    }

    // About Box
    const aboutY = 300 * SCALE;
    const aboutW = 520 * SCALE;
    const aboutX = (WIDTH - aboutW) / 2;
    ctx.fillStyle = 'rgba(255,255,255,0.96)';
    ctx.shadowColor = 'rgba(0,0,0,0.14)';
    ctx.shadowBlur = 24 * SCALE;
    ctx.shadowOffsetY = 8 * SCALE;
    roundRect(ctx, aboutX, aboutY, aboutW, 300*SCALE, 18*SCALE);
    ctx.fill();
    ctx.shadowColor = 'transparent';

    // About Title
    ctx.fillStyle = '#2d3748';
    ctx.font = `bold ${26 * SCALE}px 'Helvetica Neue'`;
    ctx.fillText('About This Event', aboutX + 24*SCALE, aboutY + 50*SCALE);
    ctx.strokeStyle = '#ff6600';
    ctx.lineWidth = 2*SCALE;
    ctx.beginPath();
    ctx.moveTo(aboutX + 24*SCALE, aboutY + 60*SCALE);
    ctx.lineTo(aboutX + 24*SCALE + ctx.measureText('About This Event').width, aboutY + 60*SCALE);
    ctx.stroke();

    // Bullets
    const bullets = (event.description||'').split('\n').map(l=>l.trim()).filter(l=>l).slice(0,3);
    ctx.fillStyle = '#4a5568';
    ctx.font = `${16 * SCALE}px 'Helvetica Neue'`;
    let bulletY = aboutY + 90*SCALE;
    bullets.forEach(txt => {
        ctx.fillText('• ' + txt, aboutX + 52*SCALE, bulletY);
        bulletY += 24*SCALE;
    });

    // Bottom Panel
    const bottomY = HEIGHT - 170*SCALE;
    const infoW = 350 * SCALE;
    const infoX = event.qr_code_url ? (WIDTH - 520*SCALE)/2 + 150*SCALE : (WIDTH - infoW)/2;
    const infoGrd = ctx.createLinearGradient(0, bottomY + 40*SCALE, 0, bottomY + 150*SCALE);
    infoGrd.addColorStop(0, '#f8f9fa'); infoGrd.addColorStop(1, '#e9ecef');
    ctx.fillStyle = infoGrd;
    roundRect(ctx, infoX, bottomY, infoW, 110*SCALE, 18*SCALE);
    ctx.fill();
    ctx.strokeStyle = '#dee2e6';
    ctx.lineWidth = SCALE;
    ctx.stroke();

    // Icons + text
    const iconSize = 20*SCALE;
    let curY = bottomY + 30*SCALE;
    await drawIcon(ctx, svgIcons.calendar, infoX + 20*SCALE, curY, iconSize);
    ctx.fillStyle = '#2d3748';
    ctx.font = `500 ${16*SCALE}px 'Helvetica Neue'`;
    ctx.fillText(formatDate(event.event_date), infoX + 52*SCALE, curY + 18*SCALE);
    curY += 28*SCALE;

    await drawIcon(ctx, svgIcons.clock, infoX + 20*SCALE, curY, iconSize);
    const time = event.end_time ? `${formatTime(event.event_time)} - ${formatTime(event.end_time)}` : formatTime(event.event_time);
    ctx.fillText(time, infoX + 52*SCALE, curY + 18*SCALE);
    curY += 28*SCALE;

    await drawIcon(ctx, svgIcons.location, infoX + 20*SCALE, curY, iconSize);
    const locWrap = wrapText(ctx, event.location, infoX + 52*SCALE, curY + 18*SCALE, infoW - 72*SCALE, 24*SCALE);
    locWrap.lines.forEach(l => ctx.fillText(l[0], l[1], l[2]));

    // QR Code
    if (event.qr_code_url) {
        const qrUrl = `https://api.qrserver.com/v1/create-qr-code/?size=130x130&data=${encodeURIComponent(event.qr_code_url)}`;
        const b64 = await loadImageAsBase64(qrUrl);
        if (b64) {
            const img = new Image();
            img.src = b64;
            await new Promise(r => img.onload = r);
            const qrX = (WIDTH - 520*SCALE)/2;
            ctx.fillStyle = '#ffffff';
            roundRect(ctx, qrX, bottomY, 130*SCALE, 130*SCALE, 14*SCALE);
            ctx.fill();
            ctx.strokeStyle = '#dee2e6';
            ctx.lineWidth = SCALE;
            ctx.stroke();
            ctx.drawImage(img, qrX + 10*SCALE, bottomY + 10*SCALE, 110*SCALE, 110*SCALE);
        }
    }

    // Footer
    const footerUrl = "https://www.compassoffices.com/wp-content/uploads/2025/10/poster-footer-1.jpg";
    const footerB64 = await loadImageAsBase64(footerUrl);
    if (footerB64) {
        const img = new Image();
        img.src = footerB64;
        await new Promise(r => img.onload = r);
        ctx.drawImage(img, 0, HEIGHT - 70*SCALE, WIDTH, 70*SCALE);
    }

    return canvas;
}

// Helpers
function wrapText(ctx, text, x, y, maxW, lineH) {
    const words = text.split(' ');
    let line = '', lines = [], curY = y;
    for (let w of words) {
        const test = line + w + ' ';
        if (ctx.measureText(test).width > maxW && line) {
            lines.push([line.trim(), x, curY]);
            curY += lineH;
            line = w + ' ';
        } else line = test;
    }
    if (line) lines.push([line.trim(), x, curY]);
    return {lines, height: curY - y + lineH};
}
function roundRect(ctx, x, y, w, h, r) {
    ctx.beginPath();
    ctx.moveTo(x + r, y);
    ctx.arcTo(x + w, y, x + w, y + h, r);
    ctx.arcTo(x + w, y + h, x, y + h, r);
    ctx.arcTo(x, y + h, x, y, r);
    ctx.arcTo(x, y, x + w, y, r);
    ctx.closePath();
}
async function drawIcon(ctx, url, x, y, size) {
    const img = new Image();
    img.src = url;
    await new Promise(r => img.onload = r);
    ctx.drawImage(img, x, y, size, size);
}
function formatDate(d){if(!d)return'TBD';return new Date(d).toLocaleDateString('en-US',{weekday:'short',year:'numeric',month:'short',day:'numeric'});}
function formatTime(t){if(!t)return'TBD';const[h,m]=t.split(':');const dt=new Date();dt.setHours(+h,+m);return dt.toLocaleTimeString('en-US',{hour:'numeric',minute:'2-digit',hour12:true});}
function showSuccess(m){const el=document.createElement('div');el.className='fixed top-4 right-4 px-6 py-3 rounded-lg bg-green-500 text-white font-medium z-50';el.textContent=m;document.body.appendChild(el);setTimeout(()=>el.remove(),3000);}
function showError(m){const el=document.createElement('div');el.className='fixed top-4 right-4 px-6 py-3 rounded-lg bg-red-500 text-white font-medium z-50';el.textContent=m;document.body.appendChild(el);setTimeout(()=>el.remove(),3000);}

// ==================== DOWNLOAD ====================
async function capturePoster() {
    const btn = document.getElementById('downloadPoster');
    const orig = btn.innerHTML;
    btn.innerHTML = '<div class="loading-spinner inline-block mr-2"></div>Generating...';
    btn.disabled = true;

    try {
        updateLivePreview();
        await new Promise(r => setTimeout(r, 500));

        const event = {
            event_title: document.getElementById('event_title').value || 'Summer Music Festival',
            event_subtitle: document.getElementById('event_subtitle').value || 'A Night of Music and Fun',
            event_date: document.getElementById('event_date').value || '2025-07-15',
            event_time: document.getElementById('event_time').value || '18:00',
            end_time: document.getElementById('end_time').value || '22:00',
            location: document.getElementById('location').value || 'Central Park, New York',
            description: document.getElementById('description').value || '',
            image_url: document.getElementById('image_url').value || '',
            qr_code_url: document.getElementById('qr_code_url').value || ''
        };

        const canvas = await drawPosterOnCanvas(event);
        const url = canvas.toDataURL('image/jpeg', 0.98);
        const a = document.createElement('a');
        a.href = url;
        a.download = 'event-poster-a4-300dpi.jpg';
        a.click();

        showSuccess('Downloaded – 100% match!');
    } catch (e) {
        console.error(e);
        showError('Download failed. Try again.');
    } finally {
        btn.innerHTML = orig;
        btn.disabled = false;
    }
}

// ==================== LIVE PREVIEW ====================
function updateLivePreview() {
    const data = {
        event_title: document.getElementById('event_title').value || 'Summer Music Festival',
        event_subtitle: document.getElementById('event_subtitle').value || 'A Night of Music and Fun',
        event_date: document.getElementById('event_date').value || '2025-07-15',
        event_time: document.getElementById('event_time').value || '18:00',
        end_time: document.getElementById('end_time').value || '22:00',
        location: document.getElementById('location').value || 'Central Park, New York',
        description: document.getElementById('description').value || '',
        image_url: document.getElementById('image_url').value || '',
        qr_code_url: document.getElementById('qr_code_url').value || ''
    };
    const qr = data.qr_code_url ? `https://api.qrserver.com/v1/create-qr-code/?size=130x130&data=${encodeURIComponent(data.qr_code_url)}` : '';
    const bullets = (data.description||'').split('\n').map(l=>l.trim()).filter(l=>l).slice(0,3)
                     .map(t=>`<li style="margin:8px 0;line-height:1.5;font-size:16px;color:#4a5568;">${escapeHtml(t)}</li>`).join('');
    document.getElementById('posterPreview').innerHTML = `
<div id="posterRoot" style="width:595px;height:843px;background:white;position:relative;overflow:hidden;font-family:'Helvetica Neue';">
    <div class="grid-overlay"></div>
    <div style="width:595px;height:300px;background:linear-gradient(135deg,#ff6600 0%,#e55a00 100%);display:flex;">
        <div style="width:297.5px;height:300px;background:rgba(255,255,255,.95);padding:30px 20px;display:flex;flex-direction:column;justify-content:center;">
            <div style="font-size:32px;line-height:1.2;color:#2d3748;font-weight:600;max-height:120px;overflow:hidden;">${escapeHtml(data.event_title)}</div>
            <div style="font-size:24px;line-height:1.2;color:#4a5568;margin-top:12px;font-weight:400;max-height:80px;overflow:hidden;">${escapeHtml(data.event_subtitle)}</div>
        </div>
        <div style="width:297.5px;height:300px;background:#f8f9fa;overflow:hidden;">
            ${data.image_url?`<img src="${data.image_url}" style="width:100%;height:100%;object-fit:cover;" onerror="this.style.display='none'">`:
            `<div style="display:flex;align-items:center;justify-content:center;height:100%;color:#666;font-size:16px;">Image</div>`}
        </div>
    </div>
    <div style="position:absolute;top:300px;left:50%;transform:translateX(-50%);width:520px;background:rgba(255,255,255,.96);padding:24px;border-radius:18px;box-shadow:0 8px 24px rgba(0,0,0,.14);">
        <h2 style="font-size:26px;font-weight:bold;margin:0 0 16px;color:#2d3748;border-bottom:2px solid #ff6600;padding-bottom:10px;display:inline-block;">About This Event</h2>
        <ul style="margin:0;padding-left:28px;list-style:disc;">${bullets||'<li style="color:#9ca3af;font-size:16px;">No description provided.</li>'}</ul>
    </div>
    <div style="position:absolute;bottom:100px;left:50%;transform:translateX(-50%);width:${data.qr_code_url?'520px':'400px'};display:flex;${data.qr_code_url?'justify-content:space-between;':'justify-content:center;'}align-items:flex-start;">
        ${data.qr_code_url?`<div style="width:130px;height:130px;background:white;padding:10px;border-radius:14px;box-shadow:0 6px 16px rgba(0,0,0,.12);border:1px solid #dee2e6;">
            <img src="${qr}" style="width:100%;height:100%;object-fit:contain;" onerror="this.style.display='none'">
        </div>`:''}
        <div style="background:linear-gradient(135deg,#f8f9fa 0%,#e9ecef 100%);padding:20px;border-radius:18px;border:1px solid #dee2e6;box-shadow:0 6px 16px rgba(0,0,0,.1);width:350px;">
            <div style="display:flex;align-items:center;margin-bottom:12px;">
                <img src="${svgIcons.calendar}" style="width:20px;height:20px;margin-right:12px;">
                <div style="font-size:16px;color:#2d3748;font-weight:500;">${formatDate(data.event_date)}</div>
            </div>
            <div style="display:flex;align-items:center;margin-bottom:12px;">
                <img src="${svgIcons.clock}" style="width:20px;height:20px;margin-right:12px;">
                <div style="font-size:16px;color:#2d3748;font-weight:500;">${data.end_time?`${formatTime(data.event_time)} - ${formatTime(data.end_time)}`:formatTime(data.event_time)}</div>
            </div>
            <div style="display:flex;align-items:flex-start;">
                <img src="${svgIcons.location}" style="width:20px;height:20px;margin-right:12px;">
                <div style="font-size:16px;color:#2d3748;font-weight:500;line-height:1.5;">${escapeHtml(data.location)}</div>
            </div>
        </div>
    </div>
    <div style="position:absolute;bottom:0;left:0;width:595px;height:70px;background:white;display:flex;align-items:center;justify-content:center;">
        <img src="https://www.compassoffices.com/wp-content/uploads/2025/10/poster-footer-1.jpg" style="width:100%;height:auto;max-height:100%;object-fit:contain;">
    </div>
</div>`;
}
function escapeHtml(t){const d=document.createElement('div');d.textContent=t;return d.innerHTML;}

// ==================== INIT ====================
document.addEventListener('DOMContentLoaded', () => {
    updateLivePreview();
    document.getElementById('downloadPoster').onclick = capturePoster;
    document.querySelectorAll('#eventForm input, #eventForm textarea').forEach(el => el.addEventListener('input', updateLivePreview));
    enforceWordLimit(document.getElementById('event_title'), MAX_TITLE_WORDS, document.getElementById('titleWordCount'));
    enforceWordLimit(document.getElementById('event_subtitle'), MAX_SUBTITLE_WORDS, document.getElementById('subtitleWordCount'));
    enforceBulletLimit(document.getElementById('description'), document.getElementById('descBulletCount'));
    setTimeout(updateLivePreview, 200);
});
</script>
</body>
</html>
