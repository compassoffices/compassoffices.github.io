<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Drag Collage Editor</title>
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      background: #fff;
      padding: 2rem;
      color: #000;
    }
    .container {
      max-width: 1080px;
      margin: 0 auto;
    }
    .dropzones {
      display: flex;
      flex-direction: column;
      gap: 1rem;
      margin-bottom: 2rem;
    }
    .dropzone {
      border: 2px dashed #000;
      padding: 2rem;
      text-align: center;
      position: relative;
      cursor: pointer;
      background: #f9f9f9;
    }
    .dropzone.dragover {
      background: #e0e0e0;
    }
    canvas {
      border: 1px solid #000;
      width: 100%;
      max-width: 100%;
      cursor: move;
      user-select: none;
    }
    .download-link {
      display: inline-block;
      margin-top: 1rem;
      padding: 0.5rem 1rem;
      background: #000;
      color: #fff;
      text-decoration: none;
      border-radius: 6px;
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="dropzones">
      <div class="dropzone" id="drop1">Drop Image 1 Here</div>
      <div class="dropzone" id="drop2">Drop Image 2 Here</div>
      <div class="dropzone" id="drop3">Drop Image 3 Here</div>
    </div>
    <canvas id="collageCanvas" width="1080" height="1080"></canvas>
    <a id="downloadLink" class="download-link" href="#" download="collage.jpg" style="display:none">Download Collage</a>
  </div>

  <script>
    const canvas = document.getElementById('collageCanvas');
    const ctx = canvas.getContext('2d');
    const downloadLink = document.getElementById('downloadLink');

    const dropZones = [
      document.getElementById('drop1'),
      document.getElementById('drop2'),
      document.getElementById('drop3')
    ];

    const images = [null, null, null];
    const offsets = [
      { x: 0, y: 0 }, // image 1
      { x: 0, y: 0 }, // image 2
      { x: 0, y: 0 }  // image 3
    ];
    const positions = [
      { x: 10, y: 10, w: 1060, h: 530 },  // top image
      { x: 10, y: 550, w: 525, h: 520 },  // bottom left
      { x: 545, y: 550, w: 525, h: 520 }  // bottom right
    ];
    let dragging = null;
    let dragStart = { x: 0, y: 0 };

    dropZones.forEach((dropZone, index) => {
      dropZone.addEventListener('dragover', (e) => {
        e.preventDefault();
        dropZone.classList.add('dragover');
      });
      dropZone.addEventListener('dragleave', () => {
        dropZone.classList.remove('dragover');
      });
      dropZone.addEventListener('drop', (e) => {
        e.preventDefault();
        dropZone.classList.remove('dragover');
        const file = e.dataTransfer.files[0];
        if (file && file.type.startsWith('image/')) {
          const reader = new FileReader();
          reader.onload = () => {
            const img = new Image();
            img.onload = () => {
              images[index] = img;
              offsets[index] = { x: 0, y: 0 };
              render();
              downloadLink.style.display = "inline-block";
            };
            img.src = reader.result;
          };
          reader.readAsDataURL(file);
        }
      });
    });

    function render() {
      ctx.fillStyle = '#fff';
      ctx.fillRect(0, 0, canvas.width, canvas.height);

      for (let i = 0; i < 3; i++) {
        if (!images[i]) continue;

        const pos = positions[i];
        const offset = offsets[i];
        const img = images[i];

        // Maintain aspect ratio:
        const scale = Math.min(pos.w / img.width, pos.h / img.height);
        const drawW = img.width * scale;
        const drawH = img.height * scale;

        const cx = pos.x + offset.x + (pos.w - drawW) / 2;
        const cy = pos.y + offset.y + (pos.h - drawH) / 2;

        ctx.fillStyle = "#fff";
        ctx.fillRect(pos.x - 5, pos.y - 5, pos.w + 10, pos.h + 10); // white border

        ctx.drawImage(img, cx, cy, drawW, drawH);
      }
    }

    canvas.addEventListener('mousedown', (e) => {
      const rect = canvas.getBoundingClientRect();
      const x = e.clientX - rect.left;
      const y = e.clientY - rect.top;

      for (let i = 0; i < 3; i++) {
        if (!images[i]) continue;
        const pos = positions[i];
        if (x >= pos.x && x <= pos.x + pos.w && y >= pos.y && y <= pos.y + pos.h) {
          dragging = i;
          dragStart = { x, y };
          break;
        }
      }
    });

    canvas.addEventListener('mousemove', (e) => {
      if (dragging === null) return;
      const rect = canvas.getBoundingClientRect();
      const x = e.clientX - rect.left;
      const y = e.clientY - rect.top;
      const dx = x - dragStart.x;
      const dy = y - dragStart.y;
      dragStart = { x, y };
      offsets[dragging].x += dx;
      offsets[dragging].y += dy;
      render();
    });

    canvas.addEventListener('mouseup', () => {
      dragging = null;
    });

    canvas.addEventListener('mouseleave', () => {
      dragging = null;
    });

    downloadLink.addEventListener('click', () => {
      const dataURL = canvas.toDataURL('image/jpeg', 0.9);
      downloadLink.href = dataURL;
    });
  </script>
</body>
</html>
