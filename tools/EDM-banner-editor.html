<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Pro Image Editor</title>
  <link href="https://fonts.cdnfonts.com/css/neue-haas-grotesk-display-pro" rel="stylesheet">
  <style>
    * { 
      box-sizing: border-box; 
      margin: 0;
      padding: 0;
    }
    body {
      font-family: 'Neue Haas Grotesk Display Pro', sans-serif;
      padding: 2rem;
      background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
      color: #2d3748;
      min-height: 100vh;
      display: flex;
      justify-content: center;
      align-items: flex-start;
    }
    .editor {
      max-width: 900px;
      width: 100%;
      background: #ffffff;
      padding: 2rem;
      border-radius: 16px;
      box-shadow: 0 4px 30px rgba(0,0,0,0.1);
      transition: transform 0.3s ease;
    }
    .editor:hover {
      transform: translateY(-2px);
    }
    h2 {
      font-size: 1.8rem;
      margin-bottom: 1.5rem;
      color: #1a202c;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }
    h3 {
      font-size: 1.2rem;
      margin: 1.5rem 0 1rem;
      color: #2d3748;
    }
    canvas {
      display: block;
      max-width: 100%;
      height: auto;
      margin: 1.5rem auto;
      border-radius: 8px;
      border: 1px solid #e2e8f0;
      background: #f7fafc;
    }
    .row {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 1rem;
      margin-bottom: 1.5rem;
    }
    label {
      display: flex;
      flex-direction: column;
      font-size: 0.9rem;
      font-weight: 500;
      color: #4a5568;
    }
    input, select, textarea {
      width: 100%;
      padding: 0.5rem;
      margin-top: 0.3rem;
      border: 1px solid #e2e8f0;
      border-radius: 6px;
      font-size: 0.9rem;
      transition: border-color 0.2s ease;
    }
    input:focus, select:focus, textarea:focus {
      outline: none;
      border-color: #4c51bf;
      box-shadow: 0 0 0 2px rgba(76,81,191,0.2);
    }
    textarea {
      height: 80px;
      resize: vertical;
    }
    .btn {
      padding: 0.8rem 2rem;
      background: #4c51bf;
      color: #fff;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-size: 1rem;
      font-weight: 500;
      transition: background 0.3s ease;
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
    }
    .btn:hover {
      background: #434190;
    }
    .image-controls {
      display: flex;
      gap: 0.8rem;
      align-items: center;
      margin: 1rem 0;
    }
    .image-controls strong {
      font-weight: 500;
      color: #4a5568;
    }
    .image-controls button {
      padding: 0.5rem;
      font-size: 1rem;
      background: #edf2f7;
      border: 1px solid #e2e8f0;
      border-radius: 6px;
      cursor: pointer;
      transition: background 0.2s ease;
    }
    .image-controls button:hover {
      background: #e2e8f0;
    }
  </style>
</head>
<body>
<div class="editor">
  <h2>üñºÔ∏è Pro Image Text Editor</h2>

  <div class="row">
    <label>Layout Size:
      <select id="layoutSelect">
        <option value="680x200">680√ó200</option>
        <option value="680x150">680√ó150</option>
        <option value="680x300">680√ó300</option>
      </select>
    </label>
    <label>Overlay Effect:
      <select id="overlayEffect">
        <option value="none">None</option>
        <option value="gradient">Black Gradient</option>
        <option value="dark">Dark Transparent</option>
      </select>
    </label>
    <label>Overlay Opacity:
      <input type="range" id="overlayOpacity" min="0.1" max="1" step="0.1" value="0.7" />
    </label>
  </div>

  <label>Upload Image:</label>
  <input type="file" id="uploadImage" accept="image/*" />

  <label>Zoom Image:</label>
  <input type="range" id="zoomSlider" min="0.05" max="5" step="0.05" value="1" />

  <div class="image-controls">
    <strong>Move Image:</strong>
    <button onclick="moveImage(0, -20)">‚¨ÜÔ∏è</button>
    <button onclick="moveImage(0, 20)">‚¨áÔ∏è</button>
    <button onclick="moveImage(-20, 0)">‚¨ÖÔ∏è</button>
    <button onclick="moveImage(20, 0)">‚û°Ô∏è</button>
  </div>

  <canvas id="editorCanvas"></canvas>

  <h3>üìù Text 1</h3>
  <textarea id="text1" placeholder="Text 1..."></textarea>
  <div class="row">
    <label>Size <input type="range" id="textSize1" min="10" max="80" value="24" /></label>
    <label>Color <input type="color" id="textColor1" value="#ffffff" /></label>
    <label>Align
      <select id="textAlign1">
        <option value="center">Center</option>
        <option value="left">Left</option>
        <option value="right">Right</option>
      </select>
    </label>
    <label>Weight
      <select id="fontWeight1">
        <option value="normal">Light</option>
        <option value="bold">Bold</option>
      </select>
    </label>
    <label>Shadow <input type="checkbox" id="shadow1" checked /></label>
    <label>Shadow Color <input type="color" id="shadowColor1" value="#000000" /></label>
    <label>Shadow X <input type="range" id="shadowX1" min="-20" max="20" value="2" /></label>
    <label>Shadow Y <input type="range" id="shadowY1" min="-20" max="20" value="2" /></label>
    <label>Shadow Blur <input type="range" id="shadowBlur1" min="0" max="50" value="4" /></label>
  </div>

  <h3>üìù Text 2</h3>
  <textarea id="text2" placeholder="Text 2..."></textarea>
  <div class="row">
    <label>Size <input type="range" id="textSize2" min="10" max="80" value="24" /></label>
    <label>Color <input type="color" id="textColor2" value="#ffffff" /></label>
    <label>Align
      <select id="textAlign2">
        <option value="center">Center</option>
        <option value="left">Left</option>
        <option value="right">Right</option>
      </select>
    </label>
    <label>Weight
      <select id="fontWeight2">
        <option value="normal">Light</option>
        <option value="bold">Bold</option>
      </select>
    </label>
    <label>Shadow <input type="checkbox" id="shadow2" checked /></label>
    <label>Shadow Color <input type="color" id="shadowColor2" value="#000000" /></label>
    <label>Shadow X <input type="range" id="shadowX2" min="-20" max="20" value="2" /></label>
    <label>Shadow Y <input type="range" id="shadowY2" min="-20" max="20" value="2" /></label>
    <label>Shadow Blur <input type="range" id="shadowBlur2" min="0" max="50" value="4" /></label>
  </div>

  <button class="btn" onclick="downloadImage()">‚¨áÔ∏è Download Image</button>
</div>

<script>
  const canvas = document.getElementById('editorCanvas');
  const ctx = canvas.getContext('2d');

  const layoutSelect = document.getElementById('layoutSelect');
  const overlayEffect = document.getElementById('overlayEffect');
  const overlayOpacity = document.getElementById('overlayOpacity');
  const uploadImage = document.getElementById('uploadImage');
  const zoomSlider = document.getElementById('zoomSlider');

  const text1 = document.getElementById('text1');
  const textSize1 = document.getElementById('textSize1');
  const textColor1 = document.getElementById('textColor1');
  const textAlign1 = document.getElementById('textAlign1');
  const fontWeight1 = document.getElementById('fontWeight1');
  const shadow1 = document.getElementById('shadow1');
  const shadowColor1 = document.getElementById('shadowColor1');
  const shadowX1 = document.getElementById('shadowX1');
  const shadowY1 = document.getElementById('shadowY1');
  const shadowBlur1 = document.getElementById('shadowBlur1');

  const text2 = document.getElementById('text2');
  const textSize2 = document.getElementById('textSize2');
  const textColor2 = document.getElementById('textColor2');
  const textAlign2 = document.getElementById('textAlign2');
  const fontWeight2 = document.getElementById('fontWeight2');
  const shadow2 = document.getElementById('shadow2');
  const shadowColor2 = document.getElementById('shadowColor2');
  const shadowX2 = document.getElementById('shadowX2');
  const shadowY2 = document.getElementById('shadowY2');
  const shadowBlur2 = document.getElementById('shadowBlur2');

  let image = null;
  let zoom = 1;
  let offset = { x: 0, y: 0 };
  let textPos1 = { x: 340, y: 80 };
  let textPos2 = { x: 340, y: 140 };
  let draggingText = null;
  let dragging = false;
  let dragStart = { x: 0, y: 0 };

  function setCanvasSize() {
    const [w, h] = layoutSelect.value.split('x').map(Number);
    const scale = 2;

    // Update canvas dimensions
    canvas.width = w * scale;
    canvas.height = h * scale;
    canvas.style.width = `${w}px`;
    canvas.style.height = `${h}px`;

    // Reset zoom and positions
    zoom = 1;
    zoomSlider.value = 1;
    offset = { x: 0, y: 0 };
    textPos1 = { x: canvas.width / 2, y: canvas.height * 0.4 };
    textPos2 = { x: canvas.width / 2, y: canvas.height * 0.7 };

    // Force render
    render();
  }

  function drawTextBlock(text, size, color, align, weight, pos, shadowEnabled, shadowOptions) {
    if (!text) return; // Skip if text is empty
    ctx.save();
    if (shadowEnabled) {
      ctx.shadowColor = shadowOptions.color;
      ctx.shadowOffsetX = shadowOptions.x;
      ctx.shadowOffsetY = shadowOptions.y;
      ctx.shadowBlur = shadowOptions.blur;
    }
    ctx.fillStyle = color;
    ctx.font = `${weight} ${size * 2}px 'Neue Haas Grotesk Display Pro', sans-serif`;
    ctx.textAlign = align;
    ctx.textBaseline = 'middle';

    const x = align === 'center' ? pos.x : align === 'left' ? 40 : canvas.width - 40;
    const y = pos.y;
    const lines = text.split('\n');
    lines.forEach((line, i) => ctx.fillText(line, x, y + i * size * 2));
    ctx.restore();
  }

  function render() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);

    if (image) {
      const iw = image.width * zoom;
      const ih = image.height * zoom;
      const dx = (canvas.width - iw) / 2 + offset.x;
      const dy = (canvas.height - ih) / 2 + offset.y;
      ctx.drawImage(image, dx, dy, iw, ih);
    }

    const opacity = parseFloat(overlayOpacity.value);
    if (overlayEffect.value === 'dark') {
      ctx.fillStyle = `rgba(0,0,0,${opacity})`;
      ctx.fillRect(0, 0, canvas.width, canvas.height);
    } else if (overlayEffect.value === 'gradient') {
      const grad = ctx.createLinearGradient(0, canvas.height, 0, 0);
      grad.addColorStop(0, `rgba(0,0,0,${opacity})`);
      grad.addColorStop(1, 'rgba(0,0,0,0)');
      ctx.fillStyle = grad;
      ctx.fillRect(0, 0, canvas.width, canvas.height);
    }

    drawTextBlock(text1.value, parseFloat(textSize1.value), textColor1.value, textAlign1.value, fontWeight1.value, textPos1,
      shadow1.checked, {
        color: shadowColor1.value,
        x: parseFloat(shadowX1.value),
        y: parseFloat(shadowY1.value),
        blur: parseFloat(shadowBlur1.value)
      });

    drawTextBlock(text2.value, parseFloat(textSize2.value), textColor2.value, textAlign2.value, fontWeight2.value, textPos2,
      shadow2.checked, {
        color: shadowColor2.value,
        x: parseFloat(shadowX2.value),
        y: parseFloat(shadowY2.value),
        blur: parseFloat(shadowBlur2.value)
      });
  }

  function moveImage(dx, dy) {
    offset.x += dx * 2;
    offset.y += dy * 2;
    render();
  }

  function insideText(pos, mouseX, mouseY, size) {
    return mouseX >= pos.x - 200 && mouseX <= pos.x + 200 &&
           mouseY >= pos.y - size && mouseY <= pos.y + size * 2;
  }

  canvas.addEventListener('mousedown', e => {
    const rect = canvas.getBoundingClientRect();
    const x = (e.clientX - rect.left) * 2;
    const y = (e.clientY - rect.top) * 2;
    if (insideText(textPos1, x, y, parseFloat(textSize1.value))) {
      draggingText = 'text1';
    } else if (insideText(textPos2, x, y, parseFloat(textSize2.value))) {
      draggingText = 'text2';
    }
    dragStart = { x, y };
    dragging = true;
  });

  canvas.addEventListener('mousemove', e => {
    if (!dragging || !draggingText) return;
    const rect = canvas.getBoundingClientRect();
    const x = (e.clientX - rect.left) * 2;
    const y = (e.clientY - rect.top) * 2;
    const dx = x - dragStart.x;
    const dy = y - dragStart.y;
    dragStart = { x, y };
    if (draggingText === 'text1') {
      textPos1.x += dx;
      textPos1.y += dy;
    } else if (draggingText === 'text2') {
      textPos2.x += dx;
      textPos2.y += dy;
    }
    render();
  });

  canvas.addEventListener('mouseup', () => {
    dragging = false;
    draggingText = null;
  });
  canvas.addEventListener('mouseleave', () => {
    dragging = false;
    draggingText = null;
  });

  function downloadImage() {
    const now = new Date().toISOString().replace(/[:.]/g, '-');
    const link = document.createElement('a');
    link.download = `image-${layoutSelect.value}-${now}.jpg`;
    link.href = canvas.toDataURL('image/jpeg', 1.0);
    link.click();
  }

  uploadImage.addEventListener('change', e => {
    const file = e.target.files[0];
    if (!file || !file.type.startsWith('image/')) return;
    const reader = new FileReader();
    reader.onload = () => {
      const img = new Image();
      img.onload = () => {
        image = img;
        render();
      };
      img.src = reader.result;
    };
    reader.readAsDataURL(file);
  });

  zoomSlider.addEventListener('input', () => {
    zoom = parseFloat(zoomSlider.value);
    render();
  });

  layoutSelect.addEventListener('change', setCanvasSize); // Explicitly handle layout change

  [
    overlayEffect, overlayOpacity,
    text1, textSize1, textColor1, textAlign1, fontWeight1,
    shadow1, shadowColor1, shadowX1, shadowY1, shadowBlur1,
    text2, textSize2, textColor2, textAlign2, fontWeight2,
    shadow2, shadowColor2, shadowX2, shadowY2, shadowBlur2
  ].forEach(el => el.addEventListener('input', render));

  setCanvasSize();
</script>
</body>
</html>
