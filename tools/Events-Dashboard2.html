<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="icon" type="image/png" href="https://www.compassoffices.com/wp-content/uploads/2025/09/compassoffices-logo-web-2025_icon-o-scaled.png">
<title>Compass Events Dashboard</title>
<style>
body {
box-sizing: border-box;
font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
margin: 0;
padding: 20px;
background: #000;
min-height: 100vh;
}
.container {
max-width: 1200px;
margin: 0 auto;
box-shadow: 0 20px 40px rgba(0,0,0,0.1);
overflow: hidden;
padding-bottom: 40px;
}
.logo-banner {
width: 100%;
background: #000;
display: flex;
justify-content: center;
align-items: center;
padding: 16px 0 10px 0;
}
.logo-banner img {
height: 50px;
width: auto;
filter: brightness(100%) contrast(110%);
max-width: 260px;
}
.header {
background: #000;
color: #fff;
padding: 30px 30px 15px 30px;
text-align: center;
position: relative;
}
.header h1 {
margin: 0 0 5px 0;
font-size: 2.3rem;
font-weight: 700;
color: #fff;
}
.header p {
margin: 5px 0 0 0;
font-size: 1.1rem;
opacity: 0.9;
color: #ff6600;
font-weight: 600;
letter-spacing: 0.02em;
}
.event-count {
margin: 12px 0 0 0;
font-size: 1.05rem;
color: #fff;
opacity: 0.85;
font-weight: 500;
}
.selector-group {
margin: 22px 0 0 0;
display: flex;
justify-content: center;
align-items: center;
gap: 15px;
flex-wrap: wrap;
}
.selector-group label {
font-weight: 600;
font-size: 1rem;
color: #fff;
}
.selector-group select {
background: #111;
border: 2px solid #ff6600;
color: #ff6600;
padding: 10px 15px;
border-radius: 25px;
font-size: 1rem;
font-weight: 500;
cursor: pointer;
transition: all 0.3s ease;
outline: none;
}
.selector-group select:focus,
.selector-group select:hover {
background: #ff6600;
color: #fff;
border-color: #ff6600;
}
.selector-group select option {
background: #fff;
color: #222;
padding: 10px;
}
.loading,
.no-events {
text-align: center;
padding: 60px 20px;
color: #333;
font-size: 1.2rem;
}
.spinner {
border: 4px solid #eee;
border-top: 4px solid #ff6600;
border-radius: 50%;
width: 40px;
height: 40px;
animation: spin 1s linear infinite;
margin: 0 auto 20px;
}
@keyframes spin {
0% { transform: rotate(0deg); }
100% { transform: rotate(360deg); }
}
.events-container {
padding: 36px;
}
.event-card {
background: #f7f7f7;
border-radius: 14px;
padding: 25px;
margin-bottom: 24px;
border-left: 5px solid #222;
transition: all 0.3s ease;
position: relative;
box-shadow: 0 3px 16px rgba(0,0,0,0.06);
}
.event-card.today {
border-left-color: #ff6b6b;
background: #fff6f6;
border: 2px solid #ff6b6b;
box-shadow: 0 4px 16px rgba(255, 107, 107, 0.08);
}
.event-card.today .event-title {
color: #ff6b6b;
}
.event-card.upcoming {
border-left-color: #51cf66;
}
.event-date {
display: flex;
align-items: center;
margin-bottom: 15px;
}
.date-badge {
background: #222;
color: #fff;
padding: 8px 16px;
border-radius: 20px;
font-weight: 600;
font-size: 0.95rem;
margin-right: 15px;
letter-spacing: 0.03em;
}
.today .date-badge { background: #ff6b6b; }
.upcoming .date-badge { background: #51cf66; }
.event-card .date-badge { border: 2px solid #ff6600; }
.time-badge {
background: #ff6600;
color: #fff;
padding: 7px 14px;
border-radius: 15px;
font-size: 0.99rem;
font-weight: 600;
margin-left: 4px;
letter-spacing: 0.02em;
}
.event-title {
font-size: 1.36rem;
font-weight: 700;
color: #1d1d1d;
margin-bottom: 10px;
line-height: 1.22;
}
.event-details {
display: grid;
grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
gap: 15px;
margin-top: 12px;
}
.detail-item {
display: flex;
align-items: center;
min-width: 0;
}
.detail-icon {
width: 20px;
height: 20px;
margin-right: 10px;
opacity: 0.8;
color: #ff6600;
flex-shrink: 0;
}
.detail-text {
color: #222;
font-weight: 600;
word-break: break-word;
}
.calendar-container {
padding: 36px;
background: #f7f7f7;
border-radius: 14px;
margin: 0 36px;
}
.calendar-header {
display: grid;
grid-template-columns: repeat(7, 1fr);
gap: 5px;
text-align: center;
font-weight: 600;
color: #222;
padding: 10px 0;
border-bottom: 2px solid #ff6600;
}
.calendar-grid {
display: grid;
grid-template-columns: repeat(7, 1fr);
gap: 5px;
margin-top: 10px;
}
.calendar-day {
background: #fff;
border: 1px solid #ddd;
border-radius: 8px;
min-height: 100px;
padding: 10px;
position: relative;
cursor: pointer;
transition: all 0.3s ease;
overflow-y: auto;
}
.calendar-day:hover {
background: #f0f0f0;
box-shadow: 0 2px 8px rgba(0,0,0,0.1);
}
.calendar-day.today {
border: 2px solid #ff6b6b;
background: #fff6f6;
}
.calendar-day.has-events {
background: #e6f3ff;
border-color: #51cf66;
}
.day-number {
font-weight: 600;
color: #222;
margin-bottom: 5px;
}
.event-indicator {
background: #ff6600;
color: #fff;
border-radius: 12px;
padding: 2px 8px;
font-size: 0.8rem;
margin: 2px 0;
display: inline-block;
}
.event-modal {
display: none;
position: fixed;
top: 50%;
left: 50%;
transform: translate(-50%, -50%);
background: #fff;
border-radius: 14px;
padding: 25px;
box-shadow: 0 4px 16px rgba(0,0,0,0.2);
z-index: 1000;
max-width: 500px;
width: 90%;
max-height: 80vh;
overflow-y: auto;
}
.event-modal-header {
display: flex;
justify-content: space-between;
align-items: center;
margin-bottom: 20px;
}
.event-modal-header h3 {
margin: 0;
font-size: 1.5rem;
color: #222;
}
.close-modal {
background: none;
border: none;
font-size: 1.2rem;
cursor: pointer;
color: #ff6600;
}
.modal-overlay {
display: none;
position: fixed;
top: 0;
left: 0;
width: 100%;
height: 100%;
background: rgba(0,0,0,0.5);
z-index: 999;
}
.error-message {
background: #ffe6e6;
color: #d63031;
padding: 20px;
margin: 20px;
border-radius: 8px;
border-left: 4px solid #d63031;
}
.no-events h3 {
color: #999;
margin-bottom: 10px;
}
.export-button {
background: #ff6600;
color: #fff;
padding: 10px 20px;
border: none;
border-radius: 25px;
font-size: 1rem;
font-weight: 600;
cursor: pointer;
transition: all 0.3s ease;
margin: 20px auto;
display: block;
}
.export-button:hover {
background: #e65c00;
}
.location-group {
margin-bottom: 30px;
border: 1px solid #ddd;
border-radius: 10px;
overflow: hidden;
}
.location-header {
background: #ff6600;
color: #fff;
padding: 12px 16px;
font-weight: 600;
font-size: 1.1rem;
}
.location-table {
width: 100%;
border-collapse: collapse;
background: white;
}
.location-table th,
.location-table td {
border: 1px solid #ddd;
padding: 10px 12px;
text-align: left;
}
.location-table th {
background: #f0f0f0;
font-weight: 600;
}
.location-table tr:nth-child(even) {
background: #f9f9f9;
}
@media (max-width: 900px) {
.container { padding-bottom: 15px; }
.events-container { padding: 16px; }
.calendar-container { padding: 16px; margin: 0 16px; }
.calendar-day { min-height: 80px; }
}
@media (max-width: 600px) {
.container { border-radius: 0; }
.events-container { padding: 8px 2px; }
.calendar-container { padding: 8px; margin: 0 8px; }
.header { padding: 18px 6px 8px 6px; }
.event-card { padding: 16px; }
.logo-banner { padding: 11px 0 6px 0; }
.logo-banner img { height: 35px; }
.calendar-day { min-height: 60px; padding: 5px; overflow-y: auto; }
.day-number { font-size: 0.9rem; }
.event-indicator { font-size: 0.7rem; padding: 2px 6px; }
}
</style>
</head>
<body>
<main class="container">
<div class="logo-banner">
<img src="https://www.compassoffices.com/wp-content/themes/compass-offices/assets/images/compassoffices-logo-web-all-in-one-2025_ow.svg"
alt="Compass Offices Logo" />
</div>
<header class="header">
<h1>Compass Events</h1>
<p>Upcoming events and today's schedule</p>
<div id="event-count" class="event-count">Loading events...</div>
<div class="selector-group">
<div class="year-selector">
<label for="year-select">Filter by Year:</label>
<select id="year-select">
<option value="all">All Years</option>
</select>
</div>
<div class="month-selector">
<label for="month-select">Filter by Month:</label>
<select id="month-select">
<option value="all">All Months</option>
<option value="0">January</option>
<option value="1">February</option>
<option value="2">March</option>
<option value="3">April</option>
<option value="4">May</option>
<option value="5">June</option>
<option value="6">July</option>
<option value="7">August</option>
<option value="8">September</option>
<option value="9">October</option>
<option value="10">November</option>
<option value="11">December</option>
</select>
</div>
<div class="region-selector">
<label for="region-select">Filter by Region:</label>
<select id="region-select">
<option value="all">All Regions</option>
</select>
</div>
<div class="location-selector">
<label for="location-select">Filter by Location:</label>
<select id="location-select">
<option value="all">All Locations</option>
</select>
</div>
<div class="view-selector">
<label for="view-select">View:</label>
<select id="view-select">
<option value="list">List View</option>
<option value="calendar">Calendar View</option>
<option value="table">Table View</option>
</select>
</div>
</div>
</header>
<div id="loading" class="loading">
<div class="spinner"></div>
<p>Loading events...</p>
</div>
<div id="events-container" class="events-container" style="display: none;">
<div id="events-list"></div>
<button id="export-button" class="export-button" style="display: none;">Export to Email</button>
</div>
<div id="calendar-container" class="calendar-container" style="display: none;">
<div class="calendar-header">
<div>Sun</div>
<div>Mon</div>
<div>Tue</div>
<div>Wed</div>
<div>Thu</div>
<div>Fri</div>
<div>Sat</div>
</div>
<div id="calendar-grid" class="calendar-grid"></div>
</div>
<div id="error-container" style="display: none;">
<div class="error-message">
<h3>Unable to load events</h3>
<p>There was an issue fetching data from the Google Sheet. Please check the sheet URL and try again.</p>
</div>
</div>
<div id="modal-overlay" class="modal-overlay"></div>
<div id="event-modal" class="event-modal">
<div class="event-modal-header">
<h3 id="modal-date"></h3>
<button class="close-modal">X</button>
</div>
<div id="modal-events"></div>
</div>
</main>
<script>
function getCSVUrl() {
const spreadsheetId = '1vTazGFKOEPVQu77BpCHV9rTo8odUfVeH7_k0xLjio7V4bUXw__hk14JMBJu0iDC3MewNy8Hw3kowOJt';
const gid = '1632866699';
return `https://docs.google.com/spreadsheets/d/${spreadsheetId}/export?format=csv&gid=${gid}`;
}
function parseCSV(csvText) {
const lines = csvText.split('\n');
const headers = lines[0].split(',').map(h => h.trim().replace(/"/g, ''));
const data = [];
for (let i = 1; i < lines.length; i++) {
if (lines[i].trim()) {
const values = parseCSVLine(lines[i]);
const row = {};
headers.forEach((header, index) => {
row[header] = values[index] || '';
});
data.push(row);
}
}
return data;
}
function parseCSVLine(line) {
const result = [];
let current = '';
let inQuotes = false;
for (let i = 0; i < line.length; i++) {
const char = line[i];
if (char === '"') {
inQuotes = !inQuotes;
} else if (char === ',' && !inQuotes) {
result.push(current.trim());
current = '';
} else {
current += char;
}
}
result.push(current.trim());
return result;
}
function parseDate(dateStr) {
if (!dateStr) return null;
const formats = [
/(\d{1,2})\/(\d{1,2})\/(\d{4})/,
/(\d{4})-(\d{1,2})-(\d{1,2})/,
/(\d{1,2})-(\d{1,2})-(\d{4})/
];
for (const format of formats) {
const match = dateStr.match(format);
if (match) {
if (format === formats[0]) return new Date(match[3], match[2] - 1, match[1]);
else if (format === formats[1]) return new Date(match[1], match[2] - 1, match[3]);
else return new Date(match[3], match[1] - 1, match[2]);
}
}
const date = new Date(dateStr);
return isNaN(date.getTime()) ? null : date;
}
function isToday(date) {
const today = new Date();
return date.toDateString() === today.toDateString();
}
function isUpcoming(date) {
const today = new Date(); today.setHours(0, 0, 0, 0);
const eventDate = new Date(date); eventDate.setHours(0, 0, 0, 0);
return eventDate >= today;
}
function getCurrentMonth() {
return new Date().getMonth();
}
function getCurrentYear() {
return new Date().getFullYear();
}
function formatDate(date) {
return date.toLocaleDateString('en-US', {
weekday: 'short',
year: 'numeric',
month: 'short',
day: 'numeric'
});
}
function extractBaseLocation(location) {
if (!location) return 'Unknown';
const parts = location.split(',');
return parts[0].trim();
}
function createEventCard(event, eventDate) {
const todayClass = isToday(eventDate) ? 'today' : (isUpcoming(eventDate) ? 'upcoming' : '');
const dateLabel = isToday(eventDate) ? 'Today' : formatDate(eventDate);
return `
<div class="event-card ${todayClass}">
<div class="event-date">
<span class="date-badge">${dateLabel}</span>
${event.Time ? `<span class="time-badge">${event.Time}</span>` : ''}
</div>
<div class="event-title">${event['Event-Name'] || 'Untitled Event'}</div>
<div class="event-details">
${event['Client-Name']
? `<div class="detail-item">
<svg class="detail-icon" fill="currentColor" viewBox="0 0 20 20">
<path fill-rule="evenodd" d="M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z" clip-rule="evenodd"/>
</svg>
<span class="detail-text">${event['Client-Name']}</span>
</div>`
: ''}
${event.Location
? `<div class="detail-item">
<svg class="detail-icon" fill="currentColor" viewBox="0 0 20 20">
<path fill-rule="evenodd" d="M5.05 4.05a7 7 0 119.9 9.9L10 18.9l-4.95-4.95a7 7 0 010-9.9zM10 11a2 2 0 100-4 2 2 0 000 4z" clip-rule="evenodd"/>
</svg>
<span class="detail-text">${event.Location}</span>
</div>`
: ''}
</div>
</div>
`;
}
function generateCalendar(year, month, events) {
const firstDay = new Date(year, month, 1);
const lastDay = new Date(year, month + 1, 0);
const startDay = firstDay.getDay();
const daysInMonth = lastDay.getDate();
const today = new Date();
let calendarHTML = '';
let dayCount = 1;
const totalCells = Math.ceil((daysInMonth + startDay) / 7) * 7;
for (let i = 0; i < totalCells; i++) {
if (i < startDay || dayCount > daysInMonth) {
calendarHTML += `<div class="calendar-day"></div>`;
} else {
const currentDate = new Date(year, month, dayCount);
const dateStr = currentDate.toDateString();
const dayEvents = events.filter(event => event.parsedDate.toDateString() === dateStr);
const isTodayClass = isToday(currentDate) ? 'today' : '';
const hasEventsClass = dayEvents.length > 0 ? 'has-events' : '';
calendarHTML += `
<div class="calendar-day ${isTodayClass} ${hasEventsClass}" data-date="${dateStr}">
<div class="day-number">${dayCount}</div>
${dayEvents.map(event => `<div class="event-indicator">${event['Event-Name'] || 'Event'}</div>`).join('')}
</div>
`;
dayCount++;
}
}
return calendarHTML;
}
async function loadEvents() {
const csvUrl = getCSVUrl();
try {
let csvText = '';
let success = false;
try {
const response = await fetch(csvUrl, {
mode: 'cors',
headers: { 'Accept': 'text/csv,text/plain,*/*' }
});
if (response.ok) {
csvText = await response.text();
success = true;
}
} catch (e) {}
if (!success) {
try {
const altUrl = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vTazGFKOEPVQu77BpCHV9rTo8odUfVeH7_k0xLjio7V4bUXw__hk14JMBJu0iDC3MewNy8Hw3kowOJt/pub?gid=1632866699&single=true&output=csv';
const response = await fetch(altUrl, { mode: 'cors' });
if (response.ok) {
csvText = await response.text();
success = true;
}
} catch (e) {}
}
if (!success) {
csvText = `Time,Date,Client-Name,Region,Event-Name,Location,Reception,Details, trigger,Confirmed,Quarter
10:00 AM,01/10/2026,ABC Corp,Hong Kong,Annual Conference,Lee Garden 2, 16/F, Meeting room,Yes,Year-end meeting,Email,Yes,Q1
2:00 PM,01/11/2026,XYZ Ltd,Hong Kong,Product Launch,Lee Garden 2, 16/F, Lounge area,No,New product reveal,Phone,Yes,Q1
9:00 AM,01/12/2026,Tech Solutions,Singapore,Workshop,Some Place,Yes,Training session,Online,Yes,Q1
3:00 PM,01/13/2026,Global Inc,Singapore,Networking Event,Another Place,Yes,Business networking,Email,Yes,Q1`;
showSampleDataNotice();
}
const allEvents = parseCSV(csvText);
const eventsWithDates = allEvents
.map(event => ({
...event,
parsedDate: parseDate(event.Date)
}))
.filter(event => event.parsedDate);
const uniqueEvents = eventsWithDates.filter((event, index, array) => {
return index === array.findIndex(e =>
e['Event-Name'] === event['Event-Name'] &&
e.Date === event.Date &&
e.Time === event.Time &&
e['Client-Name'] === event['Client-Name']
);
});
const sortedEvents = uniqueEvents.sort((a, b) => a.parsedDate - b.parsedDate);
allEventsData = sortedEvents;
const uniqueYears = [...new Set(sortedEvents.map(e => e.parsedDate.getFullYear()).filter(y => !isNaN(y)))].sort((a, b) => a - b);
const yearSelect = document.getElementById('year-select');
uniqueYears.forEach(year => {
const option = document.createElement('option');
option.value = year;
option.textContent = year;
yearSelect.appendChild(option);
});
yearSelect.value = getCurrentYear();
const currentMonth = getCurrentMonth();
document.getElementById('month-select').value = currentMonth.toString();
updateRegionFilter();
updateLocationFilter();
filterEvents();
document.getElementById('year-select').addEventListener('change', () => {
updateRegionFilter();
updateLocationFilter();
filterEvents();
});
document.getElementById('month-select').addEventListener('change', () => {
updateRegionFilter();
updateLocationFilter();
filterEvents();
});
document.getElementById('region-select').addEventListener('change', () => {
updateLocationFilter();
filterEvents();
});
document.getElementById('location-select').addEventListener('change', filterEvents);
document.getElementById('view-select').addEventListener('change', filterEvents);
document.getElementById('export-button').addEventListener('click', exportToEmail);
} catch (error) {
showError();
}
}
let allEventsData = [];
function updateRegionFilter() {
const selectedYear = document.getElementById('year-select').value;
const selectedMonth = document.getElementById('month-select').value;
let filteredEvents = allEventsData;
if (selectedYear !== 'all') {
filteredEvents = filteredEvents.filter(event => event.parsedDate.getFullYear() === parseInt(selectedYear));
}
if (selectedMonth !== 'all') {
const monthNum = parseInt(selectedMonth);
filteredEvents = filteredEvents.filter(event => event.parsedDate.getMonth() === monthNum);
}
const uniqueRegions = [...new Set(filteredEvents.map(e => e.Region).filter(r => r))].sort();
const regionSelect = document.getElementById('region-select');
regionSelect.innerHTML = '<option value="all">All Regions</option>';
uniqueRegions.forEach(reg => {
const option = document.createElement('option');
option.value = reg;
option.textContent = reg;
regionSelect.appendChild(option);
});
}
function updateLocationFilter() {
const selectedYear = document.getElementById('year-select').value;
const selectedMonth = document.getElementById('month-select').value;
const selectedRegion = document.getElementById('region-select').value;
let filteredEvents = allEventsData;
if (selectedYear !== 'all') {
filteredEvents = filteredEvents.filter(event => event.parsedDate.getFullYear() === parseInt(selectedYear));
}
if (selectedMonth !== 'all') {
const monthNum = parseInt(selectedMonth);
filteredEvents = filteredEvents.filter(event => event.parsedDate.getMonth() === monthNum);
}
if (selectedRegion !== 'all') {
filteredEvents = filteredEvents.filter(event => event.Region === selectedRegion);
}
const uniqueLocations = [...new Set(filteredEvents.map(e => e.Location).filter(l => l))].sort();
const locationSelect = document.getElementById('location-select');
locationSelect.innerHTML = '<option value="all">All Locations</option>';
uniqueLocations.forEach(loc => {
const option = document.createElement('option');
option.value = loc;
option.textContent = loc;
locationSelect.appendChild(option);
});
}
function updateEventCount(events) {
const countEl = document.getElementById('event-count');
if (events.length === 0) {
countEl.textContent = 'No events found for the selected filters.';
} else {
const yearName = document.getElementById('year-select').value === 'all'
? 'all years'
: document.getElementById('year-select').value;
const monthName = document.getElementById('month-select').value === 'all'
? 'all months'
: new Date(0, document.getElementById('month-select').value).toLocaleString('en-US', { month: 'long' });
const regionName = document.getElementById('region-select').value === 'all'
? 'all regions'
: document.getElementById('region-select').value;
const locationName = document.getElementById('location-select').value === 'all'
? 'all locations'
: document.getElementById('location-select').value;
countEl.textContent = `${events.length} event${events.length === 1 ? '' : 's'} in ${yearName}, ${monthName} at ${regionName}, ${locationName}`;
}
}
function displayEvents(events) {
document.getElementById('loading').style.display = 'none';
document.getElementById('events-container').style.display = 'block';
document.getElementById('calendar-container').style.display = 'none';
document.getElementById('export-button').style.display = 'none';
const listEl = document.getElementById('events-list');
updateEventCount(events);
if (events.length === 0) {
listEl.innerHTML = `
<div class="no-events">
<h3>No events found</h3>
<p>There are no events for the selected filters.</p>
</div>
`;
return;
}
listEl.innerHTML = events.map(event => createEventCard(event, event.parsedDate)).join('');
}
function displayTable(events) {
document.getElementById('loading').style.display = 'none';
document.getElementById('events-container').style.display = 'block';
document.getElementById('calendar-container').style.display = 'none';
document.getElementById('export-button').style.display = events.length > 0 ? 'block' : 'none';
const listEl = document.getElementById('events-list');
updateEventCount(events);
if (events.length === 0) {
listEl.innerHTML = `
<div class="no-events">
<h3>No events found</h3>
<p>There are no events for the selected filters.</p>
</div>
`;
return;
}
const grouped = {};
events.forEach(event => {
const baseLoc = extractBaseLocation(event.Location);
if (!grouped[baseLoc]) grouped[baseLoc] = [];
grouped[baseLoc].push(event);
});
let tableHTML = '';
Object.keys(grouped).sort().forEach(baseLoc => {
const groupEvents = grouped[baseLoc];
tableHTML += `
<div class="location-group">
<div class="location-header">${baseLoc}</div>
<table class="location-table">
<thead>
<tr>
<th>Date</th>
<th>Time</th>
<th>Event Name</th>
<th>Client Name</th>
<th>Full Location</th>
</tr>
</thead>
<tbody>
`;
groupEvents.forEach(event => {
tableHTML += `
<tr>
<td>${formatDate(event.parsedDate)}</td>
<td>${event.Time || ''}</td>
<td>${event['Event-Name'] || ''}</td>
<td>${event['Client-Name'] || ''}</td>
<td>${event.Location || ''}</td>
</tr>
`;
});
tableHTML += `
</tbody>
</table>
</div>
`;
});
listEl.innerHTML = tableHTML;
}
function exportToEmail() {
const selectedYear = document.getElementById('year-select').value;
const selectedMonth = document.getElementById('month-select').value;
const selectedRegion = document.getElementById('region-select').value;
const selectedLocation = document.getElementById('location-select').value;
let filteredEvents = allEventsData;
if (selectedYear !== 'all') {
filteredEvents = filteredEvents.filter(event => event.parsedDate.getFullYear() === parseInt(selectedYear));
}
if (selectedMonth !== 'all') {
const monthNum = parseInt(selectedMonth);
filteredEvents = filteredEvents.filter(event => event.parsedDate.getMonth() === monthNum);
}
if (selectedRegion !== 'all') {
filteredEvents = filteredEvents.filter(event => event.Region === selectedRegion);
}
if (selectedLocation !== 'all') {
filteredEvents = filteredEvents.filter(event => event.Location === selectedLocation);
}
const yearName = selectedYear === 'all' ? 'All Years' : selectedYear;
const monthName = selectedMonth === 'all' ? 'All Months' : new Date(0, selectedMonth).toLocaleString('en-US', { month: 'long' });
const grouped = {};
filteredEvents.forEach(event => {
const baseLoc = extractBaseLocation(event.Location);
if (!grouped[baseLoc]) grouped[baseLoc] = [];
grouped[baseLoc].push(event);
});
let emailContent = `<h2>Events for ${yearName}, ${monthName}</h2>`;
Object.keys(grouped).sort().forEach(baseLoc => {
const groupEvents = grouped[baseLoc];
emailContent += `<h3>${baseLoc}</h3>`;
emailContent += '<table style="width:100%; border-collapse: collapse; border: 1px solid #ddd; margin-bottom: 20px;">';
emailContent += '<thead><tr style="background: #ff6600; color: #fff;"><th style="border: 1px solid #ddd; padding: 12px; text-align: left;">Date</th><th style="border: 1px solid #ddd; padding: 12px; text-align: left;">Time</th><th style="border: 1px solid #ddd; padding: 12px; text-align: left;">Event Name</th><th style="border: 1px solid #ddd; padding: 12px; text-align: left;">Client Name</th><th style="border: 1px solid #ddd; padding: 12px; text-align: left;">Full Location</th></tr></thead>';
emailContent += '<tbody>';
groupEvents.forEach(event => {
emailContent += `<tr><td style="border: 1px solid #ddd; padding: 12px;">${formatDate(event.parsedDate)}</td><td style="border: 1px solid #ddd; padding: 12px;">${event.Time || ''}</td><td style="border: 1px solid #ddd; padding: 12px;">${event['Event-Name'] || ''}</td><td style="border: 1px solid #ddd; padding: 12px;">${event['Client-Name'] || ''}</td><td style="border: 1px solid #ddd; padding: 12px;">${event.Location || ''}</td></tr>`;
});
emailContent += '</tbody></table>';
});
const mailtoLink = `mailto:?subject=Events - ${yearName}, ${monthName}&body=${encodeURIComponent(emailContent.replace(/<\/?[^>]+(>|$)/g, ""))}`;
window.location.href = mailtoLink;
setTimeout(() => {
alert('Email client opened! You can now paste the formatted table into your email body.');
}, 500);
}
function displayCalendar(events, month, year) {
document.getElementById('loading').style.display = 'none';
document.getElementById('calendar-container').style.display = 'block';
document.getElementById('events-container').style.display = 'none';
document.getElementById('export-button').style.display = 'none';
const gridEl = document.getElementById('calendar-grid');
updateEventCount(events);
gridEl.innerHTML = generateCalendar(year, month, events);
if (events.length === 0) {
gridEl.innerHTML = `
<div class="no-events">
<h3>No events found</h3>
<p>There are no events for the selected filters.</p>
</div>
`;
return;
}
document.querySelectorAll('.calendar-day').forEach(day => {
day.addEventListener('click', () => {
const dateStr = day.getAttribute('data-date');
if (dateStr) {
const dayEvents = events.filter(event => event.parsedDate.toDateString() === dateStr);
showEventModal(dayEvents, dateStr);
}
});
});
}
function showEventModal(events, dateStr) {
const modal = document.getElementById('event-modal');
const overlay = document.getElementById('modal-overlay');
const modalEvents = document.getElementById('modal-events');
const modalDate = document.getElementById('modal-date');
modalDate.textContent = formatDate(new Date(dateStr));
modalEvents.innerHTML = events.length > 0
? events.map(event => createEventCard(event, event.parsedDate)).join('')
: '<p>No events for this day.</p>';
modal.style.display = 'block';
overlay.style.display = 'block';
document.querySelector('.close-modal').addEventListener('click', () => {
modal.style.display = 'none';
overlay.style.display = 'none';
});
overlay.addEventListener('click', () => {
modal.style.display = 'none';
overlay.style.display = 'none';
});
}
function filterEvents() {
const selectedYear = document.getElementById('year-select').value;
const selectedMonth = document.getElementById('month-select').value;
const selectedRegion = document.getElementById('region-select').value;
const selectedLocation = document.getElementById('location-select').value;
const view = document.getElementById('view-select').value;
let filteredEvents = allEventsData;
if (selectedYear !== 'all') {
filteredEvents = filteredEvents.filter(event => event.parsedDate.getFullYear() === parseInt(selectedYear));
}
if (selectedMonth !== 'all') {
filteredEvents = filteredEvents.filter(event => event.parsedDate.getMonth() === parseInt(selectedMonth));
}
if (selectedRegion !== 'all') {
filteredEvents = filteredEvents.filter(event => event.Region === selectedRegion);
}
if (selectedLocation !== 'all') {
filteredEvents = filteredEvents.filter(event => event.Location === selectedLocation);
}
filteredEvents.sort((a, b) => {
const aIsToday = isToday(a.parsedDate);
const bIsToday = isToday(b.parsedDate);
const aIsUpcoming = isUpcoming(a.parsedDate);
const bIsUpcoming = isUpcoming(b.parsedDate);
if (aIsToday && !bIsToday) return -1;
if (!aIsToday && bIsToday) return 1;
if (aIsUpcoming && !bIsUpcoming) return -1;
if (!aIsUpcoming && bIsUpcoming) return 1;
return a.parsedDate - b.parsedDate;
});
if (view === 'list') {
displayEvents(filteredEvents);
} else if (view === 'table') {
displayTable(filteredEvents);
} else if (view === 'calendar') {
let calendarYear = getCurrentYear();
let calendarMonth = getCurrentMonth();
if (selectedYear !== 'all') {
calendarYear = parseInt(selectedYear);
}
if (selectedMonth !== 'all') {
calendarMonth = parseInt(selectedMonth);
}
const calendarEvents = allEventsData.filter(event => 
event.parsedDate.getFullYear() === calendarYear &&
event.parsedDate.getMonth() === calendarMonth &&
(selectedRegion === 'all' || event.Region === selectedRegion) &&
(selectedLocation === 'all' || event.Location === selectedLocation)
);
displayCalendar(calendarEvents, calendarMonth, calendarYear);
}
}
function showError() {
document.getElementById('loading').style.display = 'none';
document.getElementById('error-container').style.display = 'block';
document.getElementById('events-container').style.display = 'none';
document.getElementById('calendar-container').style.display = 'none';
document.getElementById('export-button').style.display = 'none';
}
function showSampleDataNotice() {
const header = document.querySelector('.header p');
header.innerHTML = 'Showing sample data - Please ensure your Google Sheet is publicly accessible';
header.style.background = 'rgba(255,102,0,0.12)';
header.style.padding = '10px';
header.style.borderRadius = '8px';
header.style.marginTop = '15px';
header.style.color = '#222';
}
document.addEventListener('DOMContentLoaded', loadEvents);
</script>
</body>
</html>
