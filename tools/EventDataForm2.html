<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Event Data Form</title>
    <link rel="icon" type="image/png" href="https://www.compassoffices.com/wp-content/uploads/2025/09/compassoffices-logo-web-2025_icon-o-scaled.png">
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { box-sizing: border-box; margin: 0; padding: 0; -webkit-font-smoothing: antialiased; }
        .form-container { background: linear-gradient(135deg, #000000 0%, #1a1a1a 100%); min-height: 100vh; padding: 1rem; }
        .form-card { backdrop-filter: blur(10px); background: rgba(255, 255, 255, 0.98); box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5); border: 1px solid #ff6600; }
        .input-field { transition: all 0.3s ease; border: 2px solid #e5e7eb; background: white; width: 100%; box-sizing: border-box; -webkit-appearance: none; }
        .input-field:focus { border-color: #ff6600; box-shadow: 0 0 0 3px rgba(255, 102, 0, 0.1); transform: translateY(-1px); outline: none; }
        .submit-btn { background: linear-gradient(135deg, #ff6600 0%, #e55a00 100%); transition: all 0.3s ease; }
        .submit-btn:hover { transform: translateY(-2px); box-shadow: 0 10px 25px -5px rgba(255, 102, 0, 0.4); }
        .submit-btn:disabled { opacity: 0.7; cursor: not-allowed; transform: none; box-shadow: none; }
        .success-message { background: linear-gradient(135deg, #10b981 0%, #059669 100%); }
        .error-message { background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%); }
        .file-upload { position: relative; display: inline-block; width: 100%; }
        .file-upload input[type="file"] { position: absolute; opacity: 0; width: 100%; height: 100%; cursor: pointer; }
        .file-upload-label { display: block; padding: 0.75rem 1rem; background: #f9fafb; border: 2px dashed #d1d5db; border-radius: 0.5rem; text-align: center; cursor: pointer; transition: all 0.3s ease; font-size: 0.875rem; color: #6b7280; }
        .file-upload-label:hover { border-color: #ff6600; background: #fff7ed; }
        .char-count { font-size: 0.75rem; color: #6b7280; text-align: right; margin-top: 0.25rem; }
        .char-count.warning { color: #f59e0b; } .char-count.error { color: #ef4444; }
        .required:after { content: " *"; color: #ef4444; font-weight: bold; }
        .suggestions { font-size: 0.75rem; color: #6b7280; margin-top: 0.25rem; }
        .suggestion-btn { display: inline-block; background: #f3f4f6; color: #374151; padding: 0.25rem 0.5rem; margin-right: 0.25rem; margin-bottom: 0.25rem; border-radius: 0.375rem; font-size: 0.75rem; cursor: pointer; }
        .suggestion-btn:hover { background: #e5e7eb; }
        .contact-feedback { font-size: 0.75rem; margin-top: 0.25rem; display: flex; align-items: center; gap: 0.25rem; }
        .contact-feedback svg { width: 1rem; height: 1rem; }
        .logo-preview { max-width: 150px; max-height: 100px; margin-top: 0.5rem; border: 1px dashed #ccc; }
        .image-preview { max-width: 200px; max-height: 200px; margin-top: 0.5rem; border: 1px solid #ddd; border-radius: 0.5rem; }
        .key-image-item, .edm-banner-item { border: 1px solid #ddd; padding: 1rem; border-radius: 0.5rem; margin-bottom: 1rem; }
        .email-preview { background: #f8f9fa; border: 1px solid #dee2e6; border-radius: 0.5rem; padding: 0.75rem; margin-top: 0.75rem; font-family: monospace; font-size: 0.875rem; color: #1f2937; }
        .event-id-display { background: #f3f4f6; border: 1px solid #d1d5db; border-radius: 0.5rem; padding: 0.75rem; font-family: monospace; font-weight: bold; color: #1f2937; }
        .webhook-link { background: #e0f2fe; border: 1px solid #0ea5e9; border-radius: 0.5rem; padding: 0.75rem; margin-top: 1rem; font-family: monospace; font-size: 0.875rem; color: #0c4a6e; word-break: break-all; }
        .loading-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0, 0, 0, 0.7); backdrop-filter: blur(5px);
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            z-index: 9999; color: white; font-size: 1.125rem;
        }
        .loading-bar {
            width: 60%; max-width: 400px; height: 8px; background: rgba(255,255,255,0.2);
            border-radius: 4px; margin-top: 1rem; overflow: hidden;
        }
        .loading-fill {
            height: 100%; background: linear-gradient(90deg, #ff6600, #e55a00);
            width: 0%; border-radius: 4px; transition: width 0.3s ease;
        }
        @media (max-width: 768px) {
            .form-container { padding: 0.5rem; } .form-card { padding: 1.5rem; }
            .grid-cols-1, .grid-cols-2 { grid-template-columns: 1fr; gap: 1rem; }
            .input-field { padding: 0.75rem 1rem; font-size: 1rem; }
            .max-w-2xl { max-width: 100%; padding: 0 0.5rem; }
            .text-4xl { font-size: 1.875rem; line-height: 2.25rem; }
            .submit-btn { padding: 0.75rem 1rem; font-size: 1rem; }
            select.input-field, input[type="time"], input[type="date"], input[type="text"], textarea { -webkit-appearance: none; border-radius: 0.5rem; }
            select.input-field { background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 24 24' stroke='%234B5563'%3E%3Cpath stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M19 9l-7 7-7-7'/%3E%3C/svg%3E"); background-position: right 0.5rem center; background-repeat: no-repeat; background-size: 1.5em; padding-right: 2rem; }
        }
        /* Fix Date input tab margin */
        .date-input-container { margin-bottom: 1.5rem; }
    </style>
</head>
<body class="form-container">
    <!-- Password Page -->
    <div id="passwordPage" class="min-h-full py-8 px-4 flex items-center justify-center">
        <div class="max-w-md w-full form-card rounded-2xl p-8">
            <div class="text-center mb-6">
                <h1 class="text-2xl font-bold text-gray-800">Enter Password</h1>
            </div>
            <div class="space-y-4">
                <input type="password" id="passwordInput" placeholder="Enter password" class="input-field px-4 py-3 rounded-lg">
                <button id="passwordSubmit" class="submit-btn w-full py-3 px-6 text-white font-semibold rounded-lg">Submit</button>
                <div id="passwordError" class="hidden p-3 rounded-lg text-white error-message">Incorrect password.</div>
            </div>
        </div>
    </div>
    <!-- Loading Overlay -->
    <div id="loadingOverlay" class="loading-overlay hidden">
        <div class="text-center">
            <p class="font-semibold">Submitting your event data...</p>
            <p class="text-sm mt-1 opacity-80">Please wait while we transfer your information.</p>
            <div class="loading-bar mt-4">
                <div id="loadingFill" class="loading-fill"></div>
            </div>
        </div>
    </div>
    <!-- Main Form -->
    <div id="formPage" class="min-h-full py-8 px-4 hidden">
        <div class="max-w-2xl mx-auto">
            <div class="text-center mb-8">
                <img src="https://www.compassoffices.com/wp-content/themes/compass-offices/assets/images/compassoffices-logo-web-all-in-one-2025_ow.svg" alt="Logo" class="h-16 mx-auto" onerror="this.style.display='none';">
                <h1 class="text-4xl font-bold text-white mb-2">Event Registration</h1>
                <p class="text-white/80 text-lg">Fill in the details for the new event</p>
            </div>
            <div class="form-card rounded-2xl p-8">
                <form id="eventForm" class="space-y-6">
                    <!-- Event ID (Auto-generated) -->
                    <div class="mb-6 p-4 bg-gray-50 rounded-lg border">
                        <label class="block text-sm font-semibold text-gray-700 mb-2">Event ID (Auto-generated)</label>
                        <div id="eventIdDisplay" class="event-id-display">Generating...</div>
                    </div>
                    <!-- Organizer -->
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6 border-b border-gray-200 pb-6">
                        <div>
                            <label for="organizerName" class="block text-sm font-semibold text-gray-700 mb-2 required">Organizer Name</label>
                            <input type="text" id="organizerName" required placeholder="Full name" class="input-field px-4 py-3 rounded-lg">
                        </div>
                        <div>
                            <label for="organizerEmail" class="block text-sm font-semibold text-gray-700 mb-2 required">Organizer Email</label>
                            <input type="email" id="organizerEmail" required placeholder="email@company.com" class="input-field px-4 py-3 rounded-lg">
                        </div>
                    </div>
                    <!-- Time -->
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <label for="startTime" class="block text-sm font-semibold text-gray-700 mb-2">Start Time</label>
                            <input type="time" id="startTime" value="18:00" class="input-field px-4 py-3 rounded-lg">
                        </div>
                        <div>
                            <label for="endTime" class="block text-sm font-semibold text-gray-700 mb-2">End Time</label>
                            <input type="time" id="endTime" value="21:00" class="input-field px-4 py-3 rounded-lg">
                        </div>
                    </div>
                    <!-- Date with fixed margin -->
                    <div class="date-input-container">
                        <label for="date" class="block text-sm font-semibold text-gray-700 mb-2 required">Date</label>
                        <input type="date" id="date" required class="input-field px-4 py-3 rounded-lg">
                    </div>
                    <!-- Client Info -->
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <label for="clientName" class="block text-sm font-semibold text-gray-700 mb-2">Client Name</label>
                            <input type="text" id="clientName" placeholder="Client name" class="input-field px-4 py-3 rounded-lg">
                        </div>
                        <div>
                            <label for="clientContact" class="block text-sm font-semibold text-gray-700 mb-2">Client Contact</label>
                            <input type="text" id="clientContact" placeholder="email@domain.com or +852 1234 5678" class="input-field px-4 py-3 rounded-lg">
                            <div id="contactFeedback" class="contact-feedback"></div>
                        </div>
                    </div>
                    <div>
                        <label for="companyName" class="block text-sm font-semibold text-gray-700 mb-2">Company Name</label>
                        <input type="text" id="companyName" placeholder="Company name" class="input-field px-4 py-3 rounded-lg">
                    </div>
                    <div>
                        <label for="eventName" class="block text-sm font-semibold text-gray-700 mb-2 required">Event Name</label>
                        <input type="text" id="eventName" required placeholder="Event name" class="input-field px-4 py-3 rounded-lg">
                    </div>
                    <!-- Location -->
                    <div>
                        <label class="block text-sm font-semibold text-gray-700 mb-4">Location</label>
                        <div class="mb-4">
                            <label for="country" class="block text-xs font-medium text-gray-600 mb-2 required">Country</label>
                            <select id="country" required class="input-field px-4 py-3 rounded-lg">
                                <option value="">Select Country</option>
                                <option value="Hong Kong">Hong Kong</option>
                                <option value="Tokyo">Tokyo</option>
                                <option value="Osaka">Osaka</option>
                                <option value="Singapore">Singapore</option>
                                <option value="Melbourne">Melbourne</option>
                                <option value="Sydney">Sydney</option>
                                <option value="Philippines">Philippines</option>
                                <option value="Kuala Lumpur">Kuala Lumpur</option>
                                <option value="Ho Chi Minh City">Ho Chi Minh City</option>
                            </select>
                        </div>
                        <div class="mb-4">
                            <label for="building" class="block text-xs font-medium text-gray-600 mb-2 required">Building</label>
                            <select id="building" required disabled class="input-field px-4 py-3 rounded-lg"><option>Select Building</option></select>
                        </div>
                        <div class="mb-4">
                            <label for="floor" class="block text-xs font-medium text-gray-600 mb-2 required">Floor</label>
                            <select id="floor" required disabled class="input-field px-4 py-3 rounded-lg"><option>Select Floor</option></select>
                        </div>
                        <div class="mb-4">
                            <label class="block text-xs font-medium text-gray-600 mb-2">Area Type</label>
                            <div class="space-y-2">
                                <label class="flex items-center"><input type="checkbox" id="loungeArea" class="mr-2 text-orange-500"><span class="text-sm">Lounge area</span></label>
                                <label class="flex items-center"><input type="checkbox" id="meetingRoom" class="mr-2 text-orange-500"><span class="text-sm">Meeting room</span></label>
                                <label class="flex items-center"><input type="checkbox" id="room" class="mr-2 text-orange-500"><span class="text-sm">Room</span></label>
                            </div>
                        </div>
                        <div class="mb-4" id="roomNameSection" style="display:none;">
                            <div id="regularRoomInput" style="display:none;" class="mb-3">
                                <label for="regularRoomName" class="block text-xs font-medium text-gray-600 mb-2">Room Number</label>
                                <input type="text" id="regularRoomName" placeholder="e.g., 1826" class="input-field px-4 py-3 rounded-lg">
                            </div>
                            <div id="meetingRoomInput" style="display:none;">
                                <label for="meetingRoomName" class="block text-xs font-medium text-gray-600 mb-2">Meeting Room Name</label>
                                <input type="text" id="meetingRoomName" placeholder="e.g., ABC" class="input-field px-4 py-3 rounded-lg">
                            </div>
                        </div>
                        <div class="mb-4">
                            <label for="additionalRequirements" class="block text-xs font-medium text-gray-600 mb-2">Additional Requirements</label>
                            <input type="text" id="additionalRequirements" placeholder="e.g., TV, Mic, Speaker..." class="input-field px-4 py-3 rounded-lg">
                            <div class="suggestions">
                                <span class="suggestion-btn" onclick="addSuggestion('TV')">TV</span>
                                <span class="suggestion-btn" onclick="addSuggestion('Mic')">Mic</span>
                                <span class="suggestion-btn" onclick="addSuggestion('Speaker')">Speaker</span>
                                <span class="suggestion-btn" onclick="addSuggestion('Projector')">Projector</span>
                                <span class="suggestion-btn" onclick="addSuggestion('Whiteboard')">Whiteboard</span>
                            </div>
                        </div>
                        <!-- Location Preview -->
                        <div class="mt-4 p-3 bg-gray-50 rounded-lg border">
                            <label class="block text-xs font-medium text-gray-600 mb-1">Location Preview:</label>
                            <div id="locationPreview" class="text-sm font-medium text-gray-800">Please select location details above</div>
                        </div>
                        <!-- Contact Email Preview -->
                        <div class="mt-4 p-3 bg-blue-50 rounded-lg border border-blue-200">
                            <label class="block text-xs font-medium text-blue-700 mb-1">Contact Email (Auto-filled):</label>
                            <div id="emailPreview" class="email-preview">Select building and floor to see email</div>
                        </div>
                    </div>
                    <!-- POSTER -->
                    <div>
                        <label class="block text-sm font-semibold text-gray-700 mb-3">Poster</label>
                        <div class="space-y-3">
                            <label class="flex items-center">
                                <input type="checkbox" id="needPoster" class="mr-2 text-orange-500">
                                <span class="text-sm">Need Poster?</span>
                            </label>
                            <div id="posterDetailsSection" class="ml-6 space-y-4 hidden">
                                <div>
                                    <label for="posterTitle" class="block text-xs font-medium text-gray-600 mb-1 required">Title</label>
                                    <input type="text" id="posterTitle" maxlength="40" placeholder="Title" class="input-field px-4 py-3 rounded-lg">
                                    <div class="char-count" id="posterTitleCount">0 / 40 (0 non-blank)</div>
                                </div>
                                <div>
                                    <label class="flex items-center mb-2">
                                        <input type="checkbox" id="posterHasSubtitle" class="mr-2 text-orange-500">
                                        <span class="text-sm">Add Subtitle?</span>
                                    </label>
                                    <div id="posterSubtitleInput" class="hidden">
                                        <label for="posterSubtitle" class="block text-xs font-medium text-gray-600 mb-1 required">Subtitle</label>
                                        <input type="text" id="posterSubtitle" maxlength="40" placeholder="Subtitle" class="input-field px-4 py-3 rounded-lg">
                                        <div class="char-count" id="posterSubtitleCount">0 / 40 (0 non-blank)</div>
                                    </div>
                                    <div id="posterSubtitleAuto" class="text-sm text-gray-600 mt-1 hidden">(Exclusive event for clients of Compass Offices)</div>
                                </div>
                                <div>
                                    <label class="block text-xs font-medium text-gray-600 mb-1 required">Description (3 bullet points)</label>
                                    <textarea id="posterBullet1" maxlength="70" rows="2" placeholder="Point 1..." class="input-field px-4 py-3 rounded-lg w-full"></textarea>
                                    <div class="char-count" id="posterBullet1Count">0 / 70</div>
                                    <textarea id="posterBullet2" maxlength="70" rows="2" placeholder="Point 2..." class="input-field px-4 py-3 rounded-lg w-full mt-2"></textarea>
                                    <div class="char-count" id="posterBullet2Count">0 / 70</div>
                                    <textarea id="posterBullet3" maxlength="70" rows="2" placeholder="Point 3..." class="input-field px-4 py-3 rounded-lg w-full mt-2"></textarea>
                                    <div class="char-count" id="posterBullet3Count">0 / 70</div>
                                </div>
                                <!-- LOGO -->
                                <div>
                                    <label class="block text-xs font-medium text-gray-600 mb-1">Upload Logo</label>
                                    <div class="file-upload">
                                        <input type="file" id="posterLogoInput" accept="image/*">
                                        <label for="posterLogoInput" class="file-upload-label">Click or drag logo</label>
                                    </div>
                                    <div id="logoPreviewContainer" class="mt-2 hidden">
                                        <img id="logoPreview" class="logo-preview" alt="Logo preview">
                                    </div>
                                </div>
                                <!-- KEY IMAGES -->
                                <div>
                                    <label class="block text-xs font-medium text-gray-600 mb-1">Key Images (Auto-converted to PNG)</label>
                                    <div class="file-upload">
                                        <input type="file" id="posterKeyImagesInput" accept="image/*" multiple>
                                        <label for="posterKeyImagesInput" class="file-upload-label">Click or drag images</label>
                                    </div>
                                    <div id="keyImagePreviews" class="mt-2"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- EDM -->
                    <div>
                        <label class="block text-sm font-semibold text-gray-700 mb-3">EDM</label>
                        <label class="flex items-center">
                            <input type="checkbox" id="needEDM" class="mr-2 text-orange-500">
                            <span class="text-sm">Need EDM?</span>
                        </label>
                        <div id="edmDetailsSection" class="ml-6 mt-3 space-y-4 hidden">
                            <div>
                                <label for="edmTitle" class="block text-xs font-medium text-gray-600 mb-1 required">Title</label>
                                <input type="text" id="edmTitle" maxlength="40" placeholder="Title" class="input-field px-4 py-3 rounded-lg">
                                <div class="char-count" id="edmTitleCount">0 / 40 (0 non-blank)</div>
                            </div>
                            <div>
                                <label class="flex items-center mb-2">
                                    <input type="checkbox" id="edmHasSubtitle" class="mr-2 text-orange-500">
                                    <span class="text-sm">Add Subtitle?</span>
                                </label>
                                <div id="edmSubtitleInput" class="hidden">
                                    <label for="edmSubtitle" class="block text-xs font-medium text-gray-600 mb-1 required">Subtitle</label>
                                    <input type="text" id="edmSubtitle" maxlength="40" placeholder="Subtitle" class="input-field px-4 py-3 rounded-lg">
                                    <div class="char-count" id="edmSubtitleCount">0 / 40 (0 non-blank)</div>
                                </div>
                                <div id="edmSubtitleAuto" class="text-sm text-gray-600 mt-1 hidden">(Exclusive event for clients of Compass Offices)</div>
                            </div>
                            <div>
                                <label class="block text-xs font-medium text-gray-600 mb-1 required">Description (3 bullet points)</label>
                                <textarea id="edmBullet1" maxlength="70" rows="2" placeholder="Point 1..." class="input-field px-4 py-3 rounded-lg w-full"></textarea>
                                <div class="char-count" id="edmBullet1Count">0 / 70</div>
                                <textarea id="edmBullet2" maxlength="70" rows="2" placeholder="Point 2..." class="input-field px-4 py-3 rounded-lg w-full mt-2"></textarea>
                                <div class="char-count" id="edmBullet2Count">0 / 70</div>
                                <textarea id="edmBullet3" maxlength="70" rows="2" placeholder="Point 3..." class="input-field px-4 py-3 rounded-lg w-full mt-2"></textarea>
                                <div class="char-count" id="edmBullet3Count">0 / 70</div>
                            </div>
                            <!-- EDM BANNER -->
                            <div>
                                <label class="block text-xs font-medium text-gray-600 mb-1 required">EDM Banner Image (Auto-converted to PNG)</label>
                                <div class="flex items-center gap-3 mb-2">
                                    <select id="edmBannerSource" class="input-field px-3 py-2 rounded-lg text-sm">
                                        <option value="upload">Upload new image</option>
                                        <option value="copy">Same as Poster Key Image</option>
                                    </select>
                                    <span class="text-xs text-gray-500">(Copies first key image)</span>
                                </div>
                                <div id="edmBannerUploadSection">
                                    <div class="file-upload">
                                        <input type="file" id="edmBannerInput" accept="image/*">
                                        <label for="edmBannerInput" class="file-upload-label">Click or drag banner</label>
                                    </div>
                                </div>
                                <div id="edmBannerPreview" class="mt-2"></div>
                            </div>
                        </div>
                    </div>
                    <!-- Catering -->
                    <div>
                        <label class="block text-sm font-semibold text-gray-700 mb-3">Catering</label>
                        <label class="flex items-center">
                            <input type="checkbox" id="haveCatering" class="mr-2 text-orange-500">
                            <span class="text-sm">Have Catering?</span>
                        </label>
                        <div id="cateringDetailsSection" class="ml-6 mt-3 hidden">
                            <textarea id="cateringDetails" placeholder="Menu, headcount, dietary restrictions..." rows="3" class="input-field px-4 py-3 rounded-lg w-full"></textarea>
                        </div>
                    </div>
                    <!-- Registration Link -->
                    <div>
                        <label class="block text-sm font-semibold text-gray-700 mb-3">Registration Link</label>
                        <label class="flex items-center">
                            <input type="checkbox" id="needRegisterLink" class="mr-2 text-orange-500">
                            <span class="text-sm">Need Registration Link?</span>
                        </label>
                        <div id="registerLinkSection" class="ml-6 mt-3 space-y-4 hidden">
                            <div class="flex gap-4 items-center">
                                <label class="flex items-center">
                                    <input type="radio" name="linkSource" value="manual" checked class="mr-2">
                                    <span class="text-sm">Enter manually</span>
                                </label>
                                <label class="flex items-center">
                                    <input type="radio" name="linkSource" value="build" class="mr-2">
                                    <span class="text-sm">Build new registration link</span>
                                </label>
                            </div>
                            <!-- Manual Input -->
                            <div id="manualLinkInput">
                                <label for="registerLink" class="block text-xs font-medium text-gray-600 mb-1">Registration Link</label>
                                <input type="url" id="registerLink" placeholder="https://example.com/register" class="input-field px-4 py-3 rounded-lg">
                            </div>
                            <!-- Build Link -->
                            <div id="buildLinkSection" class="hidden space-y-3">
                                <p class="text-sm text-gray-600">We'll generate a registration link for you.</p>
                                <div class="p-3 bg-blue-50 border border-blue-200 rounded">
                                    <p class="text-sm font-medium text-blue-800">Link will be generated automatically after submission.</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div>
                        <label for="details" class="block text-sm font-semibold text-gray-700 mb-2">Additional Details</label>
                        <textarea id="details" rows="4" placeholder="Other info..." class="input-field px-4 py-3 rounded-lg"></textarea>
                    </div>
                    <div class="pt-4">
                        <button type="submit" id="submitButton" class="submit-btn w-full py-4 px-6 text-white font-semibold rounded-lg">
                            <span id="submitText">Submit Event Data</span>
                        </button>
                    </div>
                </form>
                <div id="successMessage" class="hidden mt-6 p-4 rounded-lg text-white success-message">
                    <p>Event data submitted successfully!</p>
                    <p class="mt-2">Click the link below to reopen this form with all data pre-filled:</p>
                    <div id="webhookLink" class="webhook-link mt-3"></div>
                    <button onclick="navigator.clipboard.writeText(document.getElementById('webhookLink').textContent); alert('Link copied!')" class="mt-3 px-4 py-2 bg-blue-600 text-white rounded-lg text-sm">Copy Link</button>
                </div>
                <div id="errorMessage" class="hidden mt-6 p-4 rounded-lg text-white error-message">
                    <span id="errorText">Error</span>
                </div>
            </div>
        </div>
    </div>
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            // === AUTO-GENERATE EVENT ID ===
            function generateEventId() {
                const now = new Date();
                const dateStr = now.toISOString().slice(0, 10).replace(/-/g, '');
                const timeStr = now.toTimeString().slice(0, 8).replace(/:/g, '');
                const rand = Math.floor(Math.random() * 1000).toString().padStart(3, '0');
                return `EVT${dateStr}${timeStr}${rand}`;
            }
            const eventIdDisplay = document.getElementById('eventIdDisplay');
            eventIdDisplay.textContent = generateEventId();
            // === HIDDEN FORMATTED TIME (for submission only) ===
            let formattedTime = '6:00 PM - 9:00 PM'; // Default
            function formatTime12(hour, minute) {
                const period = hour >= 12 ? 'PM' : 'AM';
                const h12 = hour % 12 || 12;
                const m = minute.toString().padStart(2, '0');
                return `${h12}:${m} ${period}`;
            }
            function updateFormattedTime() {
                const start = document.getElementById('startTime').value;
                const end = document.getElementById('endTime').value;
                if (start && end) {
                    const [sh, sm] = start.split(':').map(Number);
                    const [eh, em] = end.split(':').map(Number);
                    formattedTime = `${formatTime12(sh, sm)} - ${formatTime12(eh, em)}`;
                } else {
                    formattedTime = 'Select start and end time';
                }
            }
            // === TIME INPUTS: FULLY FLEXIBLE (NO SNAP, NO BLOCK) ===
            ['startTime', 'endTime'].forEach(id => {
                const input = document.getElementById(id);
                input.value = input.value || (id === 'startTime' ? '18:00' : '21:00');
                input.addEventListener('change', updateFormattedTime);
                input.addEventListener('input', updateFormattedTime);
                // Allow any valid time input (HH:MM), clean non-digits
                input.addEventListener('input', () => {
                    let val = input.value;
                    if (val.length > 5) val = val.slice(0, 5);
                    input.value = val.replace(/[^\d:]/g, '');
                });
            });
            // Initial update
            updateFormattedTime();
            // === PASSWORD ===
            document.getElementById('passwordSubmit').addEventListener('click', () => {
                if (document.getElementById('passwordInput').value === 'm2025') {
                    document.getElementById('passwordPage').classList.add('hidden');
                    document.getElementById('formPage').classList.remove('hidden');
                } else {
                    document.getElementById('passwordError').classList.remove('hidden');
                }
            });
            // === CLIENT CONTACT VALIDATION ===
            const contactInput = document.getElementById('clientContact');
            const feedback = document.getElementById('contactFeedback');
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            const phoneRegex = /^[\+]?[0-9\s\-\(\)]{8,}$/;
            contactInput.addEventListener('input', () => {
                const val = contactInput.value.trim();
                feedback.innerHTML = '';
                if (!val) return;
                if (emailRegex.test(val)) {
                    feedback.innerHTML = `<svg class="text-green-600" fill="currentColor" viewBox="0 0 20 20"><path d="M2.93 17.07A10 10 0 1 1 17.07 2.93 10 10 0 0 1 2.93 17.07zM9 11v4h2V9H9v2zm0-6v2h2V5H9z"/></svg><span class="text-green-600">Valid Email</span>`;
                } else if (phoneRegex.test(val)) {
                    feedback.innerHTML = `<svg class="text-green-600" fill="currentColor" viewBox="0 0 20 20"><path d="M2 3a1 1 0 011-1h2.153a1 1 0 01.986.836l.74 4.435a1 1 0 01-.54 1.06l-1.548.773a11.037 11.037 0 006.105 6.105l.774-1.548a1 1 0 011.059-.54l4.435.74a1 1 0 01.836.986V17a1 1 0 01-1 1h-2C7.82 18 2 12.18 2 5V3z"/></svg><span class="text-green-600">Valid Phone</span>`;
                } else {
                    feedback.innerHTML = `<svg class="text-red-600" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z" clip-rule="evenodd"/></svg><span class="text-red-600">Enter valid email or phone</span>`;
                }
            });
            // === BUILDING / FLOOR / EMAIL DATA ===
            const buildingData = {
                "Hong Kong": {
                    "Lee Garden Two": { levels: ["15", "16", "28"], emails: ["HKG2LG015@compassoffices.com", "HKG2LG016@compassoffices.com", "HKG2LG028@compassoffices.com"] },
                    "Lee Garden One": { levels: ["24"], emails: ["HKGLG024@compassoffices.com"] },
                    "Wing On Centre": { levels: ["27"], emails: ["HKGWOC027@compassoffices.com"] },
                    "Infinitus Plaza": { levels: ["12", "20", "29", "35", "38"], emails: ["HKGIP012@compassoffices.com", "HKGIP020@compassoffices.com", "HKGIP029@compassoffices.com", "HKGIP035@compassoffices.com", "HKGIP038@compassoffices.com"] },
                    "China Building": { levels: ["18", "19"], emails: ["HKGCHB018@compassoffices.com", "HKGCHB019@compassoffices.com"] },
                    "Bank of Dongguan Tower": { levels: ["9", "10", "11", "12"], emails: ["HKGBODG012@compassoffices.com"] },
                    "Admiralty Centre Tower 1": { levels: ["15"], emails: ["HKG1ADC015@compassoffices.com"] },
                    "Admiralty Centre Tower 2": { levels: ["8", "11"], emails: ["HKG2ADC011@compassoffices.com"] },
                    "AIA Tower": { levels: ["43"], emails: ["HKGAIA043@compassoffices.com"] },
                    "Silvercord": { levels: ["5", "11", "17"], emails: ["HKG2SC017@compassoffices.com"] }
                },
                "Tokyo": {
                    "Ebisu Green Glass": { levels: ["6", "7", "8", "9"], emails: ["TYOEBS006@compassoffices.com", "TYOEBS007@compassoffices.com", "TYOEBS008@compassoffices.com", "TYOEBS009@compassoffices.com"] },
                    "Toranomon 40 MT": { levels: ["7"], emails: ["TYO40MT007@compassoffices.com"] },
                    "ouno八重洲 x Compass Offices": { levels: ["3"], emails: ["JPsales@compassoffices.com"] },
                    "WTC annex": { levels: ["11", "12"], emails: ["JPsales@compassoffices.com"] }
                },
                "Osaka": {
                    "INOGATE OSAKA": { levels: ["9", "10"], emails: ["OSAING009@compassoffices.com", "OSAING010@compassoffices.com"] }
                },
                "Singapore": {
                    "Samsung Hub": { levels: ["29"], emails: ["SINSHC029@compassoffices.com"] },
                    "Singapore Land Tower": { levels: ["19", "30"], emails: ["SINSLT019@compassoffices.com", "SINSLT030@compassoffices.com"] }
                },
                "Melbourne": {
                    "360 Collins Street": { levels: ["26"], emails: ["MEL360C026@compassoffices.com"] },
                    "459 Collins Street": { levels: ["21"], emails: ["MEL459C021@compassoffices.com"] },
                    "570 Bourke Street": { levels: ["17", "24"], emails: ["MEL570B024@compassoffices.com"] }
                },
                "Sydney": {
                    "141 Walker Street": { levels: ["12"], emails: ["SYD141W012@compassoffices.com"] },
                    "207 Kent Street": { levels: ["21"], emails: ["SYD207K021@compassoffices.com"] },
                    "9 Castlereagh Street": { levels: ["16", "17"], emails: ["SYD9CAS017@compassoffices.com"] }
                },
                "Philippines": {
                    "Arthaland Century Pacific Tower": { levels: ["9"], emails: ["MNLART009@compassoffices.com"] },
                    "Tower 6789": { levels: ["16"], emails: ["MNLAYA016@compassoffices.com"] },
                    "BGC Corporate Center": { levels: ["24"], emails: ["MNLBGC024@compassoffices.com"] }
                },
                "Ho Chi Minh City": {
                    "Compass Offices Landmark 81": { levels: ["72"], emails: ["SGNLM81072@compassoffices.com"] },
                    "Bitexco Financial Tower": { levels: ["16", "46", "56"], emails: ["SGNBFT046@compassoffices.com"] }
                },
                "Kuala Lumpur": {
                    "Menara AIA Sentral": { levels: ["3", "4", "5"], emails: ["KULMSC003@compassoffices.com"] }
                }
            };
            const countrySelect = document.getElementById('country');
            const buildingSelect = document.getElementById('building');
            const floorSelect = document.getElementById('floor');
            const emailPreview = document.getElementById('emailPreview');
            const locationPreview = document.getElementById('locationPreview');
            function updateBuildingOptions() {
                const country = countrySelect.value;
                buildingSelect.innerHTML = '<option>Select Building</option>';
                floorSelect.innerHTML = '<option>Select Floor</option>';
                buildingSelect.disabled = true;
                floorSelect.disabled = true;
                emailPreview.textContent = 'Select building and floor to see email';
                updateLocationPreview();
                if (country && buildingData[country]) {
                    buildingSelect.disabled = false;
                    Object.keys(buildingData[country]).forEach(b => {
                        const opt = document.createElement('option');
                        opt.value = b;
                        opt.textContent = b;
                        buildingSelect.appendChild(opt);
                    });
                }
            }
            function updateFloorOptions() {
                const country = countrySelect.value;
                const building = buildingSelect.value;
                floorSelect.innerHTML = '<option>Select Floor</option>';
                floorSelect.disabled = true;
                emailPreview.textContent = 'Select floor to see email';
                updateLocationPreview();
                if (country && building && buildingData[country][building]) {
                    floorSelect.disabled = false;
                    const levels = buildingData[country][building].levels;
                    levels.forEach(l => {
                        const opt = document.createElement('option');
                        opt.value = l;
                        opt.textContent = l + '/F';
                        floorSelect.appendChild(opt);
                    });
                }
            }
            function updateEmail() {
                const country = countrySelect.value;
                const building = buildingSelect.value;
                const floor = floorSelect.value;
                if (country && building && floor) {
                    const data = buildingData[country][building];
                    const idx = data.levels.indexOf(floor);
                    const email = (idx >= 0) ? data.emails[idx] : data.emails[0];
                    emailPreview.textContent = email;
                }
            }
            function getAreaTypes() {
                const types = [];
                if (document.getElementById('loungeArea').checked) types.push('Lounge area');
                if (document.getElementById('meetingRoom').checked) types.push('Meeting room');
                if (document.getElementById('room').checked) types.push('Room');
                return types.length ? types.join(', ') : '';
            }
            function getRoomName() {
                const regular = document.getElementById('regularRoomName').value.trim();
                const meeting = document.getElementById('meetingRoomName').value.trim();
                if (regular) return `Room ${regular}`;
                if (meeting) return `MR ${meeting}`;
                return '';
            }
            function getAdditionalReqs() {
                return document.getElementById('additionalRequirements').value.trim();
            }
            function updateLocationPreview() {
                const country = countrySelect.value;
                const building = buildingSelect.value;
                const floor = floorSelect.value;
                const areaTypes = getAreaTypes();
                const roomName = getRoomName();
                const addReqs = getAdditionalReqs();
                let parts = [];
                if (building) parts.push(building);
                if (floor) parts.push(`${floor}/F`);
                if (country) parts.push(country);
                if (areaTypes) parts.push(`– ${areaTypes}`);
                if (roomName) parts.push(`(${roomName})`);
                if (addReqs) parts.push(`[${addReqs}]`);
                const formatted = parts.length ? parts.join(', ') : 'Please select location details above';
                locationPreview.textContent = formatted;
                return formatted;
            }
            countrySelect.addEventListener('change', updateBuildingOptions);
            buildingSelect.addEventListener('change', updateFloorOptions);
            floorSelect.addEventListener('change', () => { updateEmail(); updateLocationPreview(); });
            ['loungeArea', 'meetingRoom', 'room'].forEach(id => {
                document.getElementById(id).addEventListener('change', updateLocationPreview);
            });
            ['regularRoomName', 'meetingRoomName', 'additionalRequirements'].forEach(id => {
                const el = document.getElementById(id);
                if (el) el.addEventListener('input', updateLocationPreview);
            });
            // === ROOM NAME LOGIC ===
            const loungeArea = document.getElementById('loungeArea');
            const meetingRoom = document.getElementById('meetingRoom');
            const room = document.getElementById('room');
            const roomNameSection = document.getElementById('roomNameSection');
            const regularRoomInput = document.getElementById('regularRoomInput');
            const meetingRoomInput = document.getElementById('meetingRoomInput');
            function toggleRoomInputs() {
                const isRoom = room.checked;
                const isMeeting = meetingRoom.checked;
                roomNameSection.style.display = isRoom || isMeeting ? 'block' : 'none';
                regularRoomInput.style.display = isRoom ? 'block' : 'none';
                meetingRoomInput.style.display = isMeeting ? 'block' : 'none';
                updateLocationPreview();
            }
            loungeArea.addEventListener('change', toggleRoomInputs);
            meetingRoom.addEventListener('change', toggleRoomInputs);
            room.addEventListener('change', toggleRoomInputs);
            // === SUGGESTION BUTTONS ===
            window.addSuggestion = function (text) {
                const input = document.getElementById('additionalRequirements');
                const cur = input.value.trim();
                input.value = cur ? cur + ', ' + text : text;
                updateLocationPreview();
            };
            // === CHAR COUNTERS ===
            function updateCharCount(id, countId, max, nonBlankMax) {
                const input = document.getElementById(id);
                const count = document.getElementById(countId);
                input.addEventListener('input', () => {
                    const len = input.value.length;
                    const nonBlank = input.value.replace(/\s/g, '').length;
                    count.textContent = `${len} / ${max} (${nonBlank} non-blank)`;
                    count.className = 'char-count';
                    if (nonBlank > nonBlankMax) count.classList.add('error');
                    else if (nonBlank > nonBlankMax * 0.8) count.classList.add('warning');
                });
            }
            updateCharCount('posterTitle', 'posterTitleCount', 40, 37);
            updateCharCount('posterSubtitle', 'posterSubtitleCount', 40, 37);
            updateCharCount('edmTitle', 'edmTitleCount', 40, 37);
            updateCharCount('edmSubtitle', 'edmSubtitleCount', 40, 37);
            ['posterBullet1', 'posterBullet2', 'posterBullet3', 'edmBullet1', 'edmBullet2', 'edmBullet3'].forEach(id => {
                const input = document.getElementById(id);
                const count = document.getElementById(id + 'Count');
                input.addEventListener('input', () => {
                    count.textContent = `${input.value.length} / 70`;
                    count.className = input.value.length > 70 ? 'char-count error' : 'char-count';
                });
            });
            // === POSTER / EDM TOGGLE & SYNC ===
            const needPoster = document.getElementById('needPoster');
            const posterDetails = document.getElementById('posterDetailsSection');
            const needEDM = document.getElementById('needEDM');
            const edmDetails = document.getElementById('edmDetailsSection');
            needPoster.addEventListener('change', () => {
                posterDetails.classList.toggle('hidden', !needPoster.checked);
                syncContent();
            });
            needEDM.addEventListener('change', () => {
                edmDetails.classList.toggle('hidden', !needEDM.checked);
                if (needEDM.checked) setTimeout(() => edmDetails.scrollIntoView({ behavior: 'smooth', block: 'start' }), 100);
                syncContent();
            });
            document.getElementById('posterHasSubtitle').addEventListener('change', function() {
                document.getElementById('posterSubtitleInput').classList.toggle('hidden', !this.checked);
                document.getElementById('posterSubtitleAuto').classList.toggle('hidden', this.checked);
                syncContent();
            });
            document.getElementById('edmHasSubtitle').addEventListener('change', function() {
                document.getElementById('edmSubtitleInput').classList.toggle('hidden', !this.checked);
                document.getElementById('edmSubtitleAuto').classList.toggle('hidden', this.checked);
                syncContent();
            });
            function syncContent() {
                if (needPoster.checked && needEDM.checked) {
                    document.getElementById('edmTitle').value = document.getElementById('posterTitle').value;
                    document.getElementById('edmHasSubtitle').checked = document.getElementById('posterHasSubtitle').checked;
                    document.getElementById('edmSubtitle').value = document.getElementById('posterHasSubtitle').checked ? document.getElementById('posterSubtitle').value : '';
                    ['1', '2', '3'].forEach(i => document.getElementById('edmBullet' + i).value = document.getElementById('posterBullet' + i).value);
                    document.getElementById('posterTitle').value = document.getElementById('edmTitle').value;
                    document.getElementById('posterHasSubtitle').checked = document.getElementById('edmHasSubtitle').checked;
                    document.getElementById('posterSubtitle').value = document.getElementById('edmHasSubtitle').checked ? document.getElementById('edmSubtitle').value : '';
                    ['1', '2', '3'].forEach(i => document.getElementById('posterBullet' + i).value = document.getElementById('edmBullet' + i).value);
                    document.getElementById('posterSubtitleInput').classList.toggle('hidden', !document.getElementById('posterHasSubtitle').checked);
                    document.getElementById('posterSubtitleAuto').classList.toggle('hidden', document.getElementById('posterHasSubtitle').checked);
                    document.getElementById('edmSubtitleInput').classList.toggle('hidden', !document.getElementById('edmHasSubtitle').checked);
                    document.getElementById('edmSubtitleAuto').classList.toggle('hidden', document.getElementById('edmHasSubtitle').checked);
                    ['posterTitle', 'posterSubtitle', 'edmTitle', 'edmSubtitle'].forEach(id => {
                        const input = document.getElementById(id);
                        const count = document.getElementById(id + 'Count');
                        const len = input.value.length;
                        const nonBlank = input.value.replace(/\s/g, '').length;
                        count.textContent = `${len} / 40 (${nonBlank} non-blank)`;
                    });
                    ['posterBullet1', 'posterBullet2', 'posterBullet3', 'edmBullet1', 'edmBullet2', 'edmBullet3'].forEach(id => {
                        const count = document.getElementById(id + 'Count');
                        count.textContent = `${document.getElementById(id).value.length} / 70`;
                    });
                }
            }
            ['posterTitle', 'posterSubtitle', 'posterBullet1', 'posterBullet2', 'posterBullet3',
                'edmTitle', 'edmSubtitle', 'edmBullet1', 'edmBullet2', 'edmBullet3'].forEach(id => {
                document.getElementById(id).addEventListener('input', syncContent);
            });
            ['posterHasSubtitle', 'edmHasSubtitle'].forEach(id => {
                document.getElementById(id).addEventListener('change', syncContent);
            });
            // === AUTO CROP & CONVERT TO PNG ===
            function autoCropAndConvertToPng(file, callback) {
                const img = new Image();
                img.onload = () => {
                    const canvas = document.createElement('canvas');
                    const ctx = canvas.getContext('2d');
                    canvas.width = 1080;
                    canvas.height = 1080;
                    const scale = Math.max(1080 / img.width, 1080 / img.height);
                    const w = img.width * scale;
                    const h = img.height * scale;
                    ctx.drawImage(img, (1080 - w) / 2, (1080 - h) / 2, w, h);
                    canvas.toBlob(blob => {
                        const pngFile = new File([blob], file.name.replace(/\.[^/.]+$/, ".png"), { type: 'image/png' });
                        const previewUrl = URL.createObjectURL(pngFile);
                        callback(pngFile, previewUrl);
                    }, 'image/png', 0.9);
                };
                img.onerror = () => callback(null, null);
                img.src = URL.createObjectURL(file);
            }
            // === LOGO UPLOAD ===
            let processedLogoFile = null;
            const logoInput = document.getElementById('posterLogoInput');
            const logoPreview = document.getElementById('logoPreview');
            const logoPreviewContainer = document.getElementById('logoPreviewContainer');
            logoInput.addEventListener('change', () => {
                const file = logoInput.files[0];
                if (!file) return;
                logoPreviewContainer.classList.add('hidden');
                autoCropAndConvertToPng(file, (pngFile, url) => {
                    if (pngFile && url) {
                        processedLogoFile = pngFile;
                        logoPreview.src = url;
                        logoPreviewContainer.classList.remove('hidden');
                    }
                });
            });
            // === KEY IMAGES ===
            let autoCroppedKeyImages = [];
            const keyImagesInput = document.getElementById('posterKeyImagesInput');
            const keyImagePreviews = document.getElementById('keyImagePreviews');
            keyImagesInput.addEventListener('change', () => {
                keyImagePreviews.innerHTML = '';
                autoCroppedKeyImages = [];
                Array.from(keyImagesInput.files).forEach((file, idx) => {
                    const div = document.createElement('div');
                    div.className = 'key-image-item';
                    div.innerHTML = `<p class="text-sm">Processing <strong>${file.name}</strong>...</p>`;
                    keyImagePreviews.appendChild(div);
                    autoCropAndConvertToPng(file, (pngFile, url) => {
                        if (pngFile && url) {
                            autoCroppedKeyImages[idx] = pngFile;
                            div.innerHTML = `
                                <img src="${url}" class="image-preview" alt="Key image ${idx + 1}">
                                <p class="text-xs text-green-600 mt-1">Converted to PNG</p>
                            `;
                            updateEdmBannerFromKeyImage();
                        }
                    });
                });
            });
            // === EDM BANNER SOURCE SELECTOR ===
            const edmBannerSource = document.getElementById('edmBannerSource');
            const edmBannerUploadSection = document.getElementById('edmBannerUploadSection');
            const edmBannerInput = document.getElementById('edmBannerInput');
            const edmBannerPreview = document.getElementById('edmBannerPreview');
            let autoCroppedEdmBanner = null;
            function updateEdmBannerFromKeyImage() {
                if (edmBannerSource.value === 'copy' && autoCroppedKeyImages.length > 0 && autoCroppedKeyImages[0]) {
                    autoCroppedEdmBanner = autoCroppedKeyImages[0];
                    const url = URL.createObjectURL(autoCroppedEdmBanner);
                    edmBannerPreview.innerHTML = `
                        <img src="${url}" class="image-preview" alt="EDM Banner (from Poster)">
                        <p class="text-xs text-blue-600 mt-1">Copied from first Poster Key Image</p>
                    `;
                }
            }
            edmBannerSource.addEventListener('change', () => {
                const isCopy = edmBannerSource.value === 'copy';
                edmBannerUploadSection.style.display = isCopy ? 'none' : 'block';
                if (isCopy) {
                    updateEdmBannerFromKeyImage();
                } else {
                    edmBannerPreview.innerHTML = '';
                    autoCroppedEdmBanner = null;
                }
            });
            edmBannerInput.addEventListener('change', () => {
                const file = edmBannerInput.files[0];
                if (!file) return;
                edmBannerPreview.innerHTML = `<p class="text-sm">Processing <strong>${file.name}</strong>...</p>`;
                autoCropAndConvertToPng(file, (pngFile, url) => {
                    if (pngFile && url) {
                        autoCroppedEdmBanner = pngFile;
                        edmBannerPreview.innerHTML = `
                            <img src="${url}" class="image-preview" alt="EDM Banner">
                            <p class="text-xs text-green-600 mt-1">Converted to PNG</p>
                        `;
                    }
                });
            });
            // === CATERING TOGGLE ===
            document.getElementById('haveCatering').addEventListener('change', function () {
                document.getElementById('cateringDetailsSection').classList.toggle('hidden', !this.checked);
            });
            // === REGISTRATION LINK LOGIC ===
            const needRegisterLink = document.getElementById('needRegisterLink');
            const registerLinkSection = document.getElementById('registerLinkSection');
            const registerLinkInput = document.getElementById('registerLink');
            const manualLinkInput = document.getElementById('manualLinkInput');
            const buildLinkSection = document.getElementById('buildLinkSection');
            needRegisterLink.addEventListener('change', () => {
                registerLinkSection.classList.toggle('hidden', !needRegisterLink.checked);
            });
            document.querySelectorAll('input[name="linkSource"]').forEach(radio => {
                radio.addEventListener('change', () => {
                    const value = radio.value;
                    manualLinkInput.classList.toggle('hidden', value !== 'manual');
                    buildLinkSection.classList.toggle('hidden', value !== 'build');
                });
            });
            // === FORM SUBMISSION ===
            const submitButton = document.getElementById('submitButton');
            const loadingOverlay = document.getElementById('loadingOverlay');
            const loadingFill = document.getElementById('loadingFill');
            document.getElementById('eventForm').addEventListener('submit', async function (e) {
                e.preventDefault();
                const error = document.getElementById('errorMessage');
                const errorText = document.getElementById('errorText');
                error.classList.add('hidden');
                // Validation
                if (needEDM.checked && !autoCroppedEdmBanner) {
                    errorText.textContent = 'Please upload or copy the EDM Banner image.';
                    error.classList.remove('hidden');
                    return;
                }
                if (needPoster.checked && autoCroppedKeyImages.filter(b => b).length === 0) {
                    errorText.textContent = 'Please upload at least one key image.';
                    error.classList.remove('hidden');
                    return;
                }
                // Prepare data
                const formData = new FormData();
                formData.append('eventId', eventIdDisplay.textContent);
                formData.append('organizerName', document.getElementById('organizerName').value.trim());
                formData.append('organizerEmail', document.getElementById('organizerEmail').value.trim());
                formData.append('startTime', document.getElementById('startTime').value);
                formData.append('endTime', document.getElementById('endTime').value);
                formData.append('formattedTime', formattedTime); // Now in correct format: "2:37 PM - 5:45 PM"
                formData.append('date', document.getElementById('date').value);
                formData.append('clientName', document.getElementById('clientName').value.trim());
                formData.append('clientContact', document.getElementById('clientContact').value.trim());
                formData.append('companyName', document.getElementById('companyName').value.trim());
                formData.append('eventName', document.getElementById('eventName').value.trim());
                formData.append('country', countrySelect.value);
                formData.append('building', buildingSelect.value);
                formData.append('floor', floorSelect.value);
                formData.append('contactEmail', emailPreview.textContent);
                formData.append('formattedlocation', updateLocationPreview());
                formData.append('loungeArea', document.getElementById('loungeArea').checked);
                formData.append('meetingRoom', document.getElementById('meetingRoom').checked);
                formData.append('room', document.getElementById('room').checked);
                formData.append('regularRoomName', document.getElementById('regularRoomName').value.trim());
                formData.append('meetingRoomName', document.getElementById('meetingRoomName').value.trim());
                formData.append('additionalRequirements', document.getElementById('additionalRequirements').value.trim());
                formData.append('needPoster', needPoster.checked);
                formData.append('needEDM', needEDM.checked);
                formData.append('haveCatering', document.getElementById('haveCatering').checked);
                formData.append('cateringDetails', document.getElementById('cateringDetails').value.trim());
                formData.append('details', document.getElementById('details').value.trim());
                formData.append('posterTitle', document.getElementById('posterTitle').value.trim());
                formData.append('posterHasSubtitle', document.getElementById('posterHasSubtitle').checked);
                formData.append('posterSubtitle', document.getElementById('posterSubtitle').value.trim());
                formData.append('posterBullet1', document.getElementById('posterBullet1').value.trim());
                formData.append('posterBullet2', document.getElementById('posterBullet2').value.trim());
                formData.append('posterBullet3', document.getElementById('posterBullet3').value.trim());
                formData.append('edmTitle', document.getElementById('edmTitle').value.trim());
                formData.append('edmHasSubtitle', document.getElementById('edmHasSubtitle').checked);
                formData.append('edmSubtitle', document.getElementById('edmSubtitle').value.trim());
                formData.append('edmBullet1', document.getElementById('edmBullet1').value.trim());
                formData.append('edmBullet2', document.getElementById('edmBullet2').value.trim());
                formData.append('edmBullet3', document.getElementById('edmBullet3').value.trim());
                formData.append('needRegisterLink', needRegisterLink.checked);
                const linkSourceValue = document.querySelector('input[name="linkSource"]:checked').value;
                formData.append('linkSource', linkSourceValue);
                if (linkSourceValue === 'manual') {
                    formData.append('registerLink', registerLinkInput.value.trim());
                } else {
                    formData.append('registerLink', '');
                }
                // Files
                if (processedLogoFile) formData.append('posterLogo', processedLogoFile);
                autoCroppedKeyImages.forEach((blob, i) => {
                    if (blob) formData.append(`posterKeyImage_${i}`, blob, `keyimage_${i}.png`);
                });
                if (autoCroppedEdmBanner) formData.append('edmBanner', autoCroppedEdmBanner, 'edm_banner.png');
                // Reopen link with ALL data including linkSource
                const baseUrl = window.location.href.split('?')[0];
                const params = new URLSearchParams();
                for (let [key, value] of formData.entries()) {
                    if (typeof value === 'string') {
                        params.append(key, value);
                    }
                }
                const reopenLink = `${baseUrl}?${params.toString()}`;
                formData.append('reopenLink', reopenLink);
                // Submit
                loadingOverlay.classList.remove('hidden');
                submitButton.disabled = true;
                let progress = 0;
                const progressInterval = setInterval(() => {
                    progress = Math.min(progress + Math.random() * 15, 90);
                    loadingFill.style.width = progress + '%';
                }, 300);
                try {
                    const response = await fetch('https://hook.eu2.make.com/i2pvup7yc0fc8uj38wts4j2sqvsmty88', {
                        method: 'POST',
                        body: formData
                    });
                    clearInterval(progressInterval);
                    loadingFill.style.width = '100%';
                    setTimeout(() => {
                        if (response.ok) {
                            document.getElementById('webhookLink').textContent = reopenLink;
                            document.getElementById('successMessage').classList.remove('hidden');
                        } else {
                            throw new Error('Server error: ' + response.status);
                        }
                        loadingOverlay.classList.add('hidden');
                        submitButton.disabled = false;
                    }, 600);
                } catch (err) {
                    clearInterval(progressInterval);
                    loadingOverlay.classList.add('hidden');
                    submitButton.disabled = false;
                    errorText.textContent = 'Submission failed. Please try again.';
                    error.classList.remove('hidden');
                }
            });
            // === LOAD FROM URL PARAMS (including linkSource) ===
            const urlParams = new URLSearchParams(window.location.search);
            if (urlParams.toString()) {
                document.getElementById('passwordPage').classList.add('hidden');
                document.getElementById('formPage').classList.remove('hidden');
                const fillField = (id, value) => {
                    const el = document.getElementById(id);
                    if (el) el.value = value || '';
                };
                const fillCheckbox = (id, value) => {
                    const el = document.getElementById(id);
                    if (el) el.checked = value === 'true';
                };
                fillField('eventIdDisplay', urlParams.get('eventId'));
                fillField('organizerName', urlParams.get('organizerName'));
                fillField('organizerEmail', urlParams.get('organizerEmail'));
                fillField('startTime', urlParams.get('startTime'));
                fillField('endTime', urlParams.get('endTime'));
                fillField('date', urlParams.get('date'));
                fillField('clientName', urlParams.get('clientName'));
                fillField('clientContact', urlParams.get('clientContact'));
                fillField('companyName', urlParams.get('companyName'));
                fillField('eventName', urlParams.get('eventName'));
                fillField('country', urlParams.get('country'));
                fillField('building', urlParams.get('building'));
                fillField('floor', urlParams.get('floor'));
                fillCheckbox('loungeArea', urlParams.get('loungeArea'));
                fillCheckbox('meetingRoom', urlParams.get('meetingRoom'));
                fillCheckbox('room', urlParams.get('room'));
                fillField('regularRoomName', urlParams.get('regularRoomName'));
                fillField('meetingRoomName', urlParams.get('meetingRoomName'));
                fillField('additionalRequirements', urlParams.get('additionalRequirements'));
                fillCheckbox('needPoster', urlParams.get('needPoster'));
                fillCheckbox('needEDM', urlParams.get('needEDM'));
                fillCheckbox('haveCatering', urlParams.get('haveCatering'));
                fillField('cateringDetails', urlParams.get('cateringDetails'));
                fillField('details', urlParams.get('details'));
                fillField('posterTitle', urlParams.get('posterTitle'));
                fillCheckbox('posterHasSubtitle', urlParams.get('posterHasSubtitle'));
                fillField('posterSubtitle', urlParams.get('posterSubtitle'));
                fillField('posterBullet1', urlParams.get('posterBullet1'));
                fillField('posterBullet2', urlParams.get('posterBullet2'));
                fillField('posterBullet3', urlParams.get('posterBullet3'));
                fillField('edmTitle', urlParams.get('edmTitle'));
                fillCheckbox('edmHasSubtitle', urlParams.get('edmHasSubtitle'));
                fillField('edmSubtitle', urlParams.get('edmSubtitle'));
                fillField('edmBullet1', urlParams.get('edmBullet1'));
                fillField('edmBullet2', urlParams.get('edmBullet2'));
                fillField('edmBullet3', urlParams.get('edmBullet3'));
                fillCheckbox('needRegisterLink', urlParams.get('needRegisterLink'));
                fillField('registerLink', urlParams.get('registerLink'));
                const linkSource = urlParams.get('linkSource');
                if (linkSource) {
                    const radio = document.querySelector(`input[name="linkSource"][value="${linkSource}"]`);
                    if (radio) radio.checked = true;
                }
                updateBuildingOptions();
                updateFloorOptions();
                updateEmail();
                updateLocationPreview();
                toggleRoomInputs();
                document.getElementById('needPoster').dispatchEvent(new Event('change'));
                document.getElementById('needEDM').dispatchEvent(new Event('change'));
                document.getElementById('needRegisterLink').dispatchEvent(new Event('change'));
                document.querySelector(`input[name="linkSource"]:checked`)?.dispatchEvent(new Event('change'));
                updateFormattedTime();
            }
        });
    </script>
</body>
</html>
