<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Image Cropper – 16:9 + Full Compass Shape</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>

<style>
  body {
    font-family: system-ui, sans-serif;
    background: #fffaf5;
    margin: 0;
    padding: 20px;
    color: #222;
  }

  .container { max-width: 1280px; margin: 0 auto; }
  h1 { text-align: center; color: #ff6600; margin-bottom: 0.8em; }

  .upload-area {
    border: 3px dashed #ffb366;
    border-radius: 16px;
    padding: 60px;
    text-align: center;
    background: white;
    transition: all 0.3s;
    cursor: pointer;
    margin: 30px 0;
  }

  .upload-area:hover, .upload-area.drag { background: #fff5eb; border-color: #ff6600; }

  .controls {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
    gap: 20px;
    margin-bottom: 40px;
  }

  .control-group { padding: 16px; background: white; border-radius: 12px; box-shadow: 0 2px 10px rgba(0,0,0,0.07); }

  .preview-area {
    display: flex;
    flex-wrap: wrap;
    gap: 40px;
    justify-content: center;
  }

  .preview-box {
    background: white;
    padding: 20px;
    border-radius: 12px;
    box-shadow: 0 4px 16px rgba(0,0,0,0.08);
    text-align: center;
  }

  .preview-container {
    width: 480px;
    height: 270px;           /* fixed 16:9 */
    margin: 16px auto;
    overflow: hidden;
    background: #fff8f2;
    border-radius: 10px;
    position: relative;
    cursor: grab;
    user-select: none;
    touch-action: none;
  }

  .preview-container:active { cursor: grabbing; }

  .preview-image {
    position: absolute;
    width: 100%;
    height: 100%;
    object-fit: cover;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    transition: transform 0.08s ease-out;
    pointer-events: none;
  }

  .download-btn {
    padding: 10px 28px;
    background: #ff6600;
    color: white;
    border: none;
    border-radius: 8px;
    font-size: 1.05rem;
    cursor: pointer;
  }

  .download-btn:hover { background: #e65c00; }
</style>
</head>
<body>

<div class="container">
  <h1>Image Cropper – 16:9 + Full Compass Shape</h1>

  <div class="upload-area" id="dropArea">
    <p><strong>Click</strong> or drag & drop image</p>
  </div>

  <div class="controls">
    <div class="control-group">
      <label>Corner Radius: <span id="radiusVal">20</span>px</label>
      <input type="range" id="radius" min="0" max="300" value="20" step="5">
    </div>
    <div class="control-group">
      <label>Scale: <span id="scaleVal">1.0</span></label>
      <input type="range" id="scale" min="0.5" max="4" value="1.0" step="0.05">
    </div>
  </div>

  <div class="preview-area">
    <div class="preview-box">
      <h3>Rounded 16:9</h3>
      <div class="preview-container" id="roundedCont">
        <img id="roundedImg" class="preview-image">
      </div>
      <button class="download-btn" data-type="rounded">Download Rounded</button>
    </div>

    <div class="preview-box">
      <h3>Compass Shape (full visible)</h3>
      <div class="preview-container" id="shapeCont">
        <img id="shapeImg" class="preview-image">
      </div>
      <button class="download-btn" data-type="shape">Download Shape</button>
    </div>
  </div>
</div>

<svg width="0" height="0" style="position:absolute">
  <defs>
    <mask id="compass-mask">
      <path fill="white" d="M514,57.5v203c0,6.35-5.15,11.5-11.5,11.5h-22c-6.35,0-11.5,5.15-11.5,11.5v53.82c0,6.35-5.15,11.5-11.5,11.5H34.5c-6.35,0-11.5-5.15-11.5-11.5v-91.82c0-6.35-5.15-11.5-11.5-11.5h0c-6.35,0-11.5-5.15-11.5-11.5V11.5C0,5.15,5.15,0,11.5,0h416c6.35,0,11.5,5.15,11.5,11.5v23c0,6.35,5.15,11.5,11.5,11.5h52c6.35,0,11.5,5.15,11.5,11.5Z"/>
    </mask>
  </defs>
</svg>

<script>
const dropArea = document.getElementById('dropArea');
const roundedImg = document.getElementById('roundedImg');
const shapeImg = document.getElementById('shapeImg');

const radiusSlider = document.getElementById('radius');
const scaleSlider = document.getElementById('scale');

const radiusVal = document.getElementById('radiusVal');
const scaleVal = document.getElementById('scaleVal');

let currentScale = 1.0;
let currentX = 0;
let currentY = 0;
let isDragging = false;
let startX, startY, activeCont;

function updateDisplay() {
  const t = `translate(-50%, -50%) translate(${currentX}px, ${currentY}px) scale(${currentScale})`;
  roundedImg.style.transform = t;
  shapeImg.style.transform = t;

  scaleVal.textContent = currentScale.toFixed(2);
  scaleSlider.value = currentScale;
}

function resetView() {
  currentScale = 1.0;
  currentX = 0;
  currentY = 0;
  updateDisplay();
}

function startDrag(e, container) {
  isDragging = true;
  activeCont = container;
  startX = e.clientX - currentX;
  startY = e.clientY - currentY;
  container.style.cursor = 'grabbing';
  e.preventDefault();
}

function moveDrag(e) {
  if (!isDragging) return;
  currentX = e.clientX - startX;
  currentY = e.clientY - startY;
  updateDisplay();
}

function endDrag() {
  if (!isDragging) return;
  isDragging = false;
  if (activeCont) activeCont.style.cursor = 'grab';
}

// Setup interaction for both containers
[document.getElementById('roundedCont'), document.getElementById('shapeCont')].forEach(cont => {
  // Mouse wheel zoom
  cont.addEventListener('wheel', e => {
    e.preventDefault();
    const delta = e.deltaY < 0 ? 0.08 : -0.08;
    currentScale = Math.max(0.5, Math.min(4, currentScale + delta));
    updateDisplay();
  }, { passive: false });

  // Drag
  cont.addEventListener('pointerdown', e => startDrag(e, cont));
  window.addEventListener('pointermove', moveDrag);
  window.addEventListener('pointerup', endDrag);
  window.addEventListener('pointercancel', endDrag);

  // Double click reset
  cont.addEventListener('dblclick', resetView);
});

// Upload
dropArea.addEventListener('click', () => document.getElementById('imageInput')?.click());
dropArea.addEventListener('drop', e => {
  e.preventDefault();
  dropArea.classList.remove('drag');
  const file = e.dataTransfer.files[0];
  if (file?.type.startsWith('image/')) loadImage(file);
});
['dragover','dragenter'].forEach(ev => dropArea.addEventListener(ev, e => {
  e.preventDefault();
  dropArea.classList.add('drag');
}));
['dragleave','drop'].forEach(ev => dropArea.addEventListener(ev, e => {
  e.preventDefault();
  dropArea.classList.remove('drag');
}));

function loadImage(file) {
  const reader = new FileReader();
  reader.onload = e => {
    roundedImg.src = e.target.result;
    shapeImg.src = e.target.result;
    resetView();
  };
  reader.readAsDataURL(file);
}

// Mask setup
Object.assign(document.getElementById('shapeCont').style, {
  maskImage: 'url(#compass-mask)',
  webkitMaskImage: 'url(#compass-mask)',
  maskSize: 'contain',
  webkitMaskSize: 'contain',
  maskPosition: 'center',
  webkitMaskPosition: 'center',
  maskRepeat: 'no-repeat'
});

// Slider listeners
radiusSlider.addEventListener('input', () => radiusVal.textContent = radiusSlider.value);
scaleSlider.addEventListener('input', () => {
  currentScale = parseFloat(scaleSlider.value);
  updateDisplay();
});
</script>
</body>
</html>
