<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Compass Offices Client Logo Layout Editor</title>
    <link rel="icon" type="image/x-icon" href="https://compassoffices.github.io/img/logo/new-p1-32.png">
    <link
      href="https://fonts.googleapis.com/css2?family=SF+Pro+Display:wght@300;400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <style>
      :root {
        --font-primary: "SF Pro Display", sans-serif;
        --bg-color: #f5f5f7;
        --container-bg: #ffffff;
        --border-radius: 20px;
        --text-main: #1d1d1f;
        --sidebar-bg: #ffffff;
        --sidebar-width: 280px;
        --sidebar-collapsed-width: 50px;
        --button-orange: #ff6600;
        --button-orange-hover: #cc5200;
        --button-black: #000000;
        --button-black-hover: #333333;
      }
      body {
        font-family: var(--font-primary);
        background: var(--bg-color);
        margin: 0;
        padding: 20px;
        color: var(--text-main);
        display: flex;
        min-height: 100vh;
        overflow-x: hidden;
      }
      .sidebar {
        width: var(--sidebar-width);
        background: var(--sidebar-bg);
        padding: 20px;
        border-radius: var(--border-radius);
        box-shadow: 2px 6px 20px rgba(0, 0, 0, 0.1);
        display: flex;
        flex-direction: column;
        gap: 15px;
        height: calc(100vh - 40px);
        overflow-y: auto;
        transition: width 0.3s ease;
        position: fixed;
        z-index: 1000;
      }
      .sidebar.collapsed {
        width: var(--sidebar-collapsed-width);
      }
      .sidebar.collapsed .controls {
        display: none;
      }
      .toggle-sidebar-btn {
        display: none;
        position: absolute;
        top: 20px;
        right: -15px;
        width: 40px;
        height: 40px;
        background: var(--button-orange);
        color: white;
        border: none;
        border-radius: 50%;
        cursor: pointer;
        font-size: 20px;
        line-height: 40px;
        text-align: center;
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
        transition: background 0.2s ease;
      }
      .sidebar.collapsed .toggle-sidebar-btn {
        display: block;
      }
      .toggle-sidebar-btn:hover {
        background: var(--button-orange-hover);
      }
      .main-content {
        margin-left: calc(var(--sidebar-width) + 40px);
        flex-grow: 1;
        display: flex;
        justify-content: center;
        align-items: center;
        transition: margin-left 0.3s ease;
      }
      .main-content.sidebar-collapsed {
        margin-left: calc(var(--sidebar-collapsed-width) + 40px);
      }
      .container {
        width: 90%;
        max-width: 1000px;
        background: var(--container-bg);
        padding: 30px;
        border-radius: var(--border-radius);
        box-shadow: 0 6px 20px rgba(0, 0, 0, 0.1);
      }
      .controls {
        display: flex;
        flex-direction: column;
        gap: 12px;
      }
      .button, .button-black, .button-link {
        padding: 12px 20px;
        font-size: 14px;
        border-radius: var(--border-radius);
        border: none;
        cursor: pointer;
        background: var(--button-orange);
        color: white;
        transition: background 0.2s ease;
        width: 100%;
        text-align: center;
        box-sizing: border-box;
        text-decoration: none;
        display: inline-block;
      }
      .button:hover, .button-link:hover {
        background: var(--button-orange-hover);
      }
      .button-black {
        background: var(--button-black);
      }
      .button-black:hover {
        background: var(--button-black-hover);
      }
      select,
      input[type="text"] {
        padding: 12px;
        font-size: 14px;
        border-radius: var(--border-radius);
        border: 1px solid #d1d1d1;
        background: #fff;
        width: 100%;
        box-sizing: border-box;
        transition: border-color 0.2s ease;
      }
      select:focus,
      input[type="text"]:focus {
        border-color: var(--button-orange);
        outline: none;
      }
      .checkbox-group {
        display: flex;
        align-items: center;
        gap: 8px;
        font-size: 14px;
        background: #f9f9f9;
        padding: 10px;
        border-radius: var(--border-radius);
        border: 1px solid #d1d1d1;
      }
      input[type="checkbox"] {
        appearance: none;
        width: 18px;
        height: 18px;
        border-radius: 50%;
        border: 2px solid rgba(0, 123, 255, 0.8);
        background-color: transparent;
        cursor: pointer;
        position: relative;
        transition: background 0.2s ease;
      }
      input[type="checkbox"]:checked {
        background-color: rgba(0, 123, 255, 0.15);
      }
      input[type="checkbox"]:checked::after {
        content: "✔";
        color: rgba(0, 123, 255, 1);
        font-size: 12px;
        font-weight: bold;
        position: absolute;
        top: 1px;
        left: 3px;
      }
      .industry-group {
        text-align: left;
        margin-bottom: 30px;
        position: relative;
      }
      .industry-title {
        font-size: 18px;
        font-weight: 600;
        margin-bottom: 10px;
        padding-left: 5px;
      }
      .divider {
        height: 1px;
        background-color: var(--button-orange);
        margin: 10px 0;
        border-radius: 1px;
      }
      .hide-divider .divider {
        display: none;
      }
      .client-list {
        display: flex;
        flex-wrap: wrap;
        gap: 12px;
        justify-content: center;
      }
      .client-logo {
        background: #fff;
        border: 1px solid #d1d1d1;
        border-radius: var(--border-radius);
        resize: horizontal;
        overflow: hidden;
        display: flex;
        align-items: center;
        justify-content: center;
        min-width: 80px;
        max-width: 300px;
        width: 100px;
        height: 100px;
        position: relative;
      }
      .image-wrapper {
        width: 100%;
        height: 100%;
        overflow: hidden;
        display: flex;
        align-items: center;
        justify-content: center;
        position: relative;
      }
      .client-logo img {
        max-width: 100%;
        max-height: 100%;
        object-fit: contain;
        transform: scale(1);
        transition: transform 0.2s ease;
        pointer-events: none;
        z-index: 1;
      }
      .client-name {
        position: absolute;
        bottom: 4px;
        left: 50%;
        transform: translateX(-50%);
        font-size: 12px;
        color: #333;
        background: rgba(255, 255, 255, 0.85);
        padding: 2px 6px;
        border-radius: 4px;
        display: none;
        z-index: 30;
      }
      .client-logo:hover .client-name {
        display: block;
      }
      .checkbox-container {
        position: absolute;
        top: 0;
        right: 0;
        margin: 4px;
        padding: 2px;
        z-index: 10;
      }
      .preview .client-logo {
        border: none !important;
        resize: none !important;
      }
      .preview .checkbox-container,
      .preview .client-name,
      .preview .scale-btn {
        display: none !important;
      }
      .client-logo.dragging {
        opacity: 0.4;
      }
      .scale-btn {
        background: rgba(255, 255, 255, 0.4);
        backdrop-filter: blur(6px);
        color: #000;
        border: 1px solid rgba(255, 255, 255, 0.6);
        border-radius: 50%;
        font-size: 14px;
        font-weight: bold;
        width: 20px;
        height: 20px;
        cursor: pointer;
        padding: 0;
        display: flex;
        align-items: center;
        justify-content: center;
        line-height: 1;
        box-shadow: 0 1px 2px rgba(0, 0, 0, 0.2);
        transition: background 0.2s ease;
        position: absolute;
        z-index: 40;
      }
      .scale-btn:hover {
        background: rgba(255, 255, 255, 0.6);
      }
      .scale-btn.plus {
        bottom: 6px;
        left: 6px;
      }
      .scale-btn.minus {
        bottom: 6px;
        right: 6px;
      }
#clientsSection {
  width: 800px; /* starting width */
  height: 600px; /* starting height */
  min-width: 300px;
  min-height: 300px;
  margin: 20px auto;
  padding: 20px;
  box-sizing: border-box;
  background: var(--container-bg);
  border-radius: var(--border-radius);
  box-shadow: 0 6px 20px rgba(0, 0, 0, 0.1);
  overflow: auto;
  resize: both;
}
      @media (max-width: 768px) {
        .sidebar {
          width: 100%;
          height: auto;
          position: static;
          padding: 15px;
        }
        .sidebar.collapsed {
          width: 100%;
          height: 50px;
          padding: 0;
        }
        .sidebar.collapsed .toggle-sidebar-btn {
          position: static;
          width: 100%;
          height: 100%;
          border-radius: var(--border-radius);
          display: flex;
          align-items: center;
          justify-content: center;
          font-size: 18px;
        }
        .main-content {
          margin-left: 0;
          flex-direction: column;
        }
        .main-content.sidebar-collapsed {
          margin-left: 0;
        }
        .controls {
          gap: 10px;
        }
        .button, .button-black, .button-link,
        select,
        input[type="text"] {
          font-size: 12px;
          padding: 10px;
        }
        .checkbox-group {
          padding: 8px;
        }
        #clientsSection {
          width: 100%;
          max-height: 70vh;
          margin: 10px 0;
        }
      }
    </style>
  </head>
  <body>
    <div class="sidebar" id="sidebar">
      <button class="toggle-sidebar-btn" onclick="toggleSidebar()">☰</button>
      <div class="controls">
        <select id="industrySelect">
          <option value="all">All Groups</option>
          <option value="finance">Finance, Banking & Insurance</option>
          <option value="tech">Technology & Telecommunications</option>
          <option value="retail">Retail, Hospitality & Lifestyle</option>
          <option value="logistics">Logistics, Consulting & Professional Services</option>
        </select>
        <div class="checkbox-group">
          <input type="checkbox" id="toggleHidden" onchange="toggleHiddenLogos()" />
          <label for="toggleHidden">Show Hidden Logos</label>
        </div>
        <div class="checkbox-group">
          <input type="checkbox" id="toggleSectorTitles" checked onchange="toggleSectorTitles()" />
          <label for="toggleSectorTitles">Show All Sectors</label>
        </div>
        <div class="checkbox-group">
          <input type="checkbox" id="toggleDividers" checked onchange="toggleDividers()" />
          <label for="toggleDividers">Hide Sector Dividers</label>
        </div>
        <button class="button" id="toggleModeBtn" onclick="togglePreview()">
          Create
        </button>
        <a
          href="https://docs.google.com/forms/d/e/1FAIpQLSefa4jK8eSB8feq2D_qN5pPSaACFWpnwlZoTVAtSconDBOeRA/viewform"
          target="_blank"
          class="button button-link"
        >Submit Logo</a>
        <button class="button" onclick="generateLayoutCode()">
          Generate Layout Code
        </button>
        <input
          type="text"
          id="layoutCodeInput"
          placeholder="Paste layout code here"
        />
        <button class="button button-black" onclick="loadLayoutCode()">
          Load Layout
        </button>
      </div>
    </div>
    <div class="main-content" id="mainContent">
      <div class="container" id="clientsSection">
        <div class="industry-group" id="group-finance">
          <div class="industry-title">Finance, Banking & Insurance</div>
          <div class="divider"></div>
          <div class="client-list" id="financeList"></div>
        </div>
        <div class="industry-group" id="group-tech">
          <div class="industry-title">Technology & Telecommunications</div>
          <div class="divider"></div>
          <div class="client-list" id="techList"></div>
        </div>
        <div class="industry-group" id="group-retail">
          <div class="industry-title">Retail, Hospitality & Lifestyle</div>
          <div class="divider"></div>
          <div class="client-list" id="retailList"></div>
        </div>
        <div class="industry-group" id="group-logistics">
          <div class="industry-title">Logistics, Consulting & Professional Services</div>
          <div class="divider"></div>
          <div class="client-list" id="logisticsList"></div>
        </div>
      </div>
    </div>

    <script>
      const hiddenLogos = new Set();

      const defaultLayoutCode = `size:1000x1160|finance:5:0.50:1:91,finance:6:0.90:1:116,finance:10:0.90:1:120,finance:18:0.90:1:134,finance:21:0.60:1:107,finance:19:1.00:1:120,finance:24:0.90:1:120,finance:33:0.90:1:243,finance:42:0.90:1:120,finance:40:1.00:1:120,finance:25:1.20:1:120,finance:43:1.00:1:120,finance:46:1.40:1:120,tech:49:0.70:1:101,tech:12:1.00:1:120,tech:7:1.10:1:120,tech:13:0.80:1:120,tech:38:1.00:1:120,tech:16:1.00:1:120,tech:20:0.70:1:99,tech:22:1.00:1:134,tech:23:1.00:1:120,tech:32:1.00:1:120,tech:35:0.90:1:113,tech:44:0.90:1:173,retail:2:1.00:1:94,retail:11:0.90:1:120,retail:37:0.80:1:120,retail:3:1.00:1:111,retail:8:1.10:1:85,retail:39:0.90:1:97,retail:14:0.70:1:101,retail:15:0.70:1:105,retail:26:1.00:1:109,retail:27:1.00:1:120,retail:29:1.20:1:127,retail:45:0.90:1:109,retail:41:0.60:1:105,retail:17:0.90:1:107,retail:48:0.60:1:107,logistics:4:0.80:1:120,logistics:9:0.90:1:120,logistics:50:0.70:1:120,logistics:30:0.60:1:120,logistics:31:0.70:1:120,logistics:34:0.70:1:126,logistics:47:1.10:1:211,logistics:28:0.90:1:180,logistics:36:1.50:1:185`;

      let pendingLayoutCode = defaultLayoutCode;

      function toggleSidebar() {
        const sidebar = document.getElementById("sidebar");
        const mainContent = document.getElementById("mainContent");
        sidebar.classList.toggle("collapsed");
        mainContent.classList.toggle("sidebar-collapsed");
      }

      function togglePreview() {
        const section = document.getElementById("clientsSection");
        section.classList.toggle("preview");
        document.getElementById("toggleModeBtn").textContent =
          section.classList.contains("preview") ? "Release" : "Generate";
        document
          .querySelectorAll(".client-toggle")
          .forEach(
            (cb) => (cb.disabled = section.classList.contains("preview"))
          );
      }

      function toggleSectorTitles() {
        document.querySelectorAll(".industry-title").forEach((title) => {
          title.style.display = document.getElementById("toggleSectorTitles")
            .checked
            ? "block"
            : "none";
        });
      }

      function toggleDividers() {
        const hide = !document.getElementById("toggleDividers").checked;
        document
          .querySelectorAll(".industry-group")
          .forEach((group) => group.classList.toggle("hide-divider", hide));
      }

      function toggleLogo(index) {
        const logo = document.getElementById(`logo-${index}`);
        const checkbox = logo.querySelector(".client-toggle");
        const showHidden = document.getElementById("toggleHidden").checked;
        if (checkbox.checked) {
          hiddenLogos.delete(index);
          logo.style.display = "flex";
        } else {
          hiddenLogos.add(index);
          logo.style.display = showHidden ? "flex" : "none";
        }
      }

      function toggleHiddenLogos() {
        const showHidden = document.getElementById("toggleHidden").checked;
        hiddenLogos.forEach((index) => {
          const logo = document.getElementById(`logo-${index}`);
          if (logo) logo.style.display = showHidden ? "flex" : "none";
        });
      }

      document
        .getElementById("industrySelect")
        .addEventListener("change", function () {
          const value = this.value;
          ["finance", "tech", "retail", "logistics"].forEach((id) => {
            document.getElementById(`group-${id}`).style.display =
              value === "all" || value === id ? "block" : "none";
          });
        });

      function makeDraggable(containerId) {
        const container = document.getElementById(containerId);
        let dragged;
        container.addEventListener("dragstart", (e) => {
          if (e.target.classList.contains("client-logo")) {
            dragged = e.target;
            e.target.classList.add("dragging");
          }
        });
        container.addEventListener("dragover", (e) => {
          e.preventDefault();
          const target = e.target.closest(".client-logo");
          if (target && target !== dragged) {
            const rect = target.getBoundingClientRect();
            const next = (e.clientX - rect.left) / rect.width > 0.5;
            container.insertBefore(dragged, next ? target.nextSibling : target);
          }
        });
        container.addEventListener("dragend", (e) =>
          e.target.classList.remove("dragging")
        );
      }

      function zoomImage(img, delta) {
        const current = parseFloat(img.dataset.scale || "1");
        let newScale = Math.min(5, Math.max(0.1, current + delta));
        img.dataset.scale = newScale.toFixed(2);
        img.style.transform = `scale(${newScale})`;
      }

      function generateLayoutCode() {
        const layout = [];
        const sectors = ["finance", "tech", "retail", "logistics"];
        sectors.forEach((sector) => {
          const container = document.getElementById(sector + "List");
          const logos = container.querySelectorAll(".client-logo");
          logos.forEach((logo) => {
            const id = logo.id.replace("logo-", "");
            const scale = parseFloat(
              logo.querySelector("img").dataset.scale || "1"
            ).toFixed(2);
            const visible = logo.querySelector(".client-toggle").checked
              ? 1
              : 0;
            const width = parseInt(window.getComputedStyle(logo).width);
            layout.push(`${sector}:${id}:${scale}:${visible}:${width}`);
          });
        });

        const clientsSection = document.getElementById("clientsSection");
        const width = clientsSection.offsetWidth;
        const height = clientsSection.offsetHeight;
        const sizePrefix = `size:${width}x${height}|`;

        const code = sizePrefix + layout.join(",");
        prompt("Copy your layout code:", code);
      }

      function loadLayoutCode() {
        const code = document.getElementById("layoutCodeInput").value.trim();
        if (!code) return alert("Please paste a layout code.");
        pendingLayoutCode = code;
        if (window._logosLoaded) applyLayoutCode(code);
      }

      function applyLayoutCode(code) {
        const [meta, data] = code.split("|");
        if (!meta.startsWith("size:"))
          return alert("Invalid layout code format.");

        const size = meta.replace("size:", "").split("x");
        const width = parseInt(size[0]);
        const height = parseInt(size[1]);

        const clientsSection = document.getElementById("clientsSection");
        clientsSection.style.width = width + "px";
        clientsSection.style.height = height + "px";

        const entries = data.split(",");
        const layout = entries.map((entry) => {
          const [sector, id, scale, visible, boxWidth] = entry.split(":");
          return {
            sector,
            id,
            scale: parseFloat(scale),
            visible: visible === "1",
            boxWidth: parseInt(boxWidth),
          };
        });

        const sectorMap = { finance: [], tech: [], retail: [], logistics: [] };

        layout.forEach(({ sector, id, scale, visible, boxWidth }) => {
          const logo = document.getElementById(`logo-${id}`);
          if (!logo) return;
          const img = logo.querySelector("img");
          img.dataset.scale = scale;
          img.style.transform = `scale(${scale})`;
          logo.style.width = boxWidth + "px";
          const checkbox = logo.querySelector(".client-toggle");
          checkbox.checked = visible;
          logo.style.display = visible ? "flex" : "none";
          sectorMap[sector]?.push(logo);
        });

        Object.entries(sectorMap).forEach(([sector, logos]) => {
          const container = document.getElementById(sector + "List");
          if (container) {
            container.innerHTML = "";
            logos.forEach((logo) => container.appendChild(logo));
          }
        });
      }

      async function fetchClientData() {
        const SHEET_URL =
          "https://docs.google.com/spreadsheets/d/e/2PACX-1vRaKv9U3pyL8aUtQ-7h7gnB0KJxCf_1QJFtEpLRnltip2cGDcxtClNyikvbYBlboD7D0n6dAfccYvth/pubhtml";
        const res = await fetch(SHEET_URL);
        const html = await res.text();
        const doc = new DOMParser().parseFromString(html, "text/html");
        const rows = [...doc.querySelectorAll("table tr")].slice(1);
        const industries = { finance: [], tech: [], retail: [], logistics: [] };

        rows.forEach((row, index) => {
          const cells = row.querySelectorAll("td");
          if (cells.length < 5) return;
          const logoURL = cells[2].textContent.trim();
          const name = cells[3].textContent.trim();
          const industry = cells[4].textContent.toLowerCase();
          const match = logoURL.match(/id=([a-zA-Z0-9_-]+)/);
          if (!match) return;
          const fileId = match[1];
const imgSrc = `https://drive.google.com/thumbnail?id=${fileId}`;

const logoHTML = `
  <div class="client-logo" id="logo-${index}" draggable="true">
    <div class="checkbox-container">
      <input type="checkbox" class="client-toggle" checked onchange="toggleLogo(${index})" />
    </div>
    <div class="image-wrapper">
      <button class="scale-btn plus" onclick="zoomImage(this.closest('.client-logo').querySelector('img'), 0.1)">+</button>
      <button class="scale-btn minus" onclick="zoomImage(this.closest('.client-logo').querySelector('img'), -0.1)">−</button>
      <img src="${imgSrc}" alt="Logo" data-scale="1" onerror="this.src='https://via.placeholder.com/150?text=Image+Not+Found'" />
    </div>
    <div class="client-name">${name}</div>
  </div>`;

          if (industry.includes("finance")) industries.finance.push(logoHTML);
          else if (industry.includes("tech")) industries.tech.push(logoHTML);
          else if (industry.includes("retail"))
            industries.retail.push(logoHTML);
          else industries.logistics.push(logoHTML);
        });

        document.getElementById("financeList").innerHTML =
          industries.finance.join("");
        document.getElementById("techList").innerHTML =
          industries.tech.join("");
        document.getElementById("retailList").innerHTML =
          industries.retail.join("");
        document.getElementById("logisticsList").innerHTML =
          industries.logistics.join("");

        ["financeList", "techList", "retailList", "logisticsList"].forEach(
          makeDraggable
        );

        window._logosLoaded = true;

        if (pendingLayoutCode) {
          applyLayoutCode(pendingLayoutCode);
          pendingLayoutCode = null;
        }
      }

      fetchClientData();
    </script>
  </body>
</html>
