<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>QR Code Generator – Excel Style</title>
  <script src="https://cdn.jsdelivr.net/npm/qrcode@1.5.3/build/qrcode.min.js"></script>
  <style>
    body{font-family:Arial,sans-serif;margin:2rem auto;max-width:900px;background:#fafafa;color:#333}
    h1{margin-bottom:.5rem}
    table{width:100%;border-collapse:collapse;margin-bottom:1rem;background:#fff}
    th,td{border:1px solid #ddd;padding:8px;text-align:left}
    th{background:#007bff;color:#fff}
    input{width:100%;border:none;padding:4px;font-size:14px}
    input:focus{outline:2px solid #007bff}
    button{background:#28a745;color:#fff;border:none;padding:8px 12px;margin:4px;border-radius:4px;cursor:pointer}
    button:hover{background:#218838}
    .remove{background:#dc3545}
    .remove:hover{background:#c82333}
    #output{margin-top:2rem}
    .qr-item{display:inline-block;margin:10px;text-align:center}
    .qr-item svg{width:120px;height:120px;background:#fff;padding:5px;border:1px solid #eee;border-radius:6px}
    .download{display:block;margin-top:4px;font-size:12px;color:#007bff}
    .zip-btn{margin:20px 0;padding:12px 20px;background:#007bff;color:#fff}
  </style>
</head>
<body>

<h1>QR Code Generator – Excel Style</h1>

<table id="dataTable">
  <thead>
    <tr>
      <th style="width:35%">Name (file name)</th>
      <th style="width:55%">URL</th>
      <th style="width:10%"></th>
    </tr>
  </thead>
  <tbody>
    <!-- rows added by JS -->
  </tbody>
</table>

<button onclick="addRow()">+ Add Row</button>
<button onclick="generateAll()">Generate All QR Codes</button>

<div id="output"></div>

<script>
// ---------- Table handling ----------
const tbody = document.querySelector('#dataTable tbody');

function addRow(name = '', url = '') {
  const tr = document.createElement('tr');
  tr.innerHTML = `
    <td><input type="text" value="${name}" placeholder="MySite"></td>
    <td><input type="text" value="${url}" placeholder="https://example.com"></td>
    <td style="text-align:center"><button class="remove" onclick="this.parentElement.parentElement.remove()">X</button></td>
  `;
  tbody.appendChild(tr);
}

// start with one empty row
addRow();

// ---------- QR generation ----------
let zip = null;
if (typeof JSZip !== 'undefined') zip = new JSZip();
const zipScript = document.createElement('script');
zipScript.src = 'https://cdn.jsdelivr.net/npm/jszip@3.10.1/dist/jszip.min.js';
document.head.appendChild(zipScript);

function sanitizeFileName(str) {
  return str.trim().replace(/[^a-zA-Z0-9_-]/g, '_') || 'qr';
}

function generateAll() {
  const rows = tbody.querySelectorAll('tr');
  const output = document.getElementById('output');
  output.innerHTML = '';
  if (!zip) zip = new JSZip();

  let processed = 0;
  const total = rows.length;

  rows.forEach((row, idx) => {
    const inputs = row.querySelectorAll('input');
    const nameRaw = inputs[0].value.trim();
    const url = inputs[1].value.trim();

    if (!nameRaw || !url) {
      processed++;
      if (processed === total) finalizeZip();
      return; // skip empty rows
    }

    const filename = sanitizeFileName(nameRaw) + '.svg';

    QRCode.toString(url, {
      type: 'svg',
      width: 512,
      margin: 1,
      color: { dark: '#000000', light: '#00000000' }, // black + transparent
      errorCorrectionLevel: 'H'
    }, (err, svg) => {
      if (err) throw err;

      // preview
      const div = document.createElement('div');
      div.className = 'qr-item';
      div.innerHTML = `
        <div>${svg}</div>
        <strong>${nameRaw}</strong><br>
        <a class="download" href="#" download="${filename}">Download SVG</a>
      `;
      output.appendChild(div);

      // download link
      const blob = new Blob([svg], {type: 'image/svg+xml'});
      const objUrl = URL.createObjectURL(blob);
      div.querySelector('.download').href = objUrl;

      // add to zip
      zip.file(filename, svg);

      processed++;
      if (processed === total) finalizeZip();
    });
  });
}

function finalizeZip() {
  if (Object.keys(zip.files).length === 0) return;

  zip.generateAsync({type:'blob'}).then(blob => {
    const url = URL.createObjectURL(blob);
    const btn = document.createElement('a');
    btn.href = url;
    btn.download = 'qr-codes.zip';
    btn.innerHTML = '<button class="zip-btn">Download All as ZIP</button>';
    document.getElementById('output').appendChild(btn);
  });
}
</script>

</body>
</html>
