<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Event Data Form</title>
    <link rel="icon" type="image/png" href="https://www.compassoffices.com/wp-content/uploads/2025/09/compassoffices-logo-web-2025_icon-o-scaled.png">
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }
     
        .form-container {
            background: linear-gradient(135deg, #000000 0%, #1a1a1a 100%);
            min-height: 100vh;
            padding: 1rem;
        }
     
        .form-card {
            backdrop-filter: blur(10px);
            background: rgba(255, 255, 255, 0.98);
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5);
            border: 1px solid #ff6600;
        }
     
        .input-field {
            transition: all 0.3s ease;
            border: 2px solid #e5e7eb;
            background: white;
            width: 100%;
            box-sizing: border-box;
            -webkit-appearance: none;
            -moz-appearance: none;
            appearance: none;
        }
     
        .input-field:focus {
            border-color: #ff6600;
            box-shadow: 0 0 0 3px rgba(255, 102, 0, 0.1);
            transform: translateY(-1px);
            outline: none;
        }
     
        .submit-btn {
            background: linear-gradient(135deg, #ff6600 0%, #e55a00 100%);
            transition: all 0.3s ease;
            -webkit-appearance: none;
        }
     
        .submit-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px -5px rgba(255, 102, 0, 0.4);
        }
     
        .submit-btn:active {
            transform: translateY(0);
        }
     
        .success-message {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
        }
     
        .error-message {
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
        }
        .drag-drop-zone {
            border: 2px dashed #e5e7eb;
            background: #f9fafb;
            padding: 2rem;
            text-align: center;
            border-radius: 0.5rem;
            transition: all 0.3s ease;
        }
        .drag-drop-zone.dragover {
            border-color: #ff6600;
            background: rgba(255, 102, 0, 0.1);
            transform: scale(1.02);
        }
        .drag-drop-zone.disabled {
            background: #e5e7eb;
            cursor: not-allowed;
        }
        /* Mobile-specific styles */
        @media (max-width: 768px) {
            .form-container {
                padding: 0.5rem;
            }
         
            .form-card {
                padding: 1.5rem;
            }
         
            .grid-cols-1 {
                grid-template-columns: 1fr;
            }
         
            .grid-cols-2 {
                grid-template-columns: 1fr;
                gap: 1rem;
            }
         
            .input-field {
                padding: 0.75rem 1rem;
                font-size: 1rem;
                -webkit-text-size-adjust: 100%;
            }
         
            .space-y-6 > * + * {
                margin-top: 1.5rem;
            }
         
            .max-w-2xl {
                max-width: 100%;
                padding: 0 0.5rem;
            }
         
            .text-4xl {
                font-size: 1.875rem;
                line-height: 2.25rem;
            }
         
            .text-lg {
                font-size: 1rem;
            }
         
            .h-16 {
                height: 3rem;
            }
         
            .submit-btn {
                padding: 0.75rem 1rem;
                font-size: 1rem;
            }
            .tab-nav {
                flex-wrap: wrap;
                gap: 0.5rem;
            }
            .tab-btn {
                flex: 1;
                min-width: 80px;
                font-size: 0.875rem;
                padding: 0.5rem 1rem;
            }
            .drag-drop-zone {
                padding: 1.5rem;
            }
        }
    </style>
</head>
<body class="form-container">
    <div class="min-h-full py-8 px-4">
        <div class="max-w-2xl mx-auto">
            <!-- Logo Header -->
            <div class="text-center mb-8">
                <div class="mb-6">
                    <img src="https://www.compassoffices.com/wp-content/themes/compass-offices/assets/images/compassoffices-logo-web-all-in-one-2025_ow.svg"
                         alt="Compass Offices Logo"
                         class="h-16 mx-auto"
                         onerror="this.style.display='none';">
                </div>
                <h1 class="text-4xl font-bold text-white mb-2">Event Registration</h1>
                <p class="text-white/80 text-lg">Review the event details and upload an image</p>
            </div>
         
            <!-- Form Card -->
            <div class="form-card rounded-2xl p-8">
                <form id="eventForm">
                    <!-- Tabs Navigation -->
                    <div class="border-b border-gray-200 rounded-lg mb-6">
                        <nav class="tab-nav -mb-px flex space-x-8" aria-label="Tabs">
                            <button type="button"
                                    class="tab-btn group inline-flex items-center px-1 py-4 text-sm font-medium border-b-2 border-transparent rounded-t-lg hover:text-gray-700 hover:border-gray-300"
                                    data-tab="1">
                                Basic Info
                            </button>
                            <button type="button"
                                    class="tab-btn group inline-flex items-center px-1 py-4 text-sm font-medium border-b-2 border-transparent rounded-t-lg hover:text-gray-700 hover:border-gray-300"
                                    data-tab="2">
                                Location
                            </button>
                            <button type="button"
                                    class="tab-btn group inline-flex items-center px-1 py-4 text-sm font-medium border-b-2 border-transparent rounded-t-lg hover:text-gray-700 hover:border-gray-300"
                                    data-tab="3">
                                Details
                            </button>
                            <button type="button"
                                    class="tab-btn group inline-flex items-center px-1 py-4 text-sm font-medium border-b-2 border-transparent rounded-t-lg hover:text-gray-700 hover:border-gray-300"
                                    data-tab="4">
                                Logo Upload
                            </button>
                            <button type="button"
                                    class="tab-btn group inline-flex items-center px-1 py-4 text-sm font-medium border-b-2 border-transparent rounded-t-lg hover:text-gray-700 hover:border-gray-300"
                                    data-tab="5">
                                Event Image
                            </button>
                        </nav>
                    </div>
                    <!-- Tab 1: Basic Info -->
                    <div id="tab1" class="tab-content">
                        <div class="space-y-6">
                            <!-- Time and Date Row -->
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                <div>
                                    <label class="block text-sm font-semibold text-gray-700 mb-2">Time</label>
                                    <div class="grid grid-cols-2 gap-3">
                                        <div>
                                            <label class="block text-xs font-medium text-gray-600 mb-1">Start Time</label>
                                            <div id="startTime" class="px-4 py-3 bg-gray-50 rounded-lg text-sm text-gray-800"></div>
                                        </div>
                                        <div>
                                            <label class="block text-xs font-medium text-gray-600 mb-1">End Time</label>
                                            <div id="endTime" class="px-4 py-3 bg-gray-50 rounded-lg text-sm text-gray-800"></div>
                                        </div>
                                    </div>
                                </div>
                                <div>
                                    <label class="block text-sm font-semibold text-gray-700 mb-2">Date</label>
                                    <div id="date" class="px-4 py-3 bg-gray-50 rounded-lg text-sm text-gray-800"></div>
                                </div>
                            </div>
                     
                            <!-- Client Name -->
                            <div>
                                <label class="block text-sm font-semibold text-gray-700 mb-2">Client Name</label>
                                <div id="clientName" class="px-4 py-3 bg-gray-50 rounded-lg text-sm text-gray-800"></div>
                            </div>
                     
                            <!-- Region -->
                            <div>
                                <label class="block text-sm font-semibold text-gray-700 mb-2">Region</label>
                                <div id="region" class="px-4 py-3 bg-gray-50 rounded-lg text-sm text-gray-800"></div>
                            </div>
                     
                            <!-- Event Name -->
                            <div>
                                <label class="block text-sm font-semibold text-gray-700 mb-2">Event Name</label>
                                <div id="eventName" class="px-4 py-3 bg-gray-50 rounded-lg text-sm text-gray-800"></div>
                            </div>
                     
                            <!-- Reception -->
                            <div>
                                <label class="block text-sm font-semibold text-gray-700 mb-2">Reception (Optional)</label>
                                <div id="reception" class="px-4 py-3 bg-gray-50 rounded-lg text-sm text-gray-800"></div>
                            </div>
                        </div>
                    </div>
                    <!-- Tab 2: Location -->
                    <div id="tab2" class="tab-content hidden">
                        <div class="space-y-6">
                            <div>
                                <label class="block text-sm font-semibold text-gray-700 mb-4">Location</label>
                         
                                <!-- Country -->
                                <div class="mb-4">
                                    <label class="block text-xs font-medium text-gray-600 mb-2">Country</label>
                                    <div id="country" class="px-4 py-3 bg-gray-50 rounded-lg text-sm text-gray-800"></div>
                                </div>
                         
                                <!-- Building -->
                                <div class="mb-4">
                                    <label class="block text-xs font-medium text-gray-600 mb-2">Building</label>
                                    <div id="building" class="px-4 py-3 bg-gray-50 rounded-lg text-sm text-gray-800"></div>
                                </div>
                         
                                <!-- Floor -->
                                <div class="mb-4">
                                    <label class="block text-xs font-medium text-gray-600 mb-2">Floor</label>
                                    <div id="floor" class="px-4 py-3 bg-gray-50 rounded-lg text-sm text-gray-800"></div>
                                </div>
                         
                                <!-- Area Type -->
                                <div class="mb-4">
                                    <label class="block text-xs font-medium text-gray-600 mb-2">Area Type</label>
                                    <div id="areaTypes" class="px-4 py-3 bg-gray-50 rounded-lg text-sm text-gray-800"></div>
                                </div>
                         
                                <!-- Room Name Section -->
                                <div class="mb-4" id="roomNameSection" style="display: none;">
                                    <div id="regularRoomInput" style="display: none;">
                                        <label class="block text-xs font-medium text-gray-600 mb-2">Room Name</label>
                                        <div id="regularRoomName" class="px-4 py-3 bg-gray-50 rounded-lg text-sm text-gray-800"></div>
                                    </div>
                                    <div id="meetingRoomInput" style="display: none;">
                                        <label class="block text-xs font-medium text-gray-600 mb-2">Meeting Room Name</label>
                                        <div id="meetingRoomName" class="px-4 py-3 bg-gray-50 rounded-lg text-sm text-gray-800"></div>
                                    </div>
                                </div>
                         
                                <!-- Additional Location -->
                                <div class="mb-4">
                                    <label class="block text-xs font-medium text-gray-600 mb-2">Additional Location (Optional)</label>
                                    <div id="additionalLocation" class="px-4 py-3 bg-gray-50 rounded-lg text-sm text-gray-800"></div>
                                </div>
                         
                                <!-- Location Preview -->
                                <div class="mt-4 p-3 bg-gray-50 rounded-lg border">
                                    <label class="block text-xs font-medium text-gray-600 mb-1">Location Preview:</label>
                                    <div id="locationPreview" class="text-sm font-medium text-gray-800">Please select location details above</div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- Tab 3: Details -->
                    <div id="tab3" class="tab-content hidden">
                        <div class="space-y-6">
                            <!-- Details -->
                            <div>
                                <label class="block text-sm font-semibold text-gray-700 mb-2">Details</label>
                                <div id="details" class="px-4 py-3 bg-gray-50 rounded-lg text-sm text-gray-800"></div>
                            </div>
                        </div>
                    </div>
                    <!-- Tab 4: Logo Upload -->
                    <div id="tab4" class="tab-content hidden">
                        <div class="space-y-6">
                            <div>
                                <div class="flex items-center mb-2">
                                    <input type="checkbox" id="noLogoNeeded" class="mr-2">
                                    <label for="noLogoNeeded" class="text-sm font-semibold text-gray-700">No Logo Needed</label>
                                </div>
                                <label for="logoUpload" class="block text-sm font-semibold text-gray-700 mb-2">Upload Logo (Optional)</label>
                                <div id="logoDropZone" class="drag-drop-zone">
                                    <p class="text-sm text-gray-600">Drag & drop your logo here or click to select</p>
                                    <input type="file" id="logoUpload" accept="image/*"
                                           class="input-field px-4 py-3 rounded-lg focus:outline-none hidden">
                                </div>
                                <p id="logoFileName" class="text-sm text-gray-600 mt-2"></p>
                            </div>
                        </div>
                    </div>
                    <!-- Tab 5: Event Image Upload -->
                    <div id="tab5" class="tab-content hidden">
                        <div class="space-y-6">
                            <div>
                                <div class="flex items-center mb-2">
                                    <input type="checkbox" id="noEventImageNeeded" class="mr-2">
                                    <label for="noEventImageNeeded" class="text-sm font-semibold text-gray-700">No Image Needed</label>
                                </div>
                                <label for="eventImageUpload" class="block text-sm font-semibold text-gray-700 mb-2">Upload Event Image (Optional)</label>
                                <div id="eventImageDropZone" class="drag-drop-zone">
                                    <p class="text-sm text-gray-600">Drag & drop your event image here or click to select</p>
                                    <input type="file" id="eventImageUpload" accept="image/*"
                                           class="input-field px-4 py-3 rounded-lg focus:outline-none hidden">
                                </div>
                                <p id="eventImageFileName" class="text-sm text-gray-600 mt-2"></p>
                            </div>
                        </div>
                    </div>
                 
                    <!-- Submit Button -->
                    <div class="pt-4">
                        <button type="submit"
                                class="submit-btn w-full py-4 px-6 text-white font-semibold rounded-lg focus:outline-none focus:ring-4 focus:ring-purple-200">
                            <span id="submitText">Submit Event Data</span>
                            <span id="loadingText" class="hidden">Sending...</span>
                        </button>
                    </div>
                </form>
             
                <!-- Success Message -->
                <div id="successMessage" class="hidden mt-6 p-4 rounded-lg text-white success-message">
                    <div class="flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path>
                        </svg>
                        Event data submitted successfully!
                    </div>
                </div>
             
                <!-- Error Message -->
                <div id="errorMessage" class="hidden mt-6 p-4 rounded-lg text-white error-message">
                    <div class="flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clip-rule="evenodd"></path>
                        </svg>
                        <span id="errorText"></span>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <script>
        // Location data structure for validation
        const locationData = {
            "Hong Kong": {
                "Wing On Centre": ["27"],
                "Infinitus Plaza": ["12", "20", "29", "35", "38"],
                "China Building": ["18", "19"],
                "Bank of Dongguan Tower": ["9", "10", "11", "12"],
                "Admiralty Centre Tower 1": ["15"],
                "Admiralty Centre Tower 2": ["8", "11"],
                "Lee Garden One": ["24"],
                "Lee Garden Two": ["15", "16", "28"],
                "AIA Tower": ["43"],
                "Silvercord Tower 2": ["5", "11", "17"]
            },
            "Tokyo": {
                "Ebisu Green Glass": ["6", "7", "8", "9"],
                "Toranomon 40 MT": ["7"],
                "ouno八重洲 x Compass Offices": ["3"]
            },
            "Osaka": {
                "INOGATE Osaka": ["9", "10"],
                "WTC annex": ["11", "12"]
            },
            "Singapore": {
                "Samsung Hub": ["29"],
                "Singapore Land Tower": ["19", "30"]
            },
            "Melbourne": {
                "360 Collins Street": ["26"],
                "459 Collins Street": ["21"],
                "570 Bourke Street": ["17", "24"]
            },
            "Sydney": {
                "141 Walker Street": ["12"],
                "207 Kent Street": ["21"],
                "9 Castlereagh Street": ["16", "17"]
            },
            "Philippines": {
                "Arthaland Century Pacific Tower": ["9"],
                "Tower 6789": ["16"],
                "BGC Corporate Center": ["24"]
            },
            "Ho Chi Minh City": {
                "Compass Offices Landmark 81": ["72"],
                "Bitexco Financial Tower": ["16", "46", "56"]
            },
            "Kuala Lumpur": {
                "Menara AIA Sentral": ["3", "4", "5"]
            }
        };
     
        // Function to convert 24-hour time to 12-hour format with AM/PM for display
        function formatTimeTo12Hour(time) {
            if (!time) return 'Not provided';
            const [hours, minutes] = time.split(':').map(t => t.trim());
            const hour = parseInt(hours, 10);
            if (isNaN(hour) || isNaN(parseInt(minutes, 10))) return 'Invalid time';
            const period = hour >= 12 ? 'PM' : 'AM';
            const hour12 = hour % 12 || 12;
            return `${hour12}:${minutes.padStart(2, '0')} ${period}`;
        }

        // Function to format date to YYYY-MM-DD for display
        function formatDateToTeams(dateStr) {
            if (!dateStr) return 'Not provided';
            // Try parsing common date formats
            const date = new Date(dateStr);
            if (isNaN(date.getTime())) {
                // Try parsing as DD/MM/YYYY or DD-MM-YYYY
                const parts = dateStr.match(/(\d{1,2})[/-](\d{1,2})[/-](\d{4})/);
                if (parts) {
                    const day = parts[1].padStart(2, '0');
                    const month = parts[2].padStart(2, '0');
                    const year = parts[3];
                    return `${year}-${month}-${day}`;
                }
                return 'Invalid date';
            }
            return date.toISOString().split('T')[0]; // Returns YYYY-MM-DD
        }

        // Function to format time for Make.com Teams integration (ISO with timezone)
        function formatTimeForMake(time24) {
            if (!time24) return null;
            const [hours, minutes] = time24.split(':').map(t => t.trim());
            const h = parseInt(hours, 10).toString().padStart(2, '0');
            const m = parseInt(minutes || '00', 10).toString().padStart(2, '0');
            return `${h}:${m}:00.0000000`;
        }

        // Function to format date for Make.com Teams integration (YYYY-MM-DD)
        function formatDateForMake(dateStr) {
            const formatted = formatDateToTeams(dateStr);
            if (formatted === 'Not provided' || formatted === 'Invalid date') return null;
            return formatted;
        }

        // Function to create ISO datetime string for Graph API
        function createISODatetime(dateStr, time24) {
            const date = formatDateForMake(dateStr);
            const time = formatTimeForMake(time24);
            if (!date || !time) return null;
            return `${date}T${time}+08:00`; // Assuming HKT timezone; adjust if needed
        }

        // Function to process image to 1:1 square without cropping (letterbox with transparent padding), under 500KB
        async function processImageToSquare(file) {
            const MAX_SIZE = 500 * 1024; // 500KB
            return new Promise((resolve, reject) => {
                const img = new Image();
                const reader = new FileReader();
                reader.onload = (e) => {
                    img.src = e.target.result;
                };
                reader.onerror = reject;
                reader.readAsDataURL(file);
                img.onload = async () => {
                    let scale = 1;
                    const originalMax = Math.max(img.width, img.height);
                    let canvas = document.createElement('canvas');
                    let ctx = canvas.getContext('2d');
                    let quality = 1.0;
                    function draw() {
                        const currentMax = Math.floor(originalMax * scale);
                        canvas.width = currentMax;
                        canvas.height = currentMax;
                        ctx.clearRect(0, 0, currentMax, currentMax);
                        const scaledW = img.width * scale;
                        const scaledH = img.height * scale;
                        const x = (currentMax - scaledW) / 2;
                        const y = (currentMax - scaledH) / 2;
                        ctx.drawImage(img, x, y, scaledW, scaledH);
                    }
                    draw();
                    let blob = await new Promise((res) => canvas.toBlob(res, 'image/png', quality));
                    let size = blob.size;
                    while (size > MAX_SIZE && (quality > 0.1 || scale > 0.1)) {
                        if (quality > 0.1) {
                            quality -= 0.05;
                        } else {
                            scale *= 0.9;
                            if (scale < 0.1) break;
                            draw();
                        }
                        blob = await new Promise((res) => canvas.toBlob(res, 'image/png', quality));
                        size = blob.size;
                    }
                    if (size > MAX_SIZE) {
                        reject(new Error('Image could not be resized to under 500KB while maintaining good quality'));
                        return;
                    }
                    resolve({
                        blob: blob,
                        name: file.name.replace(/\.[^/.]+$/, '.png')
                    });
                };
                img.onerror = reject;
            });
        }

        // Initialize form interactions
        document.addEventListener('DOMContentLoaded', function() {
            const params = new URLSearchParams(window.location.search);
            // Parse Time parameter (e.g., "09:00-17:00")
            const time = params.get('Time') || '';
            let startTime = '';
            let endTime = '';
            if (time.includes('-')) {
                [startTime, endTime] = time.split('-').map(t => t.trim());
            } else if (time) {
                startTime = time;
            }
            // Parse Location parameter (e.g., "Hong Kong, Wing On Centre, 27/F, Lounge area, Room (1826), Meeting room (ABC), (Extra Details)")
            const location = params.get('Location') || '';
            let country = '';
            let building = '';
            let floor = '';
            let loungeArea = false;
            let meetingRoom = false;
            let room = false;
            let regularRoomName = '';
            let meetingRoomName = '';
            let additionalLocation = '';
            let areaTypes = [];
            if (location) {
                const parts = location.split(', ').map(part => part.trim());
                if (parts.length >= 1) country = parts[0];
                if (parts.length >= 2) building = parts[1];
                if (parts.length >= 3) floor = parts[2].replace('/F', '');
                if (parts.length >= 4) {
                    const areas = parts.slice(3).join(', ').split(' + ').map(area => area.trim());
                    loungeArea = areas.includes('Lounge area');
                    meetingRoom = areas.includes('Meeting room') || areas.some(a => a.startsWith('Meeting room ('));
                    room = areas.includes('Room') || areas.some(a => a.startsWith('Room ('));
                    regularRoomName = areas.find(a => a.startsWith('Room ('))?.replace('Room (', '').replace(')', '') || '';
                    meetingRoomName = areas.find(a => a.startsWith('Meeting room ('))?.replace('Meeting room (', '').replace(')', '') || '';
                    additionalLocation = areas.find(a => a.startsWith('('))?.replace('(', '').replace(')', '') || '';
                    areaTypes = areas.filter(a => !a.startsWith('(')).map(a => {
                        if (a.startsWith('Room (')) return 'Room';
                        if (a.startsWith('Meeting room (')) return 'Meeting room';
                        return a;
                    });
                }
            }
            // Display data as text
            document.getElementById('startTime').textContent = formatTimeTo12Hour(startTime);
            document.getElementById('endTime').textContent = formatTimeTo12Hour(endTime);
            document.getElementById('date').textContent = formatDateToTeams(params.get('Date'));
            document.getElementById('clientName').textContent = params.get('Client-Name') || 'Not provided';
            document.getElementById('region').textContent = params.get('Region') || 'Not provided';
            document.getElementById('eventName').textContent = params.get('Event-Name') || 'Not provided';
            document.getElementById('reception').textContent = params.get('Reception') || 'Not provided';
            document.getElementById('country').textContent = country || 'Not provided';
            document.getElementById('building').textContent = building || 'Not provided';
            document.getElementById('floor').textContent = floor ? `${floor}/F` : 'Not provided';
            document.getElementById('areaTypes').textContent = areaTypes.length > 0 ? areaTypes.join(', ') : 'Not provided';
            document.getElementById('regularRoomName').textContent = regularRoomName || 'Not provided';
            document.getElementById('meetingRoomName').textContent = meetingRoomName || 'Not provided';
            document.getElementById('additionalLocation').textContent = additionalLocation || 'Not provided';
            document.getElementById('details').textContent = params.get('Details') || 'Not provided';
            // Update room name visibility
            const roomNameSection = document.getElementById('roomNameSection');
            const regularRoomInput = document.getElementById('regularRoomInput');
            const meetingRoomInput = document.getElementById('meetingRoomInput');
            if (meetingRoom || room) {
                roomNameSection.style.display = 'block';
                regularRoomInput.style.display = room ? 'block' : 'none';
                meetingRoomInput.style.display = meetingRoom ? 'block' : 'none';
            } else {
                roomNameSection.style.display = 'none';
            }
            // Update location preview
            function updateLocationPreview() {
                let preview = '';
                if (building && floor) {
                    let buildingName = building;
                    if (building === 'Lee Garden Two') buildingName = 'Lee Garden 2';
                    if (building === 'Lee Garden One') buildingName = 'Lee Garden 1';
                    preview = `${buildingName}, ${floor}/F`;
                    const locationParts = [];
                    if (room) {
                        locationParts.push(regularRoomName ? `Room ${regularRoomName}` : 'Room');
                    }
                    if (meetingRoom) {
                        locationParts.push(meetingRoomName ? `Meeting room (${meetingRoomName})` : 'Meeting room');
                    }
                    if (loungeArea) {
                        locationParts.push('Lounge area');
                    }
                    if (locationParts.length > 0) {
                        preview += `, ${locationParts.join(' + ')}`;
                    }
                    if (locationParts.length === 0 && additionalLocation) {
                        preview += `, ${additionalLocation}`;
                    } else if (locationParts.length > 0 && additionalLocation) {
                        preview += ` (${additionalLocation})`;
                    }
                } else {
                    preview = 'Please select location details above';
                }
                document.getElementById('locationPreview').textContent = preview;
            }
            updateLocationPreview();
            // Tab functionality
            const tabBtns = document.querySelectorAll('[data-tab]');
            tabBtns.forEach(btn => {
                btn.addEventListener('click', function() {
                    const tabId = this.dataset.tab;
                    document.querySelectorAll('.tab-content').forEach(tab => tab.classList.add('hidden'));
                    document.getElementById('tab' + tabId).classList.remove('hidden');
                    tabBtns.forEach(b => {
                        b.classList.remove('border-orange-500', 'text-orange-900', 'bg-orange-50');
                        b.classList.add('border-transparent', 'text-gray-500');
                    });
                    this.classList.add('border-orange-500', 'text-orange-900', 'bg-orange-50');
                    this.classList.remove('border-transparent', 'text-gray-500');
                });
            });
            // Show first tab
            tabBtns[0].click();
            // Logo checkbox and drag-and-drop handler
            const noLogoCheckbox = document.getElementById('noLogoNeeded');
            const logoUploadInput = document.getElementById('logoUpload');
            const logoDropZone = document.getElementById('logoDropZone');
            const logoFileName = document.getElementById('logoFileName');
            noLogoCheckbox.addEventListener('change', function() {
                logoUploadInput.disabled = this.checked;
                logoDropZone.classList.toggle('disabled', this.checked);
                if (this.checked) {
                    logoUploadInput.value = '';
                    logoFileName.textContent = '';
                }
            });
            logoDropZone.addEventListener('click', () => {
                if (!noLogoCheckbox.checked) {
                    logoUploadInput.click();
                }
            });
            logoDropZone.addEventListener('dragover', (e) => {
                e.preventDefault();
                if (!noLogoCheckbox.checked) {
                    logoDropZone.classList.add('dragover');
                }
            });
            logoDropZone.addEventListener('dragleave', () => {
                logoDropZone.classList.remove('dragover');
            });
            logoDropZone.addEventListener('drop', (e) => {
                e.preventDefault();
                logoDropZone.classList.remove('dragover');
                if (!noLogoCheckbox.checked) {
                    const files = e.dataTransfer.files;
                    if (files.length > 0 && files[0].type.startsWith('image/')) {
                        logoUploadInput.files = files;
                        logoFileName.textContent = files[0].name;
                    }
                }
            });
            logoUploadInput.addEventListener('change', () => {
                logoFileName.textContent = logoUploadInput.files[0]?.name || '';
            });
            // Event Image checkbox and drag-and-drop handler
            const noEventImageCheckbox = document.getElementById('noEventImageNeeded');
            const eventImageUploadInput = document.getElementById('eventImageUpload');
            const eventImageDropZone = document.getElementById('eventImageDropZone');
            const eventImageFileName = document.getElementById('eventImageFileName');
            noEventImageCheckbox.addEventListener('change', function() {
                eventImageUploadInput.disabled = this.checked;
                eventImageDropZone.classList.toggle('disabled', this.checked);
                if (this.checked) {
                    eventImageUploadInput.value = '';
                    eventImageFileName.textContent = '';
                }
            });
            eventImageDropZone.addEventListener('click', () => {
                if (!noEventImageCheckbox.checked) {
                    eventImageUploadInput.click();
                }
            });
            eventImageDropZone.addEventListener('dragover', (e) => {
                e.preventDefault();
                if (!noEventImageCheckbox.checked) {
                    eventImageDropZone.classList.add('dragover');
                }
            });
            eventImageDropZone.addEventListener('dragleave', () => {
                eventImageDropZone.classList.remove('dragover');
            });
            eventImageDropZone.addEventListener('drop', (e) => {
                e.preventDefault();
                eventImageDropZone.classList.remove('dragover');
                if (!noEventImageCheckbox.checked) {
                    const files = e.dataTransfer.files;
                    if (files.length > 0 && files[0].type.startsWith('image/')) {
                        eventImageUploadInput.files = files;
                        eventImageFileName.textContent = files[0].name;
                    }
                }
            });
            eventImageUploadInput.addEventListener('change', () => {
                eventImageFileName.textContent = eventImageUploadInput.files[0]?.name || '';
            });
        });
     
        document.getElementById('eventForm').addEventListener('submit', async function(e) {
            e.preventDefault();
         
            const submitBtn = e.target.querySelector('button[type="submit"]');
            const submitText = document.getElementById('submitText');
            const loadingText = document.getElementById('loadingText');
            const successMessage = document.getElementById('successMessage');
            const errorMessage = document.getElementById('errorMessage');
            const errorText = document.getElementById('errorText');
            const noLogoCheckbox = document.getElementById('noLogoNeeded');
            const logoUploadInput = document.getElementById('logoUpload');
            const noEventImageCheckbox = document.getElementById('noEventImageNeeded');
            const eventImageUploadInput = document.getElementById('eventImageUpload');
            const logoFileName = document.getElementById('logoFileName');
            const eventImageFileName = document.getElementById('eventImageFileName');
         
            // Hide previous messages
            successMessage.classList.add('hidden');
            errorMessage.classList.add('hidden');
         
            // Show loading state
            submitText.classList.add('hidden');
            loadingText.classList.remove('hidden');
            submitBtn.disabled = true;
         
            // Parse query parameters for form data
            const params = new URLSearchParams(window.location.search);
            const time = params.get('Time') || '';
            let startTime = '';
            let endTime = '';
            if (time.includes('-')) {
                [startTime, endTime] = time.split('-').map(t => t.trim());
            } else if (time) {
                startTime = time;
            }
            // Parse Location parameter
            const location = params.get('Location') || '';
            let country = '';
            let building = '';
            let floor = '';
            let loungeArea = false;
            let meetingRoom = false;
            let room = false;
            let regularRoomName = '';
            let meetingRoomName = '';
            let additionalLocation = '';
            let areaTypes = [];
            if (location) {
                const parts = location.split(', ').map(part => part.trim());
                if (parts.length >= 1) country = parts[0];
                if (parts.length >= 2) building = parts[1];
                if (parts.length >= 3) floor = parts[2].replace('/F', '');
                if (parts.length >= 4) {
                    const areas = parts.slice(3).join(', ').split(' + ').map(area => area.trim());
                    loungeArea = areas.includes('Lounge area');
                    meetingRoom = areas.includes('Meeting room') || areas.some(a => a.startsWith('Meeting room ('));
                    room = areas.includes('Room') || areas.some(a => a.startsWith('Room ('));
                    regularRoomName = areas.find(a => a.startsWith('Room ('))?.replace('Room (', '').replace(')', '') || '';
                    meetingRoomName = areas.find(a => a.startsWith('Meeting room ('))?.replace('Meeting room (', '').replace(')', '') || '';
                    additionalLocation = areas.find(a => a.startsWith('('))?.replace('(', '').replace(')', '') || '';
                    areaTypes = areas.filter(a => !a.startsWith('(')).map(a => {
                        if (a.startsWith('Room (')) return 'Room';
                        if (a.startsWith('Meeting room (')) return 'Meeting room';
                        return a;
                    });
                }
            }
            // Collect form data
            const clientName = params.get('Client-Name') || '';
            const companyName = ''; // Not provided in Google Sheet
            let formattedClientName = clientName;
            if (companyName && clientName) {
                formattedClientName = `${companyName} (Client name: ${clientName})`;
            } else if (companyName) {
                formattedClientName = companyName;
            }
            // Prepare FormData
            const formData = new FormData();
            formData.append('startTime', formatTimeTo12Hour(startTime));
            formData.append('endTime', formatTimeTo12Hour(endTime));
            formData.append('date', formatDateToTeams(params.get('Date')));
            formData.append('clientName', formattedClientName || '');
            formData.append('region', params.get('Region') || '');
            formData.append('eventName', params.get('Event-Name') || '');
            formData.append('reception', params.get('Reception') || '');
            formData.append('country', country || '');
            formData.append('building', building || '');
            formData.append('floor', floor || '');
            formData.append('areaTypes', areaTypes.length > 0 ? areaTypes.join(', ') : '');
            formData.append('regularRoomName', regularRoomName || '');
            formData.append('meetingRoomName', meetingRoomName || '');
            formData.append('additionalLocation', additionalLocation || '');
            formData.append('formattedLocation', document.getElementById('locationPreview').textContent || '');
            formData.append('details', params.get('Details') || '');

            // Add ISO datetime for Teams API
            const dateParam = params.get('Date') || '';
            const startDateTimeISO = createISODatetime(dateParam, startTime);
            const endDateTimeISO = createISODatetime(dateParam, endTime);
            if (startDateTimeISO && endDateTimeISO) {
                formData.append('startDateTime', startDateTimeISO);
                formData.append('endDateTime', endDateTimeISO);
            } else {
                // Fallback or error handling
                console.error('Invalid date or time for ISO formatting');
                errorText.textContent = 'Invalid date or time format provided.';
                errorMessage.classList.remove('hidden');
                submitText.classList.remove('hidden');
                loadingText.classList.add('hidden');
                submitBtn.disabled = false;
                return;
            }
            // Handle logo and image uploads
            const logoFile = logoUploadInput.files[0];
            const imageFile = eventImageUploadInput.files[0];
            try {
                // Process Logo
                if (noLogoCheckbox.checked) {
                    formData.append('logo', 'No logo needed');
                } else if (logoFile) {
                    const processedLogo = await processImageToSquare(logoFile);
                    formData.append('logo', processedLogo.blob, processedLogo.name);
                } else {
                    formData.append('logo', 'No logo');
                }
                // Process Event Image
                if (noEventImageCheckbox.checked) {
                    formData.append('image', 'No image needed');
                } else if (imageFile) {
                    const processedImage = await processImageToSquare(imageFile);
                    formData.append('image', processedImage.blob, processedImage.name);
                } else {
                    formData.append('image', 'No image');
                }
            } catch (error) {
                console.error('Error processing image(s):', error);
                errorText.textContent = 'Error processing image(s): ' + error.message;
                errorMessage.classList.remove('hidden');
                submitText.classList.remove('hidden');
                loadingText.classList.add('hidden');
                submitBtn.disabled = false;
                return;
            }
            try {
                const response = await fetch('https://hook.eu2.make.com/gkgyd5hdrglngogo8nis9aq4i3em5qvd', {
                    method: 'POST',
                    body: formData
                });
             
                if (response.ok) {
                    successMessage.classList.remove('hidden');
                    document.getElementById('eventForm').reset();
                    document.getElementById('locationPreview').textContent = 'Please select location details above';
                    noLogoCheckbox.checked = false;
                    noEventImageCheckbox.checked = false;
                    logoUploadInput.disabled = false;
                    eventImageUploadInput.disabled = false;
                    logoFileName.textContent = '';
                    eventImageFileName.textContent = '';
                } else {
                    throw new Error('Network response was not ok');
                }
            } catch (error) {
                console.error('Error:', error);
                errorMessage.classList.remove('hidden');
                errorText.textContent = error.message;
            } finally {
                submitText.classList.remove('hidden');
                loadingText.classList.add('hidden');
                submitBtn.disabled = false;
            }
        });
    </script>
</body>
</html>
