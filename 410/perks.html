<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=410, height=800, initial-scale=1.0" />
  <link href="https://fonts.cdnfonts.com/css/neue-haas-grotesk-display-pro" rel="stylesheet" />
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    html { font-size: 12px; }
    body {
      width: 410px; height: 800px;
      background-color: #000; color: #fff;
      font-family: 'Neue Haas Grotesk Display Pro', sans-serif;
      display: flex; flex-direction: column;
      overflow-y: auto;
      position: relative;
      padding: 0 1.2rem;
    }
    .header {
      margin: 2.2rem 0 1.5rem 0;
      text-align: left;
      font-size: 4.2rem;
      line-height: 4.2rem;
    }
    .header-upcoming { font-weight: 400; }
    .header-events { font-weight: 700; }
    .slideshow-container {
      position: relative;
      width: 100%;
      height: 555px;
      max-height: 555px;
      overflow: hidden;
      border-radius: 1.1rem;
      box-shadow: 0 4px 24px rgba(0,0,0,0.26);
      background: #000;
    }
    .slide-group {
      position: absolute;
      top: 0; left: 0;
      width: 100%;
      height: 100%;
      opacity: 0;
      transition: opacity 0.9s cubic-bezier(0.77,0,0.18,1);
      display: flex; flex-direction: column;
      z-index: 0;
    }
    .slide-group.active {
      opacity: 1;
      z-index: 1;
      pointer-events: auto;
    }
    .event-card {
      width: 100%; height: 245px;
      background-color: #f1f1f1;
      border-radius: 1rem;
      display: flex;
      flex-direction: column;
      color: #191919;
      overflow: hidden;
      position: relative;
      margin-bottom: 1.3rem;
      box-shadow: 0 3px 12px rgba(0,0,0,0.09);
      transition: box-shadow 0.2s;
      border: 1px solid #eee;
    }
    .event-card:last-child { margin-bottom: 0; }
    .card-divider {
      height: 0.7px;
      background: linear-gradient(to right,#e0e0e0,rgba(0,0,0,0.08),#e0e0e0);
      border: none;
      margin: -1.1rem 0 1.2rem 0;
      width: 96%;
      align-self: center;
      opacity: 0.6;
    }
    .img-container {
      height: 32%;
      width: 100%;
      border-radius: 1rem 1rem 0 0;
      overflow: hidden;
      background: #ffffff;
    }
    .card-img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      display: block;
      background: #eee;
    }
    .event-title {
      font-weight: 600;
      font-size: 2.33rem;
      line-height: 2.6rem;
      padding: 0.7rem 1.4rem 0.2rem 1.2rem;
      text-align: left;
      display: -webkit-box;
      -webkit-line-clamp: 3;
      -webkit-box-orient: vertical;
      overflow: hidden;
      text-overflow: ellipsis;
      word-break: break-word;
      flex-grow: 1;
      letter-spacing: -0.02rem;
    }
    .company-name {
      font-size: 1.16rem;
      color: #888;
      padding: 0 1.4rem 1.1rem 1.2rem;
      text-align: left;
      font-weight: 400;
      letter-spacing: 0;
    }
    .bottom-section {
      position: absolute;
      bottom: 2.5rem;
      right: 2.1rem;
    }
    .qr-follow {
      display: flex;
      align-items: center;
      gap: 1.5rem;
    }
    .follow {
      font-size: 1.4rem;
      line-height: 2rem;
      color: #fff;
      text-align: left;
    }
    .qr-code img {
      width: 90px;
      height: 90px;
      margin-left: 1.8rem;
      border-radius: 0.4rem;
    }
    .contact-info {
      font-size: 1.19rem;
      color: #dedede;
      margin-top: 2.2rem;
      margin-left: 0.25rem;
      text-align: left;
      line-height: 1.7rem;
      letter-spacing: 0.02em;
      font-weight: 400;
    }
    .text-orange {
      font-size: 1.36rem;
      color: #fffbea;
      font-weight: 600;
      padding-top: 0.32rem;
      letter-spacing: 0.01em;
    }
    @media (max-width: 410px), (max-height: 800px) {
      body, .slideshow-container { width: 100vw; min-width: 320px; }
      .header { font-size: 3rem; }
    }
  </style>
</head>
<body>

<div class="header">
  <span class="header-upcoming">Client&nbsp;</span>
  <span class="header-events">Perks</span>
</div>

<div class="slideshow-container" id="slideshowContainer"></div>

<div class="contact-info">
  Contact marketing team for more details:
  <span class="text-orange">marketing@compassoffices.com</span>
</div>

<script>
  const SHEET_CSV_URL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vR5DL0QoJRnBdK-omP5H8mELkFoTTZxSPZm3iOtHmGab7DhL6H6vowB2OAV8JMhxu6Dn8b-HaKGcDTI/pub?gid=685908943&single=true&output=csv";

  function fetchSheetData(callback) {
    fetch(SHEET_CSV_URL)
      .then(response => response.text())
      .then(text => {
        const lines = text.trim().split('\n');
        const data = [];
        for (let i = 1; i < lines.length; i++) {
          const row = lines[i].split(',');
          if (row.length >= 5) {
            const imgUrl = row[2].trim();
            const title = row[3].trim();
            const company = row[4].trim();
            data.push({ imgUrl, title, company });
          }
        }
        callback(data.reverse().slice(0, 6));
      })
      .catch(error => {
        console.error("Error loading CSV:", error);
      });
  }

  function createSlideGroup(cards) {
    const group = document.createElement("div");
    group.className = "slide-group";
    for (let i = 0; i < cards.length; i++) {
      const card = cards[i];
      let fileIdMatch = card.imgUrl.match(/[-\w]{25,}/);
      let fileId = fileIdMatch ? fileIdMatch[0] : "";
      let imgSrc = "https://drive.google.com/thumbnail?id=" + fileId + "&sz=w320";

      const cardDiv = document.createElement("div");
      cardDiv.className = "event-card";

      const imgContainer = document.createElement("div");
      imgContainer.className = "img-container";

      const img = document.createElement("img");
      img.src = imgSrc;
      img.alt = "Perk";
      img.className = "card-img";

      imgContainer.appendChild(img);

      const title = document.createElement("div");
      title.className = "event-title";
      title.innerText = card.title;

      const company = document.createElement("div");
      company.className = "company-name";
      company.innerText = card.company;

      cardDiv.appendChild(imgContainer);
      cardDiv.appendChild(title);
      cardDiv.appendChild(company);

      group.appendChild(cardDiv);

      if (i < cards.length - 1) {
        const divider = document.createElement("div");
        divider.className = "card-divider";
        group.appendChild(divider);
      }
    }
    return group;
  }

  function initSlides() {
    fetchSheetData(function (perks) {
      const container = document.getElementById("slideshowContainer");
      container.innerHTML = "";
      const chunkSize = 2;
      const slides = [];
      for (let i = 0; i < perks.length; i += chunkSize) {
        const chunk = perks.slice(i, i + chunkSize);
        const slide = createSlideGroup(chunk);
        container.appendChild(slide);
        slides.push(slide);
      }
      if (slides.length > 0) {
        slides[0].classList.add("active");
        let current = 0;
        setInterval(function () {
          slides[current].classList.remove("active");
          current = (current + 1) % slides.length;
          slides[current].classList.add("active");
        }, 6000);
      }
    });
  }

  document.addEventListener("DOMContentLoaded", initSlides);
</script>

</body>
</html>
