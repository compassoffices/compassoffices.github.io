<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Company Information</title>
    <link href="https://fonts.cdnfonts.com/css/neue-haas-grotesk-display-pro" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Source+Sans+Pro:wght@400;700&family=Noto+Sans:wght@400;700&display=sans-serif" rel="stylesheet">
    <style>
        body, html {
            margin: 0;
            padding: 0;
            width: 100vw;
            height: 100vh;
            font-family: 'Neue Haas Grotesk Display Pro', 'Source Sans Pro', 'Noto Sans', sans-serif;
            overflow: hidden;
            background-color: #282828;
        }

        .container {
            width: 100%;
            height: 100%;
            background-color: #282828;
            color: white;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            position: relative;
        }

        .header {
            background-color: #282828;
            height: 10.4167%;
            display: flex;
            align-items: center;
            padding: 0 3.7037%;
            font-size: 2.5vw;
            font-weight: bold;
            text-transform: capitalize;
            letter-spacing: 0.1852vw;
            justify-content: space-between;
        }

        .header .logo-container {
            width: 18.5185%;
            height: 100%;
        }

        .header .logo-container img {
            width: 100%;
            height: 100%;
            object-fit: contain;
        }

        .header .headline {
            text-align: right;
        }

        .content {
            flex-grow: 1;
            padding: 0.9259% 3.7037%;
            overflow: hidden;
            margin-bottom: 150px;
        }

        .page {
            width: 100%;
            height: 100%;
            display: none;
            position: relative;
        }

        .page.active {
            display: block;
        }

        .content .row {
            display: flex;
            justify-content: space-between;
            font-size: 2.2vw;
            padding: 10px 0;
            border-bottom: 1px solid #ffffff33;
            text-transform: capitalize;
            letter-spacing: 0.1389vw;
            opacity: 0;
            overflow: hidden;
            align-items: center;
        }

        .content .row:last-child {
            border-bottom: none;
        }

        .content .row .company-name {
            flex: 1;
            margin-right: 4%;
            display: block;
            white-space: normal;
            overflow-wrap: break-word;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        .content .row .tax-code {
            flex: 0 0 auto;
        }

        .content .row .tax-label {
            font-size: 1.8vw;
            color: #808080;
        }

        @keyframes splitFlap {
            0% {
                opacity: 1;
                transform: perspective(46.2963vw) rotateX(0deg);
            }
            45% {
                opacity: 0;
                transform: perspective(46.2963vw) rotateX(-90deg);
            }
            50% {
                opacity: 0;
                transform: perspective(46.2963vw) rotateX(90deg);
            }
            100% {
                opacity: 1;
                transform: perspective(46.2963vw) rotateX(0deg);
            }
        }

        .content .row.animate {
            animation: splitFlap 0.8s ease-in-out forwards;
        }

        .banner-iframe {
            width: 100%;
            height: 150px;
            border: none;
            display: block;
            background-color: #282828;
            position: absolute;
            bottom: 5.2083%;
            z-index: 2;
        }

        .footer {
            background-color: #ff6600;
            height: 5.2083%;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 3.7037%;
            font-size: 2.0vw;
            text-transform: capitalize;
            letter-spacing: 0.1389vw;
            position: relative;
            z-index: 3;
        }

        .footer .left-container {
            flex: 1;
            display: flex;
            align-items: center;
            gap: 1vw;
        }

        .footer .center-container {
            flex: 1;
            display: flex;
            justify-content: flex-start;
            margin-left: 0.3vw; /* Adjusted to approximate 3 spaces */
        }

        .footer .social-container {
            flex: 1;
            display: flex;
            justify-content: flex-end;
            align-items: center;
            gap: 2vw;
        }

        .footer .social-container img {
            height: 60px;
            width: 60px;
            object-fit: contain;
        }

        .footer .social-container span {
            font-size: 1.7vw;
            font-weight: normal;
            line-height: 1.2;
            text-align: left;
        }

        .page-number {
            font-size: 1.7vw;
        }

        .footer .timeline-bar {
            position: absolute;
            bottom: 0;
            left: 0;
            width: 0%;
            height: 6px;
            background-color: #ffffff;
            animation: loadProgress 15s linear infinite;
            z-index: 1;
        }

        @keyframes loadProgress {
            0% {
                width: 0%;
            }
            100% {
                width: 100%;
            }
        }

        @media screen and (max-height: 960px) {
            .header {
                font-size: 2.8vw;
            }
            .content {
                margin-bottom: 100px;
            }
            .content .row {
                font-size: 2.7vw;
            }
            .content .row .tax-label {
                font-size: 2.2vw;
            }
            .banner-iframe {
                height: 100px;
            }
            .footer {
                font-size: 2.2vw;
            }
            .footer .social-container span {
                font-size: 1.9vw;
            }
            .page-number {
                font-size: 1.9vw;
            }
            .footer .center-container {
                margin-left: 0.3vw; /* Maintain spacing for smaller screens */
            }
        }

        @media screen and (min-height: 1920px) {
            .header {
                font-size: 2.3vw;
            }
            .content {
                margin-bottom: 150px;
            }
            .content .row {
                font-size: 2.3vw;
            }
            .content .row .tax-label {
                font-size: 1.9vw;
            }
            .banner-iframe {
                height: 150px;
            }
            .footer {
                font-size: 1.8vw;
            }
            .footer .social-container span {
                font-size: 1.5vw;
            }
            .page-number {
                font-size: 1.5vw;
            }
            .footer .center-container {
                margin-left: 0.3vw; /* Maintain spacing for larger screens */
            }
        }

        @media screen and (min-height: 3840px) {
            .header {
                font-size: 2vw;
            }
            .content {
                margin-bottom: 150px;
            }
            .content .row {
                font-size: 2.1vw;
            }
            .content .row .tax-label {
                font-size: 1.7vw;
            }
            .banner-iframe {
                height: 150px;
            }
            .footer {
                font-size: 1.6vw;
            }
            .footer .social-container span {
                font-size: 1.4vw;
            }
            .page-number {
                font-size: 1.4vw;
            }
            .footer .center-container {
                margin-left: 0.3vw; /* Maintain spacing for ultra-high-resolution screens */
            }
        }
    </style>
</head>
<body onload="openFullscreen()">
    <div class="container">
        <div class="header">
            <div class="logo-container">
                <img src="https://compassoffices.github.io/img/logo/compassoffices-logo-web-2025_ow.png" alt="Company Logo">
            </div>
            <div class="headline">Company Information</div>
        </div>
        <div class="content">
            <div class="slideshow" id="slideshow"></div>
        </div>
        <iframe src="https://compassoffices.github.io/150/banner.html" class="banner-iframe" scrolling="no" title="Banner Slideshow"></iframe>
        <div class="footer">
            <div class="left-container">
                <span>Compass Offices | LM81</span>
            </div>
            <div class="center-container">
                <span class="page-number" id="pageCounter">Page 1/1</span>
            </div>
            <div class="social-container">
                <img src="https://compassoffices.github.io/qr/linkedtre-qr.png" alt="QR Code">
                <span>Follow us on <br> social media <br> for more updates</span>
            </div>
            <div class="timeline-bar"></div>
        </div>
    </div>

    <script>
        function openFullscreen() {
            const elem = document.documentElement;
            if (elem.requestFullscreen) {
                elem.requestFullscreen();
            } else if (elem.mozRequestFullScreen) {
                elem.mozRequestFullScreen();
            } else if (elem.webkitRequestFullscreen) {
                elem.webkitRequestFullscreen();
            } else if (elem.msRequestFullscreen) {
                elem.msRequestFullscreen();
            }
        }

        async function fetchSheetData() {
            const proxyUrl = 'https://cors-anywhere.herokuapp.com/';
            const sheetUrl = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vQ_tCRUkoIcOJYk2FSpSmYy8T4jdzANAJkSKnJfO0q74T7cYHtv3ccoQsGYG1ETcdRZO7Mo0WSRGyOe/pubhtml';
            const url = proxyUrl + sheetUrl;
            try {
                console.log("Fetching data from:", url);
                const response = await fetch(url);
                if (!response.ok) {
                    console.error(`HTTP error! Status: ${response.status}, Status Text: ${response.statusText}`);
                    throw new Error(`HTTP error! Status: ${response.status}`);
                }
                const data = await response.text();
                if (!data) {
                    console.error("Received empty HTML from Google Sheets");
                    return [];
                }
                console.log("HTML content length:", data.length);
                const parser = new DOMParser();
                const doc = parser.parseFromString(data, 'text/html');
                const table = doc.querySelector('table');
                if (!table) {
                    console.error("No table found in HTML");
                    return [];
                }
                console.log("Table found, processing rows...");
                const rows = Array.from(table.querySelectorAll('tr')).slice(1); // Skip header row
                if (!rows.length) {
                    console.error("No data rows found in table");
                    return [];
                }
                console.log("Number of rows:", rows.length);
                const parsedData = rows.map((row, index) => {
                    const cells = row.querySelectorAll('td');
                    console.log(`Row ${index + 1} cells:`, cells.length, Array.from(cells).map(cell => cell.textContent.trim()));
                    const company = (cells[0] ? cells[0].textContent.trim() : '');
                    const tax = (cells[1] ? cells[1].textContent.trim() : '');
                    return { company, tax };
                }).filter(entry => entry.company || entry.tax); // Filter out empty rows
                console.log("Parsed Data:", parsedData);
                return parsedData;
            } catch (error) {
                console.error("Error fetching sheet data:", error.message);
                return [];
            }
        }

        function createPages(data, itemsPerPage) {
            const pages = [];
            for (let i = 0; i < data.length; i += itemsPerPage) {
                const pageData = data.slice(i, i + itemsPerPage);
                const page = document.createElement('div');
                page.className = 'page';
                pageData.forEach(entry => {
                    const row = document.createElement('div');
                    row.className = 'row';
                    row.innerHTML = `
                        <span class="company-name">${entry.company || 'N/A'}</span>
                        <span class="tax-code"><span class="tax-label">Tax: </span>${entry.tax || 'N/A'}</span>
                    `;
                    page.appendChild(row);
                });
                pages.push(page);
            }
            return pages;
        }

        document.addEventListener('DOMContentLoaded', async () => {
            const data = await fetchSheetData();

            if (!data.length) {
                const slideshow = document.getElementById('slideshow');
                slideshow.innerHTML = `<div style="color: white; font-size: 2vw;">No data available at this time. Please check the data source or try again later.</div>`;
                return;
            }

            const itemsPerPage = 23;
            const pages = createPages(data, itemsPerPage);
            const slideshow = document.getElementById('slideshow');
            pages.forEach(page => slideshow.appendChild(page));

            let currentPage = 0;
            const totalPages = pages.length;
            const pageCounter = document.getElementById('pageCounter');

            function showPage(index) {
                pages.forEach(p => p.classList.remove('active'));
                const current = pages[index];
                current.classList.add('active');
                const rows = current.querySelectorAll('.row');
                rows.forEach((row, i) => {
                    row.className = 'row';
                    setTimeout(() => {
                        row.classList.add('animate');
                    }, i * 100);
                });
                pageCounter.textContent = `Page ${index + 1}/${totalPages}`;
            }

            showPage(currentPage);

            setInterval(() => {
                currentPage = (currentPage + 1) % totalPages;
                showPage(currentPage);

                const timelineBar = document.querySelector('.timeline-bar');
                timelineBar.style.animation = 'none';
                timelineBar.offsetHeight;
                timelineBar.style.animation = 'loadProgress 15s linear infinite';
            }, 15000);
        });
    </script>
</body>
</html>
